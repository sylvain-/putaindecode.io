<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[putaindecode.io]]></title><description><![CDATA[putaindecode.io]]></description><link>http://putaindecode.io</link><generator>RSS for Node</generator><lastBuildDate>Tue, 17 Apr 2018 07:16:27 GMT</lastBuildDate><atom:link href="http://putaindecode.io/feed.xml" rel="self" type="application/rss+xml"/><item><title><![CDATA[Podcast 10: Les technologies de la startup nation]]></title><description><![CDATA[<p>Un √©pisode o√π on vous parle des buzzwords que vous trouvez dans les offres d'emploi que vous recevrez sur LinkedIn au cours de l'ann√©e 2018. C'est parti pour les ICO finan√ßant votre future application VR avec back-end serverless et stockage sur la blockchain Ethereum.</p>
<ul>
<li>Matthias, <a href="https://twitter.com/bloodyowl">https://twitter.com/bloodyowl</a></li>
<li>Mathieu, <a href="https://twitter.com/Zoontek">https://twitter.com/Zoontek</a></li>
<li>Georges, <a href="https://twitter.com/skinnyfoetusboy">https://twitter.com/skinnyfoetusboy</a></li>
<li>Maxime, <a href="https://twitter.com/MoOx">https://twitter.com/MoOx</a></li>
</ul>
<iframe width="100%" height="300" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/427095801&color=%23333333&auto_play=false&hide_related=true&show_comments=false&show_user=true&show_reposts=false&show_teaser=false&visual=true"></iframe>
]]></description><link>http://putaindecode.io/fr/articles/podcast/10/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/podcast/10/</guid><pubDate>Tue, 10 Apr 2018 00:00:00 GMT</pubDate></item><item><title><![CDATA[√âcrire des high-order components r√©utilisables avec Recompose]]></title><description><![CDATA[<p>√âcrire des composants r√©utilisables est (ou devrait √™tre) l‚Äôun des objectifs de
tout d√©veloppeur React. Que ce soit pour cr√©er une bo√Æte √† outils de composants
styl√©s, pour mutualiser des comportements communs, etc.</p>
<p>M√™me en ayant fr√©quemment utilis√© des <em>high-order components</em> (avec
<em>React-Redux</em> par exemple), ce n‚Äôest que r√©cemment que j‚Äôai entendu parler de
l‚Äôopportunit√© qu‚Äôils offraient pour √©crire des composants r√©utilisables, en
particulier gr√¢ce √† une fantastique biblioth√®que :
<a href="https://github.com/acdlite/recompose">Recompose</a>. Voyons comment avec un
exemple concret et complet.</p>
<p>Si vous n‚Äôavez jamais entendu parler de <em>high-order components</em> (HOC) avant,
sachez simplement qu‚Äôun HOC n‚Äôest finalement rien d‚Äôautre qu‚Äôune fonction qui
prend en param√®tre une d√©finition de composant (classe ou fonction), et renvoie
une nouvelle d√©finition de composant, qui ajoute du comportement √† la premi√®re.
Il s‚Äôagit en fait du pattern
<a href="https://en.wikipedia.org/wiki/Decorator_pattern"><em>D√©corateur</em></a> appliqu√© aux
composants React.</p>
<p>Sur le site de React vous trouverez une
<a href="https://reactjs.org/docs/higher-order-components.html">page tr√®s fournie</a> si
vous souhaitez en savoir plus sur les HOC. Il y a √©galement un
<a href="/fr/articles/js/react/higher-order-component/#le-pattern-higher-order-component">tr√®s bon article sur Putain de code</a>
pr√©sentant les HOC √† travers un autre cas d‚Äôutilisation (le pattern <em>provider</em>).</p>
<p>Un exemple tr√®s simple :</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> addBorder = <span class="hljs-function"><span class="hljs-params">borderWidth</span> =></span> Component => <span class="hljs-function"><span class="hljs-params">props</span> =></span> (
  <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">borderColor:</span> '<span class="hljs-attr">black</span>', <span class="hljs-attr">borderStyle:</span> '<span class="hljs-attr">solid</span>', <span class="hljs-attr">borderWidth</span> }}></span>
    </span>&#x3C;Component {...props} />
  &#x3C;/div><span class="xml">
)

const MyText = </span>&#x3C;p>Hello!&#x3C;/p><span class="xml">

const MyTextWithBorder = addBorder(5)(MyText)</span></code></pre>
<p>Vous obtenez un composant <code>MyTextWithBorder</code> qui affiche le texte ¬´ Hello ¬ª avec
une bordure de 5 pixels. Ici, <code>addBorder</code> est ce que l‚Äôon appelle un <em>high-order
component</em>.</p>
<p>Quel est l‚Äôint√©r√™t d‚Äôun HOC ? Et bien un pattern tr√®s utile est d‚Äôextraire un
comportement partag√© par plusieurs composants dans des fonctions r√©utilisables.
Si vous avez utilis√© React avec Redux et React-Redux, vous avez sans doute
utilis√© le HOC <code>connect</code> pour faire le mapping de l‚Äô√©tat et des actions avec les
propri√©t√©s.</p>
<h2 id="exemple--champ-de-saisie-dun-num√©ro-de-t√©l√©phone"><a href="#exemple--champ-de-saisie-dun-num%C3%A9ro-de-t%C3%A9l%C3%A9phone" class="phenomic-HeadingAnchor">#</a>Exemple : champ de saisie d‚Äôun num√©ro de t√©l√©phone</h2>
<p>Comme exemple complet pour cette article, nous allons utiliser le concept d‚ÄôHOC
pour cr√©er un champ de saisie de num√©ro de t√©l√©phone, qui :</p>
<ul>
<li>n‚Äôacceptera que les chiffres, parenth√®ses, tirets et espaces en entr√©e (√† la
frappe) ;</li>
<li>mettra en forme le num√©ro de t√©l√©phone lorsque le focus sera perdu par le
champ (√©v√®nement <em>blur</em>). (Seuls les num√©ros de t√©l√©phone Nord-Americains
seront pris en compte : ¬´ (514) 555-0199 ¬ª.)</li>
</ul>
<figure>
  <img src="phoneNumberInput.gif" alt="Champ de saisie de num√©ro de t√©l√©phone" />
  <figcaption>Notre champ de saisie de num√©ro de t√©l√©phone</figcaption>
</figure>
<p>Notez que l‚Äôon supposera que notre champs sera contr√¥l√©, c‚Äôest-√†-dire que nous
utiliserons les propri√©t√©s <code>value</code> et <code>onChange</code> pour savoir quel texte afficher
et comment le mettre √† jour. Nous souhaitons √©galement que la valeur ne
contienne que les chiffres du num√©ro de t√©l√©phone (¬´ 5145550199 ¬ª), sans se
soucier de la mise en forme, et donc que le <code>onChange</code> soit appel√© avec les
chiffres uniquement (dans <code>event.target.value</code>).</p>
<p>Pour rendre notre HOC plus facile √† √©crire et maintenir, nous utiserons la
biblioth√®que <em>Recompose</em>, qui propose un grand nombre de fonctions utilitaires
pour √©crire des HOC. Nous en verrons quelques-unes dans cet article.</p>
<p>Pour d√©velopper notre composant nous cr√©erons deux HOC r√©utilisables, un pour
chacun des points ci-dessus. Cela signifie que nous souhaitons que notre
composant final soit d√©fini ainsi :</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> PhoneNumberInput = formatPhoneNumber(
  forbidNonPhoneNumberCharacters(<span class="hljs-function"><span class="hljs-params">props</span> =></span> &#x3C;input {...props} />)
)</code></pre>
<p>C‚Äôest le bon moment pour introduire la premi√®re fonction de <em>Recompose</em> que nous
utiliserons : <code>compose</code>. Elle effectue la composition de plusieurs HOC pour les
fusionner en un seul, de sorte que nous pouvons √©crire plus simplement :</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> PhoneNumberInput = compose(
  formatPhoneNumber,
  forbidNonPhoneNumberCharacters
)(<span class="hljs-function"><span class="hljs-params">props</span> =></span> &#x3C;input {...props} />)</code></pre>
<p>Et parce que nous souhaitons rendre nos HOC aussi r√©utilisable que possible
(pour mettre en forme autre chose que des num√©ros de t√©l√©phone par exemple),
rendons-les plus g√©n√©riques :</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// Ne garde que les chiffres, espaces, tirets et parenth√®ses</span>
<span class="hljs-keyword">const</span> forbiddenCharactersInPhoneNumber = <span class="hljs-regexp">/[^\d\s\-()]/g</span>

<span class="hljs-comment">// '5145551234' => '(514) 555-1234'</span>
<span class="hljs-keyword">const</span> formatPhoneNumber = <span class="hljs-function"><span class="hljs-params">value</span> =></span>
  value.replace(<span class="hljs-regexp">/^(\d{3})(\d{3})(\d{4})$/</span>, <span class="hljs-string">'($1) $2-$3'</span>)

<span class="hljs-comment">// '(514) 555-1234' => '5145551234'</span>
<span class="hljs-keyword">const</span> parsePhoneNumber = <span class="hljs-function"><span class="hljs-params">formattedPhoneNumber</span> =></span>
  formattedPhoneNumber.replace(<span class="hljs-regexp">/[^\d]/g</span>, <span class="hljs-string">''</span>).slice(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)

<span class="hljs-keyword">const</span> PhoneNumberInput = compose(
  formatInputValue({
    <span class="hljs-attr">formatValue</span>: formatPhoneNumber,
    <span class="hljs-attr">parseValue</span>: parsePhoneNumber
  }),
  forbidCharacters(forbiddenCharactersInPhoneNumber)
)(<span class="hljs-function"><span class="hljs-params">props</span> =></span> &#x3C;input {...props} />)</code></pre>
<p>Ne trouvez-vous pas cela d√©j√† g√©nial si l‚Äôon peut r√©utiliser uniquement nos deux
HOC pour mettre en forme des montants, des num√©ros de s√©curit√© sociale, tout et
n‚Äôimporte quoi, juste en utilisant les bons param√®tres ? üòâ</p>
<p>Le point r√©ellement int√©ressant est qu‚Äôici j‚Äôutilise le composant <code>&#x3C;input></code> de
base, mais nous pourrions utiliser n‚Äôimporte quel composant, tant qu‚Äôil utilise
les propri√©t√©s <code>value</code>, <code>onChange</code> et <code>onBlur</code>. Donc on peut imaginer utiliser
notre champs de saisie de num√©ros de t√©l√©phone avec React Native, Material-UI,
etc.</p>
<p>Ok, maintenant passons au plus important, √©crire nos deux HOC en utilisant les
fonctions que Recompose nous met √† disposition.</p>
<h2 id="premier-hoc--naccepter-que-certains-caract√®res"><a href="#premier-hoc--naccepter-que-certains-caract%C3%A8res" class="phenomic-HeadingAnchor">#</a>Premier HOC : n‚Äôaccepter que certains caract√®res</h2>
<p>L‚Äôid√©e ici est que lorsque la valeur de l‚Äôinput est chang√©e (√©v√®nement
<code>onChange</code>), on intercepte cet √©v√®nement pour supprimer tout caract√®re interdit
de la valeur, puis on appelle la propri√©t√© <code>onChange</code> parente avec la valeur
propre.</p>
<p>Nous utiliserons ici la fonction <code>withHandlers</code> pour ajouter des nouveaux
<em>handlers</em> d‚Äô√©v√®nement comme propri√©t√©s du composant encapsul√©. Le bon point est
que nous avons acc√®s aux propri√©t√©s de notre composant (ici nous utiliserons
<code>onChange</code>) pour cr√©er notre nouveau handler :</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> forbidCharacters = <span class="hljs-function"><span class="hljs-params">forbiddenCharsRegexp</span> =></span>
  withHandlers({
    <span class="hljs-attr">onChange</span>: <span class="hljs-function"><span class="hljs-params">props</span> =></span> event => {
      <span class="hljs-comment">// N‚Äôoublions pas que `onChange` n‚Äôest pas une propri√©t√© requise</span>
      <span class="hljs-comment">// (m√™me si rien ne se produira si elle est absente).</span>
      <span class="hljs-keyword">if</span> (props.onChange) {
        <span class="hljs-keyword">const</span> value = event.target.value
        <span class="hljs-keyword">const</span> cleanValue = value.replace(forbiddenCharsRegexp, <span class="hljs-string">''</span>)
        <span class="hljs-comment">// On ne modifie pas l‚Äô√©v√®nement original, mais on le clone</span>
        <span class="hljs-comment">// en y red√©finissant event.target.value avec la valeur propre.</span>
        <span class="hljs-keyword">const</span> newEvent = {
          ...event,
          <span class="hljs-attr">target</span>: { ...event.target, <span class="hljs-attr">value</span>: cleanValue }
        }
        <span class="hljs-comment">// On r√©√©met notre √©v√®nement au `onChange` parent.</span>
        props.onChange(newEvent)
      }
    }
  })</code></pre>
<p>Souvenez-vous qu‚Äôautant que possible le composant que nous cr√©ons √† partir d‚Äôun
autre doit respecter l‚Äôinterface de ce dernier. Il doit donc accepter les m√™mes
propri√©t√©s avec le m√™me type.</p>
<p>√Ä pr√©sent si nous souhaitons par exemple cr√©er un champ n‚Äôacceptant que les
chiffres, nous pouvons √©crire :</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> NumericField = forbidCharacters(<span class="hljs-regexp">/[^\d]/g</span>)(<span class="hljs-function"><span class="hljs-params">props</span> =></span> &#x3C;input {...props} />)</code></pre>
<p>Nous avons maintenant notre premier HOC pour interdire certains caract√®res;
√©crivons √† pr√©sent le deuxi√®me, l√©g√®rement plus complexe, pour mettre en forme
la valeur entr√©e par l‚Äôutilisateur.</p>
<h2 id="deuxi√®me-hoc--mettre-en-forme-la-valeur-entr√©e"><a href="#deuxi%C3%A8me-hoc--mettre-en-forme-la-valeur-entr%C3%A9e" class="phenomic-HeadingAnchor">#</a>Deuxi√®me HOC : mettre en forme la valeur entr√©e</h2>
<p>Pour notre deuxi√®me HOC, nous devrons avoir dans notre composant un √©tat local
pour stocker la valeur entr√©e dans le champs sans la passer au composant parent.
N‚Äôoubliez pas que nous souhaitons mettre en forme la valeur uniquement lorsque
le focus sort du champs (√©v√®nement <em>blur</em>).</p>
<p>Recompose d√©finit une fonction tr√®s simple pour ajouter un √©tat local √† un
composant : <code>withState</code>. Elle prend en param√®tre le nom de l‚Äôattribut dans
l‚Äô√©tat (qui sera donn√© comme propri√©t√© au composant enfant), le nom de la
propri√©t√© contenant la fonction pour mettre √† jour cet √©tat (√©galement donn√©e
comme propri√©t√©), et la valeur initiale (valeur statique, ou bien fonction
prenant en param√®tre les propri√©t√©s et retournant la valeur initiale).</p>
<p>Pour ajouter notre √©tat local nous √©crirons :</p>
<pre><code class="hljs language-js">withState(
  <span class="hljs-string">'inputValue'</span>,
  <span class="hljs-string">'setInputValue'</span>,
  <span class="hljs-comment">// `formatValue` est l‚Äôun des param√®tres de notre HOC</span>
  props => formatValue(props.value)
)</code></pre>
<p>Facile, non ? üòâ</p>
<p>Maintenant que l‚Äôon a notre √©tat, nous devons le mettre √† jour lorsque la valeur
de l‚Äôinput est modifi√©e, donc nous d√©finirons un handler <code>onChange</code> personnalis√©
:</p>
<pre><code class="hljs language-js">withHandlers({
  <span class="hljs-attr">onChange</span>: <span class="hljs-function"><span class="hljs-params">props</span> =></span> event => {
    props.setInputValue(event.target.value)
  }
  <span class="hljs-comment">// ...</span></code></pre>
<p>Et √† l‚Äô√©v√®nement <em>blur</em>, nous mettrons en forme la valeur, appelerons les
<code>onChange</code> et <code>onBlur</code> parents, puis mettrons en forme √©galement la valeur
affich√©e :</p>
<pre><code class="hljs language-js">  <span class="hljs-comment">// ...</span>
  onBlur: <span class="hljs-function"><span class="hljs-params">props</span> =></span> event => {
    <span class="hljs-comment">// parseValue est l‚Äôautre param√®tre de notre HOC</span>
    <span class="hljs-keyword">const</span> parsedValue = parseValue(props.inputValue)
    <span class="hljs-keyword">const</span> formattedValue = formatValue(parsedValue)
    props.setInputValue(formattedValue)
    <span class="hljs-comment">// On ne modifie pas l‚Äô√©v√®nement original, mais on le clone</span>
    <span class="hljs-comment">// en y red√©finissant event.target.value avec la valeur propre.</span>
    <span class="hljs-keyword">const</span> newEvent = {
      ...event,
      <span class="hljs-attr">target</span>: { ...event.target, <span class="hljs-attr">value</span>: parsedValue }
    }
    <span class="hljs-keyword">if</span> (props.onChange) {
      props.onChange(newEvent)
    }
    <span class="hljs-keyword">if</span> (props.onBlur) {
      props.onBlur(newEvent)
    }
  }
)</code></pre>
<p>La derni√®re √©tape pour notre HOC consiste √† nous assurer que seules les
propri√©t√©s accept√©es par <code>&#x3C;input></code> lui seront pass√©es. Pour cela on utilisera la
fonction <code>mapProps</code> de Recompose pour cr√©er un nouvel objet de propri√©t√©s √†
partir des propri√©t√©s existantes, ainsi que la fonction <code>omit</code> de <em>lodash</em> pour
exclure certaines propri√©t√©s d‚Äôun objet pour en cr√©er un nouveau :</p>
<pre><code class="hljs language-js">mapProps(<span class="hljs-function"><span class="hljs-params">props</span> =></span> ({
  ...omit(props, [<span class="hljs-string">'inputValue'</span>, <span class="hljs-string">'setInputValue'</span>]),
  <span class="hljs-attr">value</span>: props.inputValue
}))</code></pre>
<p>En assemblant le tout avec <code>compose</code>, on obtient :</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> formatInputValue = <span class="hljs-function">(<span class="hljs-params">{ formatValue, parseValue }</span>) =></span>
  compose(
    withState(<span class="hljs-string">'inputValue'</span>, <span class="hljs-string">'setInputValue'</span>, props => formatValue(props.value)),
    withHandlers({
      <span class="hljs-attr">onChange</span>: <span class="hljs-function"><span class="hljs-params">props</span> =></span> event => {
        props.setInputValue(event.target.value)
      },
      <span class="hljs-attr">onBlur</span>: <span class="hljs-function"><span class="hljs-params">props</span> =></span> event => {
        <span class="hljs-keyword">const</span> parsedValue = parseValue(props.inputValue)
        <span class="hljs-keyword">const</span> formattedValue = formatValue(parsedValue)
        props.setInputValue(formattedValue)
        <span class="hljs-keyword">const</span> newEvent = {
          ...event,
          <span class="hljs-attr">target</span>: { ...event.target, <span class="hljs-attr">value</span>: parsedValue }
        }
        <span class="hljs-keyword">if</span> (props.onChange) {
          props.onChange(newEvent)
        }
        <span class="hljs-keyword">if</span> (props.onBlur) {
          props.onBlur(newEvent)
        }
      }
    }),
    mapProps(<span class="hljs-function"><span class="hljs-params">props</span> =></span> ({
      ...omit(props, [<span class="hljs-string">'inputValue'</span>, <span class="hljs-string">'setInputValue'</span>]),
      <span class="hljs-attr">value</span>: props.inputValue
    }))
  )</code></pre>
<p>Et voil√† ! Nous avons deux <em>high-order components</em>, on peut les utiliser pour
cr√©er notre champs de saisie de num√©ro de t√©l√©phone ! Ci-dessous vous trouverez
le JSFiddle content le code source complet de cet exemple, et vous permet de
tester le r√©sultat. N‚Äôh√©sitez pas √† forker le
<a href="https://jsfiddle.net/scastiel/prme4k6L/">JSFiddle</a> pour jouer avec Recompose ou
cr√©er vos propres HOC.</p>
<iframe width="100%" height="300" src="//jsfiddle.net/scastiel/prme4k6L/8/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
<h2 id="les-render-props--une-alternative-aux-high-order-components-"><a href="#les-render-props--une-alternative-aux-high-order-components-" class="phenomic-HeadingAnchor">#</a>Les <em>render props</em> : une alternative aux <em>high-order components</em> ?</h2>
<p>√âcrire des composants r√©utilisables est tout √† fait possible sans utiliser de
HOC. Pour reprendre notre exemple de champ de saisie de num√©ro de t√©l√©phone nous
pourrions cr√©er un composant <code>FormattedInput</code>, qui prendrait en param√®tres
(propri√©t√©) les caract√®res autoris√©s d‚Äôune part, et les fonctions de formattage
d‚Äôautre part. Il resterait un inconv√©nient √† cette m√©thode : cela vous contraint
√† n‚Äôutiliser qu‚Äôun type de champ fix√© √† l‚Äôavance, par exemple <code>&#x3C;input></code>.</p>
<p>C‚Äôest l√† qu‚Äôintervient un concept particuli√®rement int√©ressant : celui des
<em>render props</em>. Tout simplement, cela consiste √† passer en propri√©t√© de votre
composant une fonction permettant de g√©n√©rer un autre composant, qui sera une
composante du premier.</p>
<p>Par exemple notre <code>PhoneNumberInput</code> pourrait nous laisser la possibilit√© de lui
indiquer comment g√©n√©rer un champ de saisie (sur lequel il ajoutera le
comportement sp√©cifique, ici la mise en forme) :</p>
<pre><code class="hljs language-js">&#x3C;PhoneNumberInput renderInput={inputProps => <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">input</span> {<span class="hljs-attr">...inputProps</span>} /></span>} /></span></code></pre>
<p>Il y aurait de quoi √©crire un article entier sur les <em>render props</em>, et selon
moi il serait dommage de les voir comme une sorte de ¬´ concurrent ¬ª des HOC ;
les deux peuvent r√©pondre √† des probl√©matiques parfois similaires, parfois
diff√©rentes.</p>
<p>Pour en savoir plus sur les <em>render props</em> la
<a href="https://reactjs.org/docs/render-props.html">page consacr√©e de la documentation de React</a>
est tr√®s d√©taill√©e et donne √©galement de bons exemples d‚Äôutilisation.</p>
<h2 id="en-conclusion"><a href="#en-conclusion" class="phenomic-HeadingAnchor">#</a>En conclusion‚Ä¶</h2>
<p>J‚Äôesp√®re que cet article vous a donn√© envie d‚Äôen savoir plus √† propos de
Recompose et des <em>high-order components</em> en g√©n√©ral. Je suis convaincu que les
HOC cr√©ent une nouvelle mani√®re d‚Äô√©crire des composants r√©utilisables ; on en
entendra sans aucun doute parler de plus en plus dans le futur üòÄ.</p>
<p>Quelques ressources pour aller plus loin :</p>
<ul>
<li>La
<a href="https://github.com/acdlite/recompose/blob/master/docs/API.md">documentation de l‚ÄôAPI de Recompose</a>
est assez compl√®te, bien que selon moi elle manque parfois d‚Äôexemples pour
comprendre certaines fonctions complexes ;</li>
<li>La
<a href="https://reactjs.org/docs/higher-order-components.html">page de React √† propos des HOC</a>
contient un grand nombre d‚Äôinformations, par exemple ce que vous ne devriez
pas faire avec les HOC üòâ ;</li>
<li><a href="https://medium.com/@franleplant/react-higher-order-components-in-depth-cf9032ee6c3e">React Higher Order Components in depth</a>
: une tr√®s bonne introduction aux HOC ;</li>
<li><a href="https://medium.com/javascript-inside/why-the-hipsters-recompose-everything-23ac08748198">Why The Hipsters Recompose Everything</a>
: une introduction sympa √† Recompose (semble un peu dat√©e‚Ä¶).</li>
<li><a href="https://reactjs.org/docs/render-props.html">La documentation de React sur les <em>render props</em></a></li>
<li><a href="/fr/articles/js/react/higher-order-component/#le-pattern-higher-order-component">Les patterns Provider &#x26; Higher-Order Component avec React</a> sur Putain de code</li>
</ul>
<p><em>Cet article est (pour la plus grande partie) la traduction en fran√ßais de mon article initialement en
anglais disponible sur mon blog :
<a href="https://blog.castiel.me/posts/006-reusable-hoc-with-recompose.html">Create reusable high-order React components with Recompose</a>.</em></p>
]]></description><link>http://putaindecode.io/fr/articles/js/react/hoc-reutilisables-recompose/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/js/react/hoc-reutilisables-recompose/</guid><pubDate>Mon, 26 Mar 2018 00:00:00 GMT</pubDate></item><item><title><![CDATA[Podcast 9: dotJS, React Native, bien-√™tre au travail (feat. Kevin Deldycke & Freddy Harris)]]></title><description><![CDATA[<p>Un √©pisode qui arrive non pas avec un, mais deux mois de retard, et avec un son d√©gueulasse. On a eu un petit accident de prise de son et en d√©pit des essais de rattrapage, √ßa n'a pas donn√© grand chose. On en est vraiment d√©sol√© et on va mieux s'√©quiper pour la suite.</p>
<p>Pour cet √©pisode, nous sommes en compagnie de:</p>
<ul>
<li>Matthias, <a href="https://twitter.com/bloodyowl">https://twitter.com/bloodyowl</a></li>
<li>Mathieu, <a href="https://twitter.com/Zoontek">https://twitter.com/Zoontek</a></li>
<li>Georges, <a href="https://twitter.com/skinnyfoetusboy">https://twitter.com/skinnyfoetusboy</a></li>
</ul>
<p>et de deux invit√©s:</p>
<ul>
<li>Freddy, <a href="https://twitter.com/HarrisFreddy">https://twitter.com/HarrisFreddy</a></li>
<li>Kevin, <a href="https://twitter.com/kdeldycke">https://twitter.com/kdeldycke</a></li>
</ul>
<p>On fait un petit retour sur l'√©dition 2017 de dotJS, on parle de ReactNative, et on √©change avec beaucoup de digressions sur le bien-√™tre au travail.</p>
<p>Encore d√©sol√© pour le son d√©gueu.</p>
<p>Bisous</p>
<iframe width="100%" height="300" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/392848578&amp;color=%23ff5500&amp;auto_play=false&amp;hide_related=true&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;show_teaser=true&amp;visual=true"></iframe>
]]></description><link>http://putaindecode.io/fr/articles/podcast/9/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/podcast/9/</guid><pubDate>Thu, 01 Feb 2018 00:00:00 GMT</pubDate></item><item><title><![CDATA[Flow avanc√© - Seconde partie: les types opaques]]></title><description><![CDATA[<p>Vous avez dig√©r√© le premier article, peut-√™tre m√™me d√©but√© avec <a href="https://flow.org/">flow</a> depuis, mais vous mourez d'envie de d√©couvrir ce que vous pouvez faire de plus avec votre nouvel outil pr√©f√©r√©¬†? Tant mieux, puisque nous sommes l√† pour parler d'une fonctionnalit√© assez avanc√©e, apparue avec la version 0.51 et, √† l'heure o√π j'√©cris ces lignes, indisponible dans TypeScript: les types opaques.</p>
<p>Si vous n'avez pas install√© flow au sein de votre projet, je vous renvoie au <a href="/fr/articles/js/flow/advanced-part-1/">premier article</a> qui vous expliquera tr√®s bien comment faire.</p>
<h2 id="transparence-de-types"><a href="#transparence-de-types" class="phenomic-HeadingAnchor">#</a>Transparence de types</h2>
<p>Si on parle de types opaques, c'est bien parce que les types transparents existent. D'ailleurs par d√©faut, tout alias de type d√©fini l'est. Mais que sont-ils¬†? Simple: ce sont des types compatibles entre eux et donc interchangeables.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

type FirstName = string;
type LastName = string;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">yellFirstName</span>(<span class="hljs-params">firstName: FirstName</span>) </span>{
  <span class="hljs-built_in">console</span>.log(firstName.toUpperCase());
}

<span class="hljs-keyword">const</span> name: LastName = <span class="hljs-string">"Acthernoene"</span>;
yellFirstName(name);</code></pre>
<p>Dans cet exemple, les types <code>FirstName</code> et <code>LastName</code> √©tant tout deux des alias de <code>string</code>, on peut sans probl√®me utiliser la variable <code>name</code> de type <code>LastName</code> l√† o√π la function <code>yellFirstName</code> attend un param√®tre de type <code>FirstName</code>. Pas cool.</p>
<h2 id="rendons-tout-cela-opaque"><a href="#rendons-tout-cela-opaque" class="phenomic-HeadingAnchor">#</a>Rendons tout cela opaque</h2>
<p>Nous allons donc modifier l'exemple pr√©c√©dent et‚Ä¶</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

opaque type FirstName = string;
opaque type LastName = string;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">yellFirstName</span>(<span class="hljs-params">firstName: FirstName</span>) </span>{
  <span class="hljs-built_in">console</span>.log(firstName.toUpperCase());
}

<span class="hljs-keyword">const</span> name: LastName = <span class="hljs-string">"Acthernoene"</span>;
yellFirstName(name);</code></pre>
<p>‚Ä¶toujours pas d'erreur¬†? Du calme, c'est normal. Les types <code>FirstName</code> et <code>LastName</code> √©tant accessibles car dans le m√™me module JS, flow sait que ceux-ci sont des alias de type <code>string</code>. Modifions l'exemple et cr√©ons un deuxi√®me module.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>
<span class="hljs-comment">// module.js</span>

opaque type FirstName = string;
opaque type LastName = string;

type User = {
  <span class="hljs-attr">firstName</span>: FirstName,
  <span class="hljs-attr">lastName</span>: LastName
};

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createUser</span>(<span class="hljs-params">firstName: string, lastName: string</span>): <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">return</span> { firstName, lastName };
}

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">yellFirstName</span>(<span class="hljs-params">firstName: FirstName</span>) </span>{
  <span class="hljs-built_in">console</span>.log(firstName.toUpperCase());
}</code></pre>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>
<span class="hljs-comment">// usage.js</span>

<span class="hljs-keyword">import</span> { createUser, yellFirstName } <span class="hljs-keyword">from</span> <span class="hljs-string">"./module"</span>;

yellFirstName(<span class="hljs-string">"Mathieu"</span>); <span class="hljs-comment">// ‚ö†Ô∏è Erreur: "string. Ce type est incompatible avec le type de param√®tre attendu FirstName"</span>

<span class="hljs-keyword">const</span> user = createUser(<span class="hljs-string">"Acthernoene"</span>, <span class="hljs-string">"Mathieu"</span>);
yellFirstName(user.firstName); <span class="hljs-comment">// Pas d'erreur</span></code></pre>
<p>On voit ici qu'il n'est en fait possible d'utiliser le type <code>FirstName</code> qu'apr√®s son assignation au sein du module o√π celui-ci est d√©fini. Un autre exemple: si l'on venait √† rendre le type <code>User</code> opaque, alors nous ne pourrions pas acc√©der √† <code>user.firstName</code>, la propri√©t√© √©tant inaccessible autrement que par une fonction qui manipulera le type <code>User</code>.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>
<span class="hljs-comment">// module.js</span>

opaque type FirstName = string;
opaque type LastName = string;

opaque type User = {
  <span class="hljs-attr">firstName</span>: FirstName,
  <span class="hljs-attr">lastName</span>: LastName
};

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createUser</span>(<span class="hljs-params">firstName: string, lastName: string</span>): <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">return</span> { firstName, lastName };
}

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">yellFirstName</span>(<span class="hljs-params">firstName: FirstName</span>) </span>{
  <span class="hljs-built_in">console</span>.log(firstName.toUpperCase());
}

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">yellUserFirstName</span>(<span class="hljs-params">user: User</span>) </span>{
  <span class="hljs-built_in">console</span>.log(user.firstName.toUpperCase());
}</code></pre>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>
<span class="hljs-comment">// usage.js</span>

<span class="hljs-keyword">import</span> { createUser, yellFirstName, yellUserFirstName } <span class="hljs-keyword">from</span> <span class="hljs-string">"./module"</span>;

<span class="hljs-keyword">const</span> user = createUser(<span class="hljs-string">"Acthernoene"</span>, <span class="hljs-string">"Mathieu"</span>);
yellFirstName(user.firstName); <span class="hljs-comment">// ‚ö†Ô∏è Erreur: "Propri√©t√© `firstName`. La propri√©t√© n'est pas accessible sur le type User"</span>
yellUserFirstName(user); <span class="hljs-comment">// Pas d'erreur</span></code></pre>
<h2 id="tu-naurais-pas-un-exemple-plus-concret-"><a href="#tu-naurais-pas-un-exemple-plus-concret-" class="phenomic-HeadingAnchor">#</a>Tu n'aurais pas un exemple plus concret¬†?</h2>
<p>Bien s√ªr que si¬†! Nous pouvons utiliser les types opaques pour impl√©menter un type <code>UUID</code> tr√®s basique:</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>
<span class="hljs-comment">// uuid.js</span>

<span class="hljs-comment">// @flow</span>

<span class="hljs-keyword">import</span> uuidv4 <span class="hljs-keyword">from</span> <span class="hljs-string">"uuid/v4"</span>; <span class="hljs-comment">// On installe 2 packages</span>
<span class="hljs-keyword">import</span> validator <span class="hljs-keyword">from</span> <span class="hljs-string">"validator"</span>;

<span class="hljs-keyword">export</span> opaque type UUID = string;

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span>(<span class="hljs-params"></span>): <span class="hljs-title">UUID</span> </span>{
  <span class="hljs-keyword">return</span> uuidv4();
}

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params">uuid: UUID</span>): <span class="hljs-title">boolean</span> </span>{
  <span class="hljs-keyword">return</span> validator.isUUID(uuid);
}</code></pre>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>
<span class="hljs-comment">// usage.js</span>

<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> UUID <span class="hljs-keyword">from</span> <span class="hljs-string">"./uuid"</span>;

UUID.check(<span class="hljs-string">"a duck"</span>); <span class="hljs-comment">// ‚ö†Ô∏è Erreur: "string. Ce type est incompatible avec le type de param√®tre attendu UUID"</span>
UUID.check(<span class="hljs-string">"df7cca36-3d7a-40f4-8f06-ae03cc22f045"</span>); <span class="hljs-comment">// ‚ö†Ô∏è Erreur: "string. Ce type est incompatible avec le type de param√®tre attendu UUID"</span>

<span class="hljs-keyword">const</span> uuid = UUID.create();
UUID.check(uuid); <span class="hljs-comment">// Pas d'erreur</span>

uuid.toUpperCase(); <span class="hljs-comment">// ‚ö†Ô∏è Erreur: "Appel de m√©thode `toUpperCase`. La m√©thode ne peut pas √™tre appel√©e sur un type UUID"</span></code></pre>
<h1 id="cest-tout-de-m√™me-assez-restrictifje-voudrais-ne-pas-devoir-tout-r√©impl√©menter"><a href="#cest-tout-de-m%C3%AAme-assez-restrictifje-voudrais-ne-pas-devoir-tout-r%C3%A9impl%C3%A9menter" class="phenomic-HeadingAnchor">#</a>C'est tout de m√™me assez restrictif‚Ä¶je voudrais ne pas devoir tout r√©impl√©menter</h1>
<p>Ne vous inqui√©tez pas, les d√©veloppeurs √† l'origine de flow ont tout pr√©vu et pour rem√©dier √† cela il existe ce qu'on appelle le sous-typage (ou <em>SubTyping</em> dans la langue de Shakespeare). Ainsi, nous allons dire √† flow que chaque <code>UUID</code> est un <code>string</code> mais que la r√©ciproque ce sera pas vraie pour autant.</p>
<p>Reprenons l'exemple pr√©c√©dent.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

<span class="hljs-keyword">import</span> uuidv4 <span class="hljs-keyword">from</span> <span class="hljs-string">"uuid/v4"</span>;
<span class="hljs-keyword">import</span> validator <span class="hljs-keyword">from</span> <span class="hljs-string">"validator"</span>;

<span class="hljs-keyword">export</span> opaque type UUID: string = string; <span class="hljs-comment">// Seul cette ligne change, on y ajoute un sous-type string</span>

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span>(<span class="hljs-params"></span>): <span class="hljs-title">UUID</span> </span>{
  <span class="hljs-keyword">return</span> uuidv4();
}

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params">uuid: UUID</span>): <span class="hljs-title">boolean</span> </span>{
  <span class="hljs-keyword">return</span> validator.isUUID(uuid);
}</code></pre>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>
<span class="hljs-comment">// usage.js</span>

<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> UUID <span class="hljs-keyword">from</span> <span class="hljs-string">"./uuid"</span>;

<span class="hljs-keyword">const</span> uuid = UUID.create();
UUID.check(uuid); <span class="hljs-comment">// Pas d'erreur</span>

uuid.toUpperCase(); <span class="hljs-comment">// Pas d'erreur: m√™me si uuid est un UUID, il est utilisable comme un type string</span></code></pre>
<h2 id="que-retenir-de-tout-√ßa-"><a href="#que-retenir-de-tout-%C3%A7a-" class="phenomic-HeadingAnchor">#</a>Que retenir de tout √ßa¬†?</h2>
<p>Comme on a pu le voir, les types opaques √©l√®vent clairement le niveau du type-game dans le milieu du JavaScript. Forc√©ment utiles pour imposer l'utilisation de fonctions pour cr√©er / manipuler certaines donn√©es, ils s'av√©reront assez vite indispensables pour structurer davantage votre JS et am√©liorer sa maintenabilit√©.</p>
<p>Je vous encourage d'ailleurs √† vous en servir quasiment partout (√ßa sera assez chiant au d√©but, mais vous me remercierez plus tard)¬†!</p>
<p>La bise, et rendez-vous pour une troisi√®me partie üòò</p>
]]></description><link>http://putaindecode.io/fr/articles/js/flow/advanced-part-2/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/js/flow/advanced-part-2/</guid><pubDate>Tue, 02 Jan 2018 00:00:00 GMT</pubDate></item><item><title><![CDATA[D√©couverte de Preact]]></title><description><![CDATA[<p>Preact est une alternative √† React. Plus pr√©cis√©ment, voici sa description
officielle :</p>
<blockquote>
<p>Fast 3kB alternative to React with the same ES6 API.</p>
</blockquote>
<p>Cette description semble all√©chante au premier coup d'oeil. Si on peut avoir un
React de 3ko, banco, on switch !</p>
<p>Pas si vite. L'API est la m√™me, mais rien n'indique que Preact est un React qui
tient dans 3 petits ko (bien que c'est ce qu'on peut parfois lire). √áa ferait
bien longtemps que les ing√©nieurs de Facebook auraient r√©agit s'il √©tait
possible de faire en sorte que React soit si petit. Preact fait donc des
compromis, des choix, et pr√©sente donc des diff√©rences avec React qu'il faut
conna√Ætre et prendre en compte avant d'envisager de switcher.</p>
<p><em>Cet article est destin√© aux gens qui connaissent d√©j√† au moins un petit peu
React. Tous les concepts li√©s √† (P)React ne seront pas d√©taill√©s. Si vous ne
connaissez rien √† React, je vous invite √† lire <a href="/fr/articles/js/react/">l'introduction √†
React</a>.</em></p>
<h2 id="quelles-sont-les-diff√©rences-entre-react-et-preact-"><a href="#quelles-sont-les-diff%C3%A9rences-entre-react-et-preact-" class="phenomic-HeadingAnchor">#</a>Quelles sont les diff√©rences entre React et Preact ?</h2>
<p>Les diff√©rences entre React et Preact peuvent √™tre rang√©es dans deux cat√©gories
: ce qu'il "manque" √† Preact, et ce qui est l√†, mais diff√©rent.</p>
<h3 id="ce-quil-manque"><a href="#ce-quil-manque" class="phenomic-HeadingAnchor">#</a>Ce qu'il "manque"</h3>
<p>Premi√®rement, Preact se concentre uniquement sur le DOM. Cela signifie qu'il
n'existe pas d'√©quivalent √†
<a href="https://facebook.github.io/react-native/">react-native</a>,
<a href="https://facebook.github.io/react-vr/">react-vr</a> ou tout autre
<a href="http://iamdustan.com/react-renderers/">renderer</a> du c√¥t√© de Preact. Celui-ci a
pour but d'afficher du DOM le plus efficacement possible.</p>
<p>Cette sp√©cialisation pour le DOM permet √† Preact de ne pas avoir √† impl√©menter
le syst√®me de Synthetic Events utilis√© par React. Ainsi, Preact peut se
permettre d'utiliser simplement le syst√®me d'√©v√©nements standard du navigateur.
Il faut bien avoir cela en t√™te lorsqu'on a l'habitude de travailler avec
React, car celui-ci corrige, ou du moins unifie certains comportements entre
les navigateurs (notamment sur <code>onChange</code>). Des diff√©rences dans le
comportement de votre app est donc √† pr√©voir en cas de switch.</p>
<p>Preact n'embarque pas de gestion de validation des PropTypes. Partant du
principe que celles-ci ne sont pas utilis√©es par tout le monde, la d√©cision a
√©t√© prise de ne pas les inclure dans le coeur de la biblioth√®que.</p>
<p>Pour finir, Preact n'expose pas (encore, tout du moins) les nouvelles APIs de
React 16 telles que <code>React.Fragment</code> (dont <a href="https://github.com/developit/preact/issues/946">le support est
pr√©vu</a>),
<code>ReactDOM.createPortal</code> (la fonctionnalit√© existe tout de m√™me sous une forme
diff√©rente dans <a href="https://github.com/developit/preact-portal">preact-portal</a>) ou
<code>ReactDOM.hydrate</code>.</p>
<h3 id="ce-qui-est-diff√©rent"><a href="#ce-qui-est-diff%C3%A9rent" class="phenomic-HeadingAnchor">#</a>Ce qui est diff√©rent</h3>
<p>Preact utilise la biblioth√®que
<a href="https://github.com/hyperhype/hyperscript">hyperscript</a>, qui est une version
g√©n√©rique de <code>React.createElement</code>. Le r√©sultat est le m√™me, la signature de la
fonction <code>h()</code> expos√©e par hyperscript √©tant la m√™me que celle de
<code>React.createElement</code>. Il faudra quand m√™me indiquer au compiler qu'il doit
utiliser cette fonction pour transpiler le JSX.</p>
<p>La m√©thode <code>render()</code> des composants re√ßoit toujours <code>this.props</code> et
<code>this.state</code> en param√®tres, ce qui permet de les destructurer directement dans
les param√®tres de la fonction, et ainsi de les traiter comme s'ils √©taient
eux-m√™mes des param√®tres.</p>
<p>Preact g√®re l'API <code>context</code>, mais il n'existe pas de <code>contextTypes</code> ni de
<code>childContextTypes</code> (ce qui est raccord avec l'absence de <code>propTypes</code>). Tous
les enfants re√ßoivent le <code>context</code> d√©finit dans la m√©thode <code>getChildContext()</code>
de leurs parents. Si plusieurs parents impl√©mentent cette m√©thode, alors les
descendants recevront un agr√©gat.</p>
<p>Dans Preact, <code>props.children</code> est un <code>Array</code>. On peut donc utiliser toutes les
m√©thodes de <code>Array.prototype</code> dessus, sans avoir √† passer par un √©quivalent de
<code>React.Children</code>. Toutefois, certains patterns tels que le <em>function as child</em>
n√©cessitent un peu de bricolage pour fonctionner.</p>
<p>Enfin, il est possible d'utiliser l'attribut <code>class</code> sur un noeud JSX.
<code>className</code> est aussi support√©, mais vous ne vous prendrez plus d'erreur
lorsque votre esprit se croira dans un fichier HTML et vous fera √©crire
<code>class</code>.</p>
<h2 id="comment-d√©marrer-un-projet-preact-"><a href="#comment-d%C3%A9marrer-un-projet-preact-" class="phenomic-HeadingAnchor">#</a>Comment d√©marrer un projet Preact ?</h2>
<p>Pour d√©marrer sur de bonnes bases, le plus simple est d'utiliser
<a href="https://github.com/developit/preact-cli"><code>preact-cli</code></a>. C'est un outil en
ligne de commande qui vous permet de cr√©er toute la structure de base de votre
application. Si vous connaissez <code>create-react-app</code>, alors vous aurez devin√© que
<code>preact-cli</code> est l'√©quivalent pour Preact.</p>
<p>Commen√ßons par l'installer : </p>
<pre><code class="hljs language-console">npm install -g preact-cli</code></pre>
<p>Nous avons maintenant acc√®s √† la commande <code>preact</code>. Celle-ci s'utilise de la
mani√®re suivante :</p>
<pre><code class="hljs language-console">preact create &#x3C;template-name> &#x3C;project-name></code></pre>
<p>O√π <code>&#x3C;template-name></code> est le nom d'un template officiel (list√© sur l'org GitHub
<a href="https://github.com/preactjs-templates"><code>preactjs-template</code></a>) ou un repository
GitHub contenant un dossier <code>template</code> (de la forme <code>&#x3C;username>/&#x3C;repository></code>);
et <code>&#x3C;project-name></code> est le nom du dossier dans lequel la structure du projet
sera cr√©√©e. Pour notre exemple, nous utiliserons le template <code>default</code>, et le
nom <code>test-preact</code> pour notre projet :</p>
<pre><code class="hljs language-console">preact create default test-preact</code></pre>
<p>En utilisant le template <code>default</code>, nous obtenons une application qui embarque
par d√©faut :</p>
<ul>
<li>Du code-splitting pour chaque route</li>
<li>Votre page <code>index.html</code> pr√©rendue pour un affichage le plus rapide possible</li>
<li>Un ServiceWorker pr√™t √† l'emploi (score Lighthouse 100/100 √† la g√©n√©ration de
l'app, ce score est bien √©videmment d√©pendant de ce que vous faites par la
suite)</li>
<li>Des metas preload en fonction de vos URL</li>
<li>Des polyfills charg√©s uniquement si n√©cessaire</li>
</ul>
<p>Il ne vous reste plus qu'√† √©crire votre app sur ces bases solides ! Pour
information, le routing est g√©r√© par
<a href="https://github.com/developit/preact-router"><code>preact-router</code></a>.</p>
<h2 id="jutilise-react-je-peux-switcher-sur-preact-"><a href="#jutilise-react-je-peux-switcher-sur-preact-" class="phenomic-HeadingAnchor">#</a>J'utilise React, je peux switcher sur Preact ?</h2>
<p>Oui, et pour √ßa il y a deux possibilit√©s : ajouter une couche de compatibilit√©,
ou passer purement et simplement √† Preact. </p>
<h3 id="rendre-preact-quasi-compatible-avec-react-en-utilisant-preact-compat"><a href="#rendre-preact-quasi-compatible-avec-react-en-utilisant-preact-compat" class="phenomic-HeadingAnchor">#</a>Rendre Preact quasi-compatible avec React en utilisant <code>preact-compat</code></h3>
<p>Le plus rapide est d'utiliser
<a href="https://github.com/developit/preact-compat"><code>preact-compat</code></a>. Ce module vient
s'ajouter √† Preact pour y ajouter une couche de compatibilit√© le rendant
compatible avec preque n'importe quel module √©crit pour React (tant que
celui-ci n'utilise pas les quelques bouts d'API manquants). Pour cela,
<code>preact-compat</code> expose l'ensemble de l'API de <code>react</code> et <code>react-dom</code>. Cela vous
permettra de continuer √† utiliser sereinement tous vos composants √©crits
sp√©cifiquement pour React, ainsi que vous son √©cosyst√®me.</p>
<p>Il faut donc l'installer, ainsi que Preact :</p>
<pre><code class="hljs language-console">npm install --save preact preact-compat</code></pre>
<p>Puis il faut ajouter des alias √† votre syst√®me de build, afin que tous vos
imports de <code>react</code> et <code>react-dom</code> soient rerout√©s vers <code>preact-compat</code>. Par
exemple, pour webpack :</p>
<pre><code class="hljs language-javasscript"><span class="hljs-keyword">module</span>.exports = {
    <span class="hljs-comment">//... votre configuration webpack</span>
    resolve: {
        <span class="hljs-keyword">alias</span>: {
            <span class="hljs-string">"react"</span>: <span class="hljs-string">"preact-compat"</span>,
            <span class="hljs-string">"react-dom"</span>: <span class="hljs-string">"preact-compat"</span>
        }
    }
}</code></pre>
<p>Si vous n'utilisez pas webpack, votre syst√®me de build est tr√®s certainement
list√© sur la
<a href="https://github.com/developit/preact-compat#preact-compat">documentation</a>.</p>
<p>Cette solution a l'avantage d'√™tre tr√®s rapide √† mettre en place. Toutefois, le
principal avantage de Preact est son poids de seulement 3ko. En ajoutant
<code>preact-compat</code>,vous ajouterez environ 2ko suppl√©mentaires. Ce n'est pas
√©norme, surtout si on prend en compte les avantages que ce module apporte, mais
il est possible de ne pas avoir √† ajouter cette couche de compatibilit√©.</p>
<h3 id="passer-compl√®tement-√†-preact"><a href="#passer-compl%C3%A8tement-%C3%A0-preact" class="phenomic-HeadingAnchor">#</a>Passer compl√®tement √† Preact</h3>
<p>Cette solution est un peu plus longue √† mettre en place, mais si votre code
n'est pas d√©pendant d'un module qui utilise des parties de l'API de React qui
ne sont pas prises en compte par Preact, alors elle vous permettra d'obtenir le
bundle le plus l√©ger possible.</p>
<p>Premi√®rement, il faut installer Preact :</p>
<pre><code class="hljs language-console">npm install --save preact</code></pre>
<p>Puis il faut indiquer √† votre compiler le pragma JSX qu'il doit utiliser. Pour
babel, vous pouvez installer le plugin <code>babel-plugin-transform-react-jsx</code> :</p>
<pre><code class="hljs language-console">npm instal --save-dev babel-plugin-transform-react-jsx</code></pre>
<p>Puis indiquer le pragma JSX dans les options de ce plugin dans votre fichier
<code>.babelrc</code> :</p>
<pre><code class="hljs language-js">{
    <span class="hljs-string">"plugins"</span>: [
        [<span class="hljs-string">"transform-react-jsx"</span>, { <span class="hljs-string">"pragma"</span>: <span class="hljs-string">"h"</span> }]
    ]
}</code></pre>
<p><em>M√™me si vous connaissez React, cette histoire de pragma JSX pourrait ne pas
vous √©voquer grand chose. Si vous souhaitez en savoir plus, je vous conseille
de lire l'article suivant : <a href="https://jasonformat.com/wtf-is-jsx/">WTF is JSX</a>.
Si vous utilisez React et n'avez jamais eu √† configurer ce pragma, c'est parce
que la plupart des compilers utilisent le pragma <code>@jsx React.createElement</code> par
d√©faut.</em></p>
<p>Si vous utilisez une version de React qui n'est pas √† jour, il est possible que
votre codebase utilise l'ancienne syntaxe <code>React.createClass()</code>. Dans ce cas,
il faut que vous installiez
<a href="https://github.com/laurencedorman/preact-classless-component"><code>preact-classless-component</code></a>,
ou que vous passiez votre codebase dans le
<a href="https://github.com/vutran/preact-codemod"><code>preact-codemod</code></a> qui transformera
vos composants en classes ES6. De m√™me, il se peut que vous utilisiez des
r√©f√©rences par cha√Æne de caract√®res, qui ne sont pas support√©es par Preact.
Dans ce cas, il faudra les transformer en r√©f√©rences fonctionnelles.</p>
<p>Il ne vous reste plus qu'√† mettre √† jour vos imports pour que ceux-ci pointent
vers Preact. Voici un petit exemple :</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { h, Component, render } <span class="hljs-keyword">from</span> <span class="hljs-string">"preact"</span>;

<span class="hljs-keyword">const</span> Header = <span class="hljs-function"><span class="hljs-params">()</span> =></span> &#x3C;header>Ma putain d<span class="hljs-string">'app&#x3C;/header>;

class App extends Component {
    render() {
        return (
            &#x3C;div>
                &#x3C;Header />
                &#x3C;main>
                    Hello, world !
                &#x3C;/main>
            &#x3C;/div>
        ); 
    }
}

render(&#x3C;App />, document.getElementById("app"));</span></code></pre>
<p>Voil√†, vous avez maintenant une aper√ßu de ce qu'est Preact et des moyens √†
votre disposition pour l'utiliser. Facebook ne vous est plus d'aucune utilit√©,
vous pouvez fermer votre compte.</p>
<p>Plus s√©rieusement, nous avons vu que Preact est en grande partie compatible
avec React et peut presque le remplacer sur une app web. Cela n√©cessite tout de
m√™me un peu de travail et de vigilance, mais le switch est possible et peut
vous permettre de faire √©conomiser √† vos utilisateurs le t√©l√©chargement de
pr√©cieux ko.</p>
]]></description><link>http://putaindecode.io/fr/articles/js/preact/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/js/preact/</guid><pubDate>Thu, 21 Dec 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Stop aux `npm install -g` sauvages (ou pourquoi vous ne devriez pas installer en global de packages et outils CLI)]]></title><description><![CDATA[<p>√Ä chaque fois qu‚Äôun d√©veloppeur installe un outil globalement, une discussion
tabs vs spaces commence. Et Dieu sait que c‚Äôest inutile. Les espaces c‚Äôest
mieux. Fin de la discussion.</p>
<p>√Ä chaque fois qu‚Äôun d√©veloppeur utilise un outil de d√©veloppement global, un
chaton meurt. Et Dieu sait que nous aimons les chats.</p>
<p>Plus s√©rieusement, c‚Äôest une vraie question. Et une bonne question.</p>
<h2 id="pourquoi-installer-un-outil-de-mani√®re-globale-sur-sa-machine-est-une-mauvaise-id√©e"><a href="#pourquoi-installer-un-outil-de-mani%C3%A8re-globale-sur-sa-machine-est-une-mauvaise-id%C3%A9e" class="phenomic-HeadingAnchor">#</a>Pourquoi installer un outil de mani√®re globale sur sa machine est une mauvaise id√©e?</h2>
<p>On va tenter de r√©pondre ici de mani√®re constructive.</p>
<p>La raison est simple et c‚Äôest la m√™me raison pour laquelle aujourd‚Äôhui il y a
Yarn et npm 5 qui utilisent des fichiers <code>lock</code> : parce que vous voulez avoir
l'assurance d'avoir la m√™me version que vos coll√®gues.</p>
<p>Tr√®s souvent, dans le fond un outil CLI n‚Äôest rien de plus qu‚Äôune d√©pendance √†
un projet. Il est tout √† fait (voire hautement) probable que sur deux projets
diff√©rents d√©velopp√©s √† deux instants diff√©rents dans le temps vous ayez utilis√©
deux versions diff√©rentes d‚Äôun outil.</p>
<p>Le premier exemple de ma vie qui me vient en t√™te c‚Äôest les pr√©-processeurs CSS.
√Ä l‚Äô√©poque o√π j‚Äôutilisais Sass, il √©tait courant que pour une raison X ou Y (par
exemple une nouvelle fonctionnalit√© disponible dans une version majeure) que je
dois mettre √† jour la version pour le projet en cours. Mais que se passe-t-il
alors pour tous mes anciens projets ? Vont-ils √™tre compatibles ? Vont-ils avoir
des probl√®mes ? Vais-je devoir mettre mes autres projets √† jour ? Cela va-t-il
me faire chier d‚Äôune mani√®re hors du commun ?</p>
<p>Vous avez ici des vraies questions d'ordre pratique. √áa a d√ª arriver √† tout le
monde d‚Äôavoir ce cas de figure.</p>
<p>Et je vais ajouter √† ceci un autre probl√®me.</p>
<h2 id="¬´-mais-puisse-ke-je-te-di-ke-sa-marche-cez-moi--¬ª"><a href="#%C2%AB-mais-puisse-ke-je-te-di-ke-sa-marche-cez-moi--%C2%BB" class="phenomic-HeadingAnchor">#</a>¬´ mais puisse ke je te di ke sa marche cez moi ! ¬ª</h2>
<p>On a tous travaill√© √† plus de deux d√©veloppeurs sur un projet (et encore √ßa peut
nous arriver tout seul au changement de machine)</p>
<p>Le fameux ¬´ √ßa marche sur ma machine ¬ª. Celui-l√† qui prend gr√¢ve la t√™te.
Celui-l√† qui peut nous faire perdre des heures √† comprendre pourquoi √ßa marche
pas sur le PC des coll√®gues.</p>
<p>Celui-l√† qui √©nerve les personnes chez qui √ßa marche et ceux chez qui cela ne
marche pas. Oui √ßa fait clairement chier tout le monde.</p>
<p>Du coup pour √©viter ce probl√®me, il y a une m√©thode simple.</p>
<h2 id="ne-jamais-√¥-grand-jamais-installer-un-outil-de-d√©veloppeur-globalement-sur-sa-machine"><a href="#ne-jamais-%C3%B4-grand-jamais-installer-un-outil-de-d%C3%A9veloppeur-globalement-sur-sa-machine" class="phenomic-HeadingAnchor">#</a>Ne jamais (√¥ grand jamais) installer un outil de d√©veloppeur globalement sur sa machine.</h2>
<p>De rien. Voil√† c‚Äô√©tait un conseil gratuit.</p>
<p>(Je d√©taillerai √† la fin de cet article les seules raisons valables pour
utiliser et installer globalement un package ou un outil CLI)</p>
<p>Bon du coup pour √©viter ce probl√®me on a une solution extr√™mement simple :
installer localement √† chaque projet TOUTES les d√©pendances.</p>
<p>Il y a deux choses que peu de gens savent : la premi√®re est que npm et yarn vont
automatiquement ajouter tous les bin disponibles vu tous les node_modules locaux
dans le PATH utilis√© via les scripts d√©finis dans votre package.json.</p>
<p>Du coup dans la pratique il vous suffit de vous faire un petit alias pour chaque
outil CLI et le tour est jou√©.</p>
<pre><code class="hljs language-js">{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"cmd"</span>: <span class="hljs-string">"cmd"</span> <span class="hljs-comment">// on assume qu'on a un outil qui offre le bin `cmd`</span>
  }
}</code></pre>
<pre><code class="hljs language-console">npm run cmd</code></pre>
<p>√Ä savoir avec npm il faudra rajouter des ‚Äî √† la fin d‚Äôune commande pour que cela
fonctionne correctement si vous passez des arguments.</p>
<pre><code class="hljs language-console">npm run cmd -- arg</code></pre>
<p>Avec Yarn, cela n‚Äôest pas n√©cessaire. C‚Äôest bien plus bref (et pratique)</p>
<pre><code class="hljs language-console">yarn cmd arg</code></pre>
<p>Il faut savoir que pour les d√©veloppeurs de ce type d‚Äôoutil c‚Äôest aussi un petit
cauchemar √† g√©rer.</p>
<p>Lorsqu‚Äôun outil √† une package offrant une interface CLI, comment savoir si la
version de la biblioth√®que fonctionnera avec ?</p>
<p>De cette probl√©matique est n√©e une solution r√©currente : les package qui
ont une CLI et une biblioth√®que en parall√®le vont tr√®s souvent avoir une CLI
tr√®s light qui va en g√©n√©ral consister √† aller chercher dans le dossier de la
biblioth√®que o√π vous vous trouvez le vrai code √† ex√©cuter.</p>
<p>Je dirais m√™me que c‚Äôest plut√¥t cool dans un sens.</p>
<p>Mais on voit bien ici qu‚Äôon a un petit probl√®me car cela demande du travail
suppl√©mentaire aux d√©veloppeurs des projets qui sont d√©j√† trop souvent √† flirter
avec le burnout.</p>
<h2 id="petite-astuce-bien-styl√©e"><a href="#petite-astuce-bien-styl%C3%A9e" class="phenomic-HeadingAnchor">#</a>Petite astuce bien styl√©e</h2>
<p>Vous pouvez ajouter tous les binaires de <code>node_modules/.bin</code> localement √† votre
PATH histoire de pouvoir les utiliser en CLI.</p>
<pre><code class="hljs language-sh"><span class="hljs-comment"># to avoid npm install -g / yarn global add</span>
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:./node_modules/.bin</code></pre>
<p>Une fois cette astuce r√©alis√©e, d√©posez dans votre <code>.bashrc</code> (ou<code>.zshrc</code>‚Ä¶), vous
pourrez utiliser des bin locaux √† votre projet comme si ils avaient √©t√©
install√©s globalement. Sans passer par alias. Mais √ßa ne marchera bien entendu
qu‚Äô√† la racine du projet. √áa reste bien pratique n‚Äôest-ce pas?</p>
<p>(Et non, si vous faites √ßa dans l'ordre d√©crit plus haut, il n'y a pas de soucis
de s√©curit√© genre <em>"un package remplace <code>rm</code> et fait ce qu'il veut avec mes
donn√©es"</em> puisque la priorit√© sera donn√©e √† la premi√®re partie du <code>PATH</code>.)</p>
<h2 id="alternative-bien-styl√©e"><a href="#alternative-bien-styl%C3%A9e" class="phenomic-HeadingAnchor">#</a>Alternative bien styl√©e</h2>
<p>Si vous n'√™tes pas fan de modifier votre <code>PATH</code>,
<a href="https://www.npmjs.com/package/npx"><code>npx</code></a> est un outil qui va justement
permettre d'appeler les <code>node_modules/.bin</code> locaux sans le modifier.</p>
<p>Au mais comment on l'installe? Avec <code>-g</code> pardi ! Je plaisante. Il est inclus
avec <code>npm</code>. Faites un petit <code>which npx</code> pour v√©rifier!</p>
<p>Dans tous les cas, <code>npx</code> fait partie des rares outils qui m√©ritent d'√™tre
install√©s en global, ceux qui sont pour l'environnement du d√©veloppeur,
pas pour un projet.</p>
<p>D'ailleurs parlons en de ces cas o√π <code>-g</code> est valide.</p>
<h2 id="les-seuls-cas-valides-o√π-les-outils-globaux-ont-du-sens"><a href="#les-seuls-cas-valides-o%C3%B9-les-outils-globaux-ont-du-sens" class="phenomic-HeadingAnchor">#</a>Les seuls cas valides o√π les outils globaux ont du sens</h2>
<p>Les seuls cas valides sont pour des outils qui ne sont pas des outils li√©s √† un
projet. C‚Äôest pas plus compliqu√©!</p>
<p>R√©p√©tez avec moi: <em>"Installer avec -g c'est pour mon environnement de
d√©veloppeur, rien qu'√† moi. Pas pour un projet".</em></p>
<p>En plus de <code>npx</code>, un tr√®s bon exemple serait
<a href="https://www.npmjs.com/package/trash"><code>trash(-cli)</code></a>, que je vous conseille
d‚Äôutiliser en place de <code>rm -rf</code> (il va plus vite (d√©place dans votre corbeille),
et permet donc la r√©cup√©ration, sait-on jamais). Et encore si vous l‚Äôutilisez
sur un projet, pensez √† l‚Äôajouter aux d√©pendances (--dev)!</p>
<p>Il en existera d'autres, mais rappelez-vous que <code>npm install -g</code> est clairement
trop souvent recommand√© alors qu'il ne devrait pas l'√™tre!</p>
<p>N‚Äôh√©sitez pas √† r√©agir √† ces conseils.</p>
<p>Bisous √† tous üòò</p>
<hr>
<h2 id="note-sur-npx-et-sa-magie-int√©gr√©e"><a href="#note-sur-npx-et-sa-magie-int%C3%A9gr%C3%A9e" class="phenomic-HeadingAnchor">#</a>Note sur <code>npx</code> et sa magie int√©gr√©e</h2>
<p><code>npx</code> permet de t√©l√©charger automatiquement les packages.
Par exemple tapez <code>npx mocha</code> et il vous installera le package <code>mocha</code> en global
et ira m√™me jusqu'√† s'occuper des mises √† jour tout seul (en plus d'ex√©cuter la
commande, puisque c'est son but initial).
Malheureusement, pour les raisons expliqu√©es plus haut,
je ne pense vraiment pas que √ßa soit une bonne id√©e.
Que se passe-t-il si vous avez pris l'habitude d'utiliser <code>npx</code> et qu'un beau
jour il vous t√©l√©charge (puisque il ne vous demande rien - c'est magique)
une version contenant un bug? Vous aurez l'air malin. Et cela n'emp√™che en rien
le fameux probl√®me du "√ßa marche sur ma machine" puisque vous aurez
potentiellement des coll√®gues qui ne l'utiliseront pas. Oui ceux qui ne lisent
jamais les README et n'√©coute pas les recommandations...</p>
<p>(Je vois encore trop souvent des gens utiliser <code>npm</code> sur des projets n√©cessitant
<code>yarn</code> et qui viennent se plaindre de temps en temps que
"√ßa-marche-plus-j'ai-fait-rm-rf-node_modules-&#x26;&#x26;-npm-install-mais-c-est-pas-mieux")</p>
]]></description><link>http://putaindecode.io/fr/articles/npm/install-g/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/npm/install-g/</guid><pubDate>Thu, 30 Nov 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Podcast 8: Google va t-il tuer le web ? (et Firefox, GitHub, Fastlane)]]></title><description><![CDATA[<p>Le voici le voil√†, il est tout frais, l'√©pisode 8 !</p>
<p>On vous y parle de Reason3, Firefox Quantum, Atom Teletype, GitHub, fastlane, detox et on se posera la question ‚Ä¶</p>
<p><strong>‚Ä¶ GOOGLE VA T-IL TUER LE WEB ?</strong></p>
<p>√Ä nouveau, je (Matthias, <a href="https://twitter.com/bloodyowl">https://twitter.com/bloodyowl</a>) pr√©sente avec mes fid√®les comparses :</p>
<ul>
<li>Maxime (<a href="https://twitter.com/MoOx">https://twitter.com/MoOx</a>)</li>
<li>Georges (<a href="https://twitter.com/skinnyfoetusboy">https://twitter.com/skinnyfoetusboy</a>)</li>
</ul>
<p>Les liens:</p>
<ul>
<li>Reason3 : <a href="https://reasonml.github.io/community/blog/#reason-3">https://reasonml.github.io/community/blog/#reason-3</a></li>
<li>Firefox Quantum : <a href="https://blog.mozilla.org/firefox/the-new-firefox-is-here/">https://blog.mozilla.org/firefox/the-new-firefox-is-here/</a></li>
<li>Quelques nombres sur FF : <a href="https://blog.mozilla.org/firefox/the-new-firefox-by-the-numbers/">https://blog.mozilla.org/firefox/the-new-firefox-by-the-numbers/</a></li>
<li>Atom Teletype : <a href="https://teletype.atom.io">https://teletype.atom.io</a></li>
<li>GitHub Security Alerts : <a href="https://github.com/blog/2470-introducing-security-alerts-on-github">https://github.com/blog/2470-introducing-security-alerts-on-github</a></li>
<li>fastlane : <a href="https://fastlane.tools">https://fastlane.tools</a></li>
<li>detox : <a href="https://github.com/wix/detox">https://github.com/wix/detox</a></li>
</ul>
<p>Track du g√©n√©rique : <a href="https://soundcloud.com/matthias-le-brun/sparse">https://soundcloud.com/matthias-le-brun/sparse</a></p>
<iframe width="100%" height="300" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/359077001&amp;color=%23ff5500&amp;auto_play=false&amp;hide_related=true&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;show_teaser=true&amp;visual=true"></iframe>
<ul>
<li>Le
<a href="http://feeds.soundcloud.com/users/soundcloud:users:273901232/sounds.rss">RSS</a></li>
<li>Sur iTunes : <a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825?l=en&#x26;mt=2">Putain de
Code</a></li>
</ul>
]]></description><link>http://putaindecode.io/fr/articles/podcast/8/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/podcast/8/</guid><pubDate>Fri, 24 Nov 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Flow avanc√© - Premi√®re partie]]></title><description><![CDATA[<p>√áa y est: vos coll√®gues ont enfin r√©ussi √† vous motiver √† utiliser <a href="https://flow.org/en/">flow</a>, l'outil de Facebook vous permettant d'ajouter du typage fort au sein de vos fichiers JavaScript. Seulement voil√†, vous avez utilis√© des langages √† typage dynamique faible toute votre vie (PHP, JavaScript, Ruby, Python‚Ä¶), et pour le moment vous vous contentez d'ajouter des annotations de types <code>Object</code>, <code>Function</code> ou encore <code>string</code>. Frustr√©s, vous ne pouvez vous emp√™cher de crier sur tous les toits que le typage, c'est quand m√™me chiant et limite une perte de temps puisque flow continue de manquer un tas d'erreurs potentielles au sein de votre code. Cet article est l√† pour vous aider √† comprendre de quoi le bouzin est r√©ellement capable, et m√™me si vous n'utilisez pas flow, il peut servir de chouette introduction un peu pouss√©e √† son utilisation.</p>
<p>Nous utiliserons la derni√®re version en date √† l'heure o√π j'√©cris ces lignes, c'est √† dire la 0.59.
Pour l'ajouter au sein de votre projet, petit rappel:</p>
<pre><code class="hljs language-sh">npm install --save-dev flow-bin
npm install --save-dev flow-remove-types <span class="hljs-comment"># pour les besoin du tuto - vous pouvez √©galement utiliser babel et le couple babel-plugin-syntax-flow / babel-plugin-transform-flow-strip-types</span>
npx flow init <span class="hljs-comment"># pour cr√©er le fichier .flowconfig</span></code></pre>
<p><em>Pour plus d'infos sur npx, c'est <a href="https://www.npmjs.com/package/npx">par ici</a>. √Ä noter que c'est livr√© de base avec npm maintenant.</em></p>
<h2 id="rappels-sur-linf√©rence-de-type"><a href="#rappels-sur-linf%C3%A9rence-de-type" class="phenomic-HeadingAnchor">#</a>Rappels sur l'inf√©rence de type</h2>
<p>Flow est un outil intelligent: il est inutile de pr√©ciser quel type est utilis√© si celui-ci est √©vident √† l'usage.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow &#x3C;- le pragma n√©cessaire pour indiquer √† flow d'analyser votre fichier. √Ä noter que si vous l'ajoutez sur un projet tout neuf, vous pouvez le configurer pour que celui-ci ne soit pas n√©cessaire</span>

<span class="hljs-keyword">const</span> quote = <span class="hljs-string">"Thirouin rouin rouin rouin"</span>;
<span class="hljs-built_in">Math</span>.round(quote); <span class="hljs-comment">// erreur! le type attendu est un number</span>

<span class="hljs-keyword">const</span> sayHello = <span class="hljs-function"><span class="hljs-params">name</span> =></span> <span class="hljs-string">`Hello <span class="hljs-subst">${name}</span>`</span>; <span class="hljs-comment">// inf√©r√© en (name: any) => string</span>
sayHello(<span class="hljs-string">"Mathieu"</span>); <span class="hljs-comment">// pas d'erreur</span>
sayHello(<span class="hljs-number">42</span>); <span class="hljs-comment">// pas d'erreur</span>
sayHello([<span class="hljs-string">"Mathieu"</span>, <span class="hljs-string">"zoontek"</span>]); <span class="hljs-comment">// erreur: ne peut √™tre un array</span></code></pre>
<p>Attention: En annotant la fonction <code>sayHello</code> du type <code>Function</code>, vous perdez carr√©ment l'inf√©rence. Comme quoi, parfois ne pas pr√©ciser le type d'une variable peut se montrer plus efficace que d'utiliser des types "g√©n√©riques" tels que <code>Object</code> ou <code>Function</code> (d'ailleurs je vous encourage √† ne jamais le faire).</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

<span class="hljs-keyword">const</span> sayHello: <span class="hljs-built_in">Function</span> = <span class="hljs-function"><span class="hljs-params">name</span> =></span> <span class="hljs-string">`Hello <span class="hljs-subst">${name}</span>`</span>; <span class="hljs-comment">// inf√©r√© en (name: any) => any</span></code></pre>
<p>Si vous d√©sirez interpoler un string, la bonne fa√ßon de faire est bien s√ªr la suivante¬†:</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>
<span class="hljs-keyword">const</span> sayHello = <span class="hljs-function">(<span class="hljs-params">name: string</span>) =></span> <span class="hljs-string">`Hello <span class="hljs-subst">${name}</span>`</span>; <span class="hljs-comment">// (name: string) => string</span>
sayHello(<span class="hljs-string">"Mathieu"</span>); <span class="hljs-comment">// pas d'erreur</span>
sayHello(<span class="hljs-number">42</span>); <span class="hljs-comment">// pas d'erreur</span></code></pre>
<h2 id="les-types-primitifs-et-lit√©raux"><a href="#les-types-primitifs-et-lit%C3%A9raux" class="phenomic-HeadingAnchor">#</a>Les types primitifs et lit√©raux</h2>
<p>Le nombre de types primitifs existants en JavaScript est assez restreint. Vous avez le nombre (<code>number</code>), la chaine de caract√®res (<code>string</code>), les bool√©ens (<code>boolean</code>), et bien √©videmment les valeurs nulles (<code>null</code>) et inexistantes (<code>void</code>).
√Ä noter que ES2015 a √©galement apport√© (<code>Symbol</code>), mais que ce dernier n'est pas encore support√© par flow.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

<span class="hljs-keyword">const</span> a: number = <span class="hljs-number">42</span>;
<span class="hljs-keyword">const</span> b: string = <span class="hljs-string">"Je ne suis pas Coluche, certes"</span>;
<span class="hljs-keyword">const</span> c: boolean = <span class="hljs-literal">true</span>;
<span class="hljs-keyword">const</span> d: <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">const</span> e: <span class="hljs-keyword">void</span> = <span class="hljs-literal">undefined</span>;</code></pre>
<p>Afin de vous montrer plus pr√©cis encore, vous pouvez √©galement utiliser des valeurs lit√©rales comme type. Apr√®s tout <code>string</code>, √ßa peut √™tre tout et n'importe quoi. Si cela peut vous sembler stupide dans un premier temps, ceux-ci sont <strong>extr√™mement</strong> utiles lorsque le syst√®me de typage est suffisamment perfectionn√©, commme vous le verrez par la suite.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

<span class="hljs-keyword">const</span> foo: <span class="hljs-string">"x"</span> = <span class="hljs-string">"x"</span>; <span class="hljs-comment">// pas d'erreur</span>
<span class="hljs-keyword">const</span> bar: <span class="hljs-number">2</span> = <span class="hljs-number">3</span>; <span class="hljs-comment">// erreur! n'est pas √©gal √† 2</span></code></pre>
<h2 id="la-diff√©rence-entre-any-mixed-et-"><a href="#la-diff%C3%A9rence-entre-any-mixed-et-" class="phenomic-HeadingAnchor">#</a>La diff√©rence entre <code>any</code>, <code>mixed</code> et <code>*</code></h2>
<p>Comme expliqu√© au dessus, utiliser <code>any</code> revient √† dire √† flow qu'une variable peut √™tre de n'importe quel type et cela est bien s√ªr extr√™mement dangereux. Heureusement, il existe 2 alternatives plus s√ªres √† conna√Ætre¬†:</p>
<ul>
<li><code>mixed</code> qui dit que peu importe le type de la variable pass√©e √† une fonction, l'appel de celle-ci doit pouvoir se faire correctement: vous ne pourrez donc pas y appeler des m√©thodes sp√©cifiques √† un type de variable en particulier.</li>
<li><code>*</code> qui laisse travailler l'inf√©rence de type de flow.</li>
</ul>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params">arg: mixed</span>) </span>{
  <span class="hljs-built_in">console</span>.log(arg);
} <span class="hljs-comment">// pas d'erreur: peu importe le type r√©el du param√®tre arg, l'appel se fera correctement</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bar</span>(<span class="hljs-params">arg: mixed</span>) </span>{
  <span class="hljs-built_in">console</span>.log(arg.toUpperCase());
} <span class="hljs-comment">// erreur! arg pourrait ne pas √™tre une string</span>

<span class="hljs-keyword">const</span> baz: <span class="hljs-built_in">Array</span>&#x3C;*> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]; <span class="hljs-comment">// inf√©r√© en Array&#x3C;number></span>
baz.push(<span class="hljs-string">"Hello"</span>); <span class="hljs-comment">// "foo" est maintenant inf√©r√© en Array&#x3C;number | string> (tableau de string ou de numbers)</span></code></pre>
<h2 id="les-types-optionnels-ou-maybe-types"><a href="#les-types-optionnels-ou-maybe-types" class="phenomic-HeadingAnchor">#</a>Les types optionnels (ou maybe types)</h2>
<p>Si vous avez d√©j√† utilis√© un langage qui essaye d'√©viter <a href="https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare">l'erreur √† un milliard de dollars</a>, vous connaissez s√ªrement les types <code>Option</code> / <code>Maybe</code>. Ils repr√©sentent la possible absence d'une valeur et sont ici symbolis√©s √† l'aide d'un point d'interrogation.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

<span class="hljs-keyword">let</span> foo: ?string; <span class="hljs-comment">// peut-√™tre une string, null ou undefined</span>
foo = <span class="hljs-string">"foo"</span>; <span class="hljs-comment">// pas d'erreur</span>
foo = <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// pas d'erreur</span>
foo = <span class="hljs-literal">null</span>; <span class="hljs-comment">// pas d'erreur</span>
foo = <span class="hljs-number">3</span>; <span class="hljs-comment">// erreur - number n'est ni une string, ni null, ni undefined</span>

type Bar = {
  baz?: string; <span class="hljs-comment">// baz sera forc√©ment une string si elle est pr√©sente</span>
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrongToUpperCase</span>(<span class="hljs-params">str: ?string</span>) </span>{
  <span class="hljs-keyword">return</span> str.toUpperCase(); <span class="hljs-comment">// erreur, str est possiblement nul, vous devez traiter ce cas</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">correctToUpperCase</span>(<span class="hljs-params">str: ?string</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> str === <span class="hljs-string">"string"</span>) {
    <span class="hljs-keyword">return</span> str.toUpperCase(); <span class="hljs-comment">// pas d'erreur</span>
  }
}</code></pre>
<h2 id="les-types-g√©n√©riques-generics"><a href="#les-types-g%C3%A9n%C3%A9riques-generics" class="phenomic-HeadingAnchor">#</a>Les types g√©n√©riques (generics)</h2>
<p>Vous souvenez-vous de la syntaxe des tableaux (<code>Array&#x3C;any></code>) crois√©e plus t√¥t? Il s'agit de ce qu'on appelle un type g√©n√©rique¬†: un type construit depuis un autre type. Ainsi, si <code>Array&#x3C;any></code> symbolise un tableau de tout et n'importe quoi, <code>Array&#x3C;number></code> symbolisera un tableau de numbers, etc.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

<span class="hljs-comment">// on cr√©e un type Classement qui prend en "param√®tre" un type g√©n√©rique qu'on nomme "T"</span>
type Classement&#x3C;T> = {
  <span class="hljs-attr">first</span>: T,
  <span class="hljs-attr">second</span>: T,
  <span class="hljs-attr">third</span>: T
};

<span class="hljs-keyword">const</span> numberClassement: Classement&#x3C;number> = {
  <span class="hljs-attr">first</span>: <span class="hljs-number">42</span>,
  <span class="hljs-attr">second</span>: <span class="hljs-number">7</span>,
  <span class="hljs-attr">third</span>: <span class="hljs-number">1</span>
};</code></pre>
<p>Voici quelques exemples de types g√©n√©riques disponibles out-of-the-box¬†:</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

<span class="hljs-keyword">const</span> foo: <span class="hljs-built_in">Array</span>&#x3C;number> = [];

<span class="hljs-keyword">const</span> bar: <span class="hljs-built_in">Map</span>&#x3C;number, string> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>();
bar.set(<span class="hljs-number">1</span>, <span class="hljs-string">"one"</span>);

<span class="hljs-keyword">const</span> baz: <span class="hljs-built_in">Set</span>&#x3C;number> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>();
baz.add(<span class="hljs-number">1</span>);

<span class="hljs-keyword">const</span> p: <span class="hljs-built_in">Promise</span>&#x3C;number> = <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">42</span>);</code></pre>
<h2 id="la-manipulation-dobjets"><a href="#la-manipulation-dobjets" class="phenomic-HeadingAnchor">#</a>La manipulation d'objets</h2>
<p>Avez vous remarqu√© que pour le moment, j'ai tent√© de ne pas utiliser d'objets au sein de mes exemples (oui, c'√©tait chiant)? C'est tout simplement car les possibilit√©s de manipulation des types de ceux-ci sont tr√®s nombreuses. Je vous propose un exemple fleuve histoire d'y voir plus clair.</p>
<p>Un type objet se d√©finit de la sorte¬†:</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

type User = {
  <span class="hljs-attr">name</span>: string,
  <span class="hljs-attr">pseudo</span>: string
};

<span class="hljs-keyword">const</span> user: User = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"Mathieu"</span>,
  <span class="hljs-attr">pseudo</span>: <span class="hljs-string">"zoontek"</span>
};

<span class="hljs-comment">// Ce qui n'exclut pas de faire</span>
<span class="hljs-keyword">const</span> newUser: User = {
  ...user,
  <span class="hljs-attr">age</span>: <span class="hljs-number">26</span>
}; <span class="hljs-comment">// pas d'erreur</span></code></pre>
<p>Pour sceller les propri√©t√©s de notre objet, on utilise la notation <code>{||}</code>¬†:</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

type User = {|
  name: string,
  <span class="hljs-attr">pseudo</span>: string
|};

<span class="hljs-keyword">const</span> user: User = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"Mathieu"</span>,
  <span class="hljs-attr">pseudo</span>: <span class="hljs-string">"zoontek"</span>
};

<span class="hljs-keyword">const</span> newUser: User = {
  ...user,
  <span class="hljs-attr">age</span>: <span class="hljs-number">26</span>
}; <span class="hljs-comment">// erreur! la propri√©t√© age n'existe pas</span></code></pre>
<p>Pour indiquer qu'une propri√©t√© de notre objet est immutable, on utilise la notation <code>+</code>. Un must-have pour vos reducers Redux.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

type User = {
  +name: string,
  <span class="hljs-attr">pseudo</span>: string
};

<span class="hljs-keyword">const</span> user: User = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"Mathieu"</span>,
  <span class="hljs-attr">pseudo</span>: <span class="hljs-string">"zoontek"</span>
};

user.name = <span class="hljs-string">"Jean-Michel"</span>; <span class="hljs-comment">// erreur! la valeur de name ne peut-√™tre modifi√©e</span>

<span class="hljs-keyword">const</span> newUser: User = {
  ...user,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"Jean-Michel"</span>
}; <span class="hljs-comment">// pas d'erreur</span></code></pre>
<blockquote>
<p>Le spreading c'est vraiment cool! √áa existe aussi pour les types?</p>
</blockquote>
<p>Yep.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

type Foo = {| a: number, <span class="hljs-attr">b</span>: string |};
type Bar = {| a: string |};
type Baz = {| ...Foo, ...Bar |}; <span class="hljs-comment">// {| a: string, b: string |}</span></code></pre>
<p>Un dernier petit trick sur les objets pour la route? Vous pouvez les utiliser comme maps¬†:</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

<span class="hljs-keyword">const</span> foo: { [key: string]: number } = {
  <span class="hljs-attr">bar</span>: <span class="hljs-number">42</span>,
  <span class="hljs-attr">baz</span>: <span class="hljs-string">"whatever"</span> <span class="hljs-comment">// erreur! les valeurs des propri√©t√©s de cet objet doivent √™tre de type number</span>
};</code></pre>
<h2 id="les-unions-et-intersections-de-types"><a href="#les-unions-et-intersections-de-types" class="phenomic-HeadingAnchor">#</a>Les unions et intersections de types</h2>
<p>Si vous avez remarqu√© la notation avec <code>|</code> plus t√¥t, vous vous posez s√ªrement la question de ce que √ßa repr√©sente. Il s'agit d'une union de types¬†: la variable aura une valeur √† plusieurs types possibles. Petit conseil¬†: utilisez toujours une union de types lit√©raux √† la place du simple <code>string</code> lorsque vous connaissez √† l'avance les possibles valeurs de celui-ci.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sayHelloOrRound</span>(<span class="hljs-params">arg: string | number</span>) </span>{ <span class="hljs-comment">// arg peut √™tre une string ou un number</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> arg === <span class="hljs-string">"string"</span> ? <span class="hljs-string">`Hello <span class="hljs-subst">${arg}</span>`</span> : <span class="hljs-built_in">Math</span>.round(arg);
} <span class="hljs-comment">// pas d'erreur</span>

type Color =
  | <span class="hljs-string">"red"</span>
  | <span class="hljs-string">"green"</span>
  | <span class="hljs-string">"blue"</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toHexadecimal</span>(<span class="hljs-params">color: Color</span>) </span>{
  <span class="hljs-keyword">switch</span> (color) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"red"</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">"#FF0000"</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"green"</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">"#00FF00"</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"blue"</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">"#0000FF"</span>;
  }
}

toHexadecimal(<span class="hljs-string">"red"</span>); <span class="hljs-comment">// pas d'erreur</span>
toHexadecimal(<span class="hljs-string">"green"</span>); <span class="hljs-comment">// pas d'erreur</span>
toHexadecimal(<span class="hljs-string">"blue"</span>); <span class="hljs-comment">// pas d'erreur</span>
toHexadecimal(<span class="hljs-string">"pink"</span>); <span class="hljs-comment">// erreur! "pink" n'est pas une valeur possible</span>
toHexadecimal(<span class="hljs-string">"dog"</span>); <span class="hljs-comment">// erreur! "dog" n'est pas une valeur possible</span></code></pre>
<p>Parfois, une union de types se montre √©galement bien plus efficace pour mod√©liser ce que vous souhaitez, √† contrario d'un tas de maybe types.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

type ApiResponseBadlyTyped = {|
  success: boolean,
  value?: string, <span class="hljs-comment">// value peut √™tre pr√©sent</span>
  error?: <span class="hljs-built_in">Error</span> <span class="hljs-comment">// error peut √™tre pr√©sent</span>
|};

<span class="hljs-keyword">const</span> foo: ApiResponseBadlyTyped = { <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span> }; <span class="hljs-comment">// pas d'erreur alors que j'attends une value</span>
<span class="hljs-keyword">const</span> bar: ApiResponseBadlyTyped = { <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">error</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"oups!"</span>) }; <span class="hljs-comment">// pas d'erreur non plus</span>

type ApiResponseCorrectlyTyped =
  | {| success: <span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>: string |}
  | {| success: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-built_in">Error</span> |};

<span class="hljs-keyword">const</span> foo: ApiResponseCorrectlyTyped = { <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span> }; <span class="hljs-comment">// erreur! il manque value</span>
<span class="hljs-keyword">const</span> bar: ApiResponseCorrectlyTyped = { <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">error</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"oups!"</span>) }; <span class="hljs-comment">// erreur! si success est √† true, on ne doit pas trouver d'error dans notre objet</span>
<span class="hljs-keyword">const</span> baz: ApiResponseCorrectlyTyped = { <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"oups!"</span>) }; <span class="hljs-comment">// pas d'erreur</span></code></pre>
<p>Si les unions de types sont le <strong>OU</strong> logique du syst√®me de typage, les intersections de types en sont le <strong>ET</strong>. On les symbolise √† l'aide d'un <code>&#x26;</code>.</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// @flow</span>

type Foo = { <span class="hljs-attr">a</span>: number };
type Bar = { <span class="hljs-attr">b</span>: string };
type Baz = { <span class="hljs-attr">c</span>: boolean };

<span class="hljs-keyword">const</span> test: Foo &#x26; Bar &#x26; Baz = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">42</span>,
  <span class="hljs-attr">b</span>: <span class="hljs-string">"whatever"</span>,
  <span class="hljs-attr">c</span>: <span class="hljs-literal">true</span>
}; <span class="hljs-comment">// pas d'erreur</span>

<span class="hljs-keyword">let</span> impossible: number &#x26; string; <span class="hljs-comment">// sera forc√©ment impossible √† initialiser¬†: une valeur ne pourra jamais √™tre un number ET une string</span></code></pre>
<p>C'est tout pour le moment! Vous vous doutez que l'on √©gratigne √† peine la surface de ce qui nous est offert par flow et les syst√®mes de typage fort en g√©n√©ral. Si vous √™tes vraiment impatients de d√©couvrir la suite, je vous renvoie vers la <a href="https://flow.org/en/docs/">documentation de flow</a>, tr√®s bien foutue. Pour les autres, on devrait sortir tr√®s prochainement un article sur le m√™me sujet (on y parlera classes, interfaces et peut √™tre m√™me types opaques si vous √™tes sages).</p>
<p>Stay tuned! La bise.</p>
]]></description><link>http://putaindecode.io/fr/articles/js/flow/advanced-part-1/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/js/flow/advanced-part-1/</guid><pubDate>Thu, 23 Nov 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Respecter SemVer (presque) sans avoir √† y penser avec semantic-release]]></title><description><![CDATA[<h2 id="petit-rappel--semver-cest-quoi-d√©j√†-"><a href="#petit-rappel--semver-cest-quoi-d%C3%A9j%C3%A0-" class="phenomic-HeadingAnchor">#</a>Petit rappel : SemVer, c'est quoi d√©j√† ?</h2>
<p>SemVer signifie <strong>Sem</strong>antic <strong>Ver</strong>sionning. C'est une mani√®re de num√©roter
les versions succ√©ssives d'un module. Je vous invite √† aller lire
<a href="http://putaindecode.io/fr/articles/semver/">l'article sur SemVer</a> avant
de lire la suite si vous n'√™tes pas certain de bien comprendre ce que c'est.
Je vais ici citer certaines parties de ce post afin de faire un rapide
r√©sum√© :</p>
<blockquote>
<p>Une version s'applique √† un produit, une application, une biblioth√®que, un OS,
tout ce qui a une progression en informatique. Cela permet de d√©finir
l'avancement du produit. SemVer s'√©crit de cette fa√ßon : X.Y.Z o√π X est
"majeur", Y est "mineur", Z est "patch".</p>
</blockquote>
<blockquote>
<p>SemVer est un contrat que vous signez avec vos utilisateurs, une forme de
respect qui leur permet d'adapter leur code ou non en fonction des versions que
vous proposez.</p>
</blockquote>
<blockquote>
<p>Cela veut dire que si vous avez corrig√© un bug dans votre lib et que cela
n'affecte en rien le code √©crit par votre utilisateur, alors incr√©mentez Z
(+0.0.1).</p>
</blockquote>
<blockquote>
<p>Si vous avez fait des ajouts dans votre app qui peuvent √™tre int√©ressants
pour l'utilisateur et m√©rite une certaine attention afin d'am√©liorer le code
qui utilise votre lib, alors incr√©mentez Y (+0.1.0).</p>
</blockquote>
<blockquote>
<p>Si en revanche, vous avez cass√© ne serait-ce qu'une partie de l'API
("breaking changes"), que vous avez juste chang√© des noms de m√©thodes /
fonctions d√©j√† existantes (et donc s√ªrement utilis√©es par quelqu'un d'autre),
que finalement cela n√©cessite forc√©ment une modification de la part de
l'utilisateur sous peine que sa propre app ne fonctionne plus, alors
incr√©mentez X (+1.0.0).</p>
</blockquote>
<p>Maintenant que nous sommes au point sur SemVer, passons √† la suite.</p>
<h2 id="publier-un-module-sur-npm-manuellement"><a href="#publier-un-module-sur-npm-manuellement" class="phenomic-HeadingAnchor">#</a>Publier un module sur npm manuellement</h2>
<p>Lorsqu'on veut publier un module sur npm, on utilise principalement deux
commandes : <code>npm version</code> et <code>npm publish</code>.</p>
<p><code>npm version</code> nous permet de dire quelle composante de notre num√©ro de version
on souhaite incr√©menter. Ainsi, <code>npm version major</code> augmentera la partie
<code>MAJEUR</code>, <code>npm version minor</code> augmentera la partie <code>MINEUR</code> et <code>npm version patch</code>... je crois que vous l'avez maintenant. La commande cr√©e aussi un tag
git ayant pour nom le num√©ro de version.</p>
<p>Une fois la nouvelle version pr√™te, <code>npm publish</code> permet, vous l'aurez devin√©
(j'esp√®re), de la publier sur npm.</p>
<p>Ce processus semble simple √† premi√®re vue. Selon les modifications qui ont √©t√©
apport√©es au module depuis la derni√®re version, on d√©cide de la composante
SemVer √† incr√©menter, on lance un <code>npm version</code> puis un <code>npm publish</code> et c'est
termin√©. Pourtant, une √©tape du processus implique une d√©cision prise par un
humain, et est donc soumise √† interpr√©tation ainsi qu'√† de potentielles erreurs
ou oublis.</p>
<p>Imaginons : je travaille sur mon super module au nom extr√™mement original
<code>foobar</code>. Celui-ci est actuellement en version <code>1.2.3</code> et plusieurs personnes
ont propos√© des pull requests ajoutant des fonctionnalit√©s et corrigeant des
bugs. Il est temps de publier une nouvelle version de <code>foobar</code> afin que tout le
monde puisse b√©n√©ficier de ces am√©liorations. Je passe en revue ce qui a √©t√©
ajout√©, et je d√©cide d'incr√©menter la composante <code>MINEUR</code> de mon num√©ro de
version. Je publie cette nouvelle version, documente le tout dans une note de
version, je suis heureux.</p>
<p>Manque de chance, quelques temps apr√®s la publication, les issues Github de mon
projet s'affolent. J'ai rat√© une modification non r√©trocompatible, les
utilisateurs de mon module (auxquels je promets de respecter SemVer) se sont
joyeusement empress√©s de faire la mise √† jour dans leur application, et
maintenant tout est cass√©. Sueurs froides, j'√©tais pourtant s√ªr de mon coup, et
maintenant je dois me d√©brouiller pour r√©gler ce probl√®me dans l'urgence.
"Accessoirement", j'ai aussi perdu la confiance que m'accordaient certains
utilisateurs.</p>
<p>Apr√®s avoir r√©gl√© le probl√®me, une question se pose : comment √©viter cela √†
l'avenir ?</p>
<h2 id="semantic-release-pour-ne-plus-se-soucier-de-rien-sauf-de-ce-sur-quoi-on-travaille"><a href="#semantic-release-pour-ne-plus-se-soucier-de-rien-sauf-de-ce-sur-quoi-on-travaille" class="phenomic-HeadingAnchor">#</a>semantic-release, pour ne plus se soucier de rien, sauf de ce sur quoi on travaille</h2>
<p>Eviter ce probl√®me, c'est la promesse de
<a href="https://github.com/semantic-release/semantic-release">semantic-release</a>. Ce
module nous permet de ne plus avoir √† d√©cider nous-m√™me du prochain num√©ro de
version de notre module.</p>
<p>Le principe est simple : √† chaque fois que je fais un commit, je d√©cris dans le
message qui l'accompagne ce que j'ai effectu√© dans celui-ci, dans un format
pr√©cis qui pourra √™tre analys√© automatiquement afin de calculer le prochain
num√©ro de version. C'est un deal entre nous et semantic-release : si on
respecte ce format, il nous garantit de correctement incr√©menter les
diff√©rentes composantes du num√©ro de version, et de publier automatiquement
chaque nouvelle version de notre module.</p>
<p>Par d√©faut, semantic-release se base sur la convention de message de commit du
projet AngularJS, qui propose le format suivant :</p>
<pre><code>&#x3C;type>(&#x3C;scope>): &#x3C;subject>
&#x3C;BLANK LINE>
&#x3C;body>
&#x3C;BLANK LINE>
&#x3C;footer>
</code></pre>
<p>Ainsi, si un commit correspond √† la correction d'un bug, je peux lui attribuer
un message de la forme (exemples tir√©s de la documentation) :</p>
<pre><code>fix(pencil): stop graphite breaking when too much pressure applied
</code></pre>
<p>Dans le cas d'un ajout de fonctionnalit√© :</p>
<pre><code>feat(pencil): add 'graphiteWidth' option
</code></pre>
<p>Et dans le cas d'une modification qui casse la r√©trocompatibilit√© :</p>
<pre><code>perf(pencil): remove graphiteWidth option

BREAKING CHANGE: The graphiteWidth option has been removed. The default
graphite width of 10mm is always used for performance reasons.
</code></pre>
<p>Ainsi, lorsque semantic-release va passer tous les commits en revue, il pourra
analyser le type de chacun d'entre eux, ainsi que rechercher les "BREAKING
CHANGE", afin d'incr√©menter le num√©ro de version comme il se doit.</p>
<p>Petit bonus : semantic-release se charge aussi de vous g√©n√©rer des notes de
version et de les ajouter √† votre release sur Github.</p>
<p>Finalement, en √©crivant de bons messages de commits (ce qui devrait d√©j√† √™tre
le cas, non ?) qui suivent un formalisme pr√©cis, vous vous √©pargnez d'avoir √†
g√©rer vous-m√™me SemVer pour votre module.</p>
<h2 id="mettre-en-place-semantic-release-sur-son-projet"><a href="#mettre-en-place-semantic-release-sur-son-projet" class="phenomic-HeadingAnchor">#</a>Mettre en place semantic-release sur son projet</h2>
<p>Voyons maintenant comment mettre en place semantic-release sur un projet de
module npm.</p>
<p>La premi√®re chose √† faire, c'est d'installer la CLI :</p>
<pre><code>npm install -g semantic-release-cli
</code></pre>
<p>Puis de lancer le setup dans le dossier de votre projet :</p>
<pre><code>semantic-release-cli setup
</code></pre>
<p>semantic-release vous pose alors quelques questions :</p>
<ul>
<li><code>What is your npm registry?</code> : appuyez directement sur entr√©e pour
s√©lectionner le registry npm par d√©faut</li>
<li><code>What is your npm username?</code> : entrez votre username npm</li>
<li><code>What is your npm password?</code> : entrez votre mot de passe npm</li>
<li><code>What is your GitHub username?</code> : entrez votre username GitHub</li>
<li><code>What is your GitHub password?</code> : entrez votre mot de passe GitHub</li>
<li><code>What is your GitHub two-factor authentication code?</code> : si vous avez activ√©
l'authentification √† deux facteurs sur GitHub, entrez le code que vous aurez
re√ßu ici</li>
<li><code>What CI are you using?</code> : nous allons ici utiliser Travis CI, mais vous
pouvez utiliser ce que vous voulez si vous avez un syst√®me de CI particulier.
Pour la suite, il n'y a pas besoin de ma√Ætriser Travis CI ni l'int√©gration
continue en soit. Je vous sugg√®re juste de lire
<a href="http://putaindecode.io/fr/articles/ci/">l'article d'introduction</a> si
le concept d'int√©gration continue ne vous parle pas du tout</li>
<li><code>Do you want a .travis.yml file with semantic-release setup?</code> : Yes !</li>
</ul>
<p>Voil√†, tout est configur√© et pr√™t √† √™tre utilis√© :</p>
<ul>
<li>Un script npm <code>semantic release</code> a √©t√© ajout√© √† votre <code>package.json</code></li>
<li>Le champs <code>version</code> de votre <code>package.json</code> a √©t√© modifi√© en
<code>0.0.0-development</code>. Vous n'aurez plus jamais √† y toucher, c'est
semantic-release qui fera ce travail avant de publier chaque nouvelle version</li>
<li>Un fichier <code>.travis.yml</code> contenant la configuration Travis CI n√©cessaire a
√©t√© cr√©√©. Vous pouvez le modifier selon vos besoins. Dans l'imm√©diat, la chose
urgente est d'adapter la liste des versions de Node sur lesquelles Travis va
lancer vos tests</li>
<li>Votre repository doit √™tre visible sur Travis CI, pr√™t √† lancer un build
lorsque vous ferez un <code>git push</code></li>
<li>Un token npm a √©t√© ajout√© au repository sur Travis CI, pour que celui-ci
puisse s'authentifier lorsqu'il voudra publier une nouvelle version</li>
</ul>
<p><em>Une petite note concernant Travis CI : le but de semantic-release √©tant
d'automatiser le processus de publication d'un module npm, celui-ci va tout
bonnement refuser de se lancer en dehors d'un environnement d'int√©gration
continue. Une configuration de base est fournie, il n'y a donc pas √† se
soucier de √ßa, mais sans int√©gration continue, pas de semantic-release.
C'est pourquoi l'utilisation d'une plateforme d'int√©gration continue vous
est impos√©e.</em></p>
<p>Maintenant que tout est en place, il va falloir travailler un peu, faire
quelques commits afin d'arriver au point o√π on voudra publier une nouvelle
version. Disons que je travaille sur un module <code>math</code> qui impl√©mente
actuellement les fonctions <code>add</code> et <code>substract</code>. Le module est actuellement en
version 1.0.0 sur npm, et un utilisateur m'a remont√© un bug sur la fonction
<code>add</code> lorsqu'on souhaite additionner deux nombres d√©cimaux. Je r√®gle le
probl√®me, et arrive le moment de faire le commit. Selon la convention que nous
avons vu un peu plus t√¥t, celui-ci devra ressembler √† :</p>
<pre><code>fix(add): handle decimal numbers addition
</code></pre>
<p>Semantic-release pourra alors voir que ce commit est une correction de bug, qui
s'applique √† la fonction add, et qui r√®gle un probl√®me d'addition sur des
nombres d√©cimaux. Il pourra donc prendre la d√©cision d'incr√©menter la
composante <code>MINEUR</code> de la version du module.</p>
<p>Satisfait de mon travail pour aujourd'hui, je d√©cide de m'arr√™ter l√†, et je
fais un <code>git push</code>. Travis CI d√©clenchera un build d√®s qu'il aura d√©tect√© ce
nouveau commit sur mon repository GitHub. Celui-ci va donc lancer mes tests, et
si ceux-ci passent, lancera le script npm cr√©√© lors du setup de
semantic-release (<code>npm run semantic-release</code>). Ce script va faire les choses
suivantes :</p>
<ol>
<li>V√©rifier que les conditions d'ex√©cution sont bonnes (par d√©faut, il v√©rifie
qu'on est bien sur Travis CI, sur la branche master et que tous les autres jobs
Travis CI sont bien termin√©s)</li>
<li>R√©cup√©rer le dernier num√©ro de version publi√©</li>
<li>Analyser les commits afin de d√©terminer le num√©ro de la nouvelle version</li>
<li>Publier la nouvelle version (mise √† jour du champ <code>version</code> du
<code>package.json</code> puis <code>npm publish</code>)</li>
<li>G√©n√©rer les notes de version</li>
<li>Cr√©er un tag git ainsi que la release associ√©e sur GitHub</li>
</ol>
<p>Une fois le build Travis CI termin√©, je verrais donc la version <code>1.0.1</code> de
<code>math</code> publi√©e sur npm, un nouveau tag et une nouvelle release (avec les notes
qui y sont associ√©es) disponibles sur GitHub.</p>
<p>Si je d√©cide maintenant d'ajouter les fonctions <code>multiply</code> et <code>divide</code> √† mon
module, et d'effectuer les deux commits suivants :</p>
<pre><code>feat(multiply): add multiply function
</code></pre>
<pre><code>feat(divide): add divide function
</code></pre>
<p>Semantic-release d√©terminera que le prochain num√©ro de version est <code>1.1.0</code>, et
fera le m√™me travail que pr√©c√©demment.</p>
<p>Enfin, si je d√©cide d'impl√©menter une fonction sp√©cifique pour l'addition de
deux nombre d√©cimaux, je ferais le commit suivant :</p>
<pre><code>feat(add): split add function into addInts and addFloats

BREAKING CHANGE: add function has been removed. You must replace it with
addInts or addFloats
</code></pre>
<p>Semantic-release publiera dans ce cas la version <code>2.0.0</code>, parce qu'il d√©tectera
(gr√¢ce au "BREAKING CHANGE") que ce commit contient des modifications non
r√©trocompatibles. Il s'occupera aussi d'ajouter aux notes de version une liste
des changements non r√©trocompatibles.</p>
<h2 id="si-vous-voulez-aller-un-peu-plus-loin"><a href="#si-vous-voulez-aller-un-peu-plus-loin" class="phenomic-HeadingAnchor">#</a>Si vous voulez aller un peu plus loin</h2>
<p>Nous avons jusqu'ici utilis√© semantic-release avec tout ce qu'il propose par
d√©faut. Toutefois celui-ci est bas√© sur un syst√®me de plugins et peut donc √™tre
personnalis√© quasiment de A √† Z. Je ne d√©taillerais pas tout ici, mais chaque
√©tape du processus qui se d√©roule au lancement du script npm <code>semantic-release</code>
ne fait qu'ex√©cuter une liste de plugins qui peuvent tous √™tre remplac√©s. Vous
pouvez ainsi impl√©menter votre propre logique pour chaque √©tape. Un exemple :
√©crire un plugin pour la phase d'analyse des commits afin d'utiliser une
convention diff√©rente de celle d'Angular JS.</p>
<p><a href="https://github.com/semantic-release/semantic-release#plugins">La documentation</a>
explique bien comment √©crire un plugin. Les possibilit√©s sont virtuellement
infinies, libre √† vous d'adapter semantic-release √† votre fa√ßon de travailler et
vos envies.</p>
]]></description><link>http://putaindecode.io/fr/articles/semver/semantic-release/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/semver/semantic-release/</guid><pubDate>Tue, 21 Nov 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[La programmation reactive avec RxJS]]></title><description><![CDATA[<p>La <a href="https://www.reactivemanifesto.org/fr">programmation r√©active</a> est un paradigme de programmation dont le concept repose sur l'√©mission de donn√©es depuis une ou plusieurs sources (producteurs) √† destinations d'autres √©l√©ments appel√©s <em>consommateurs</em>. Elle repose sur le design pattern <a href="http://design-patterns.fr/observateur">Observable - Observer</a>.</p>
<p>Dans ce paradigme, on traite toutes les donn√©es, quelles qu'elles soient, de la m√™me fa√ßon: au travers de flux. Un flux, c'est en gros une structure qui balance une ou plusieurs donn√©es dans le temps au travers d'observables, comme on l'a vu dans le <a href="/fr/articles/js/observable/">post pr√©c√©dent</a>.</p>
<p><img src="https://i.imgur.com/NLqK4bF.png" alt="Programmation R√©active"></p>
<p>Un flux, pour r√©sumer, c'est simplement de la donn√©e qui arrive de mani√®re ordonn√©e dans le temps. Comme expliqu√© pr√©c√©demment, trois types de signaux peuvent √™tre √©mis par un flux : une valeur, une erreur ou un signal de fin indiquant que le flux n'a plus de donn√©es √† envoyer.</p>
<p>L'id√©e des flux, c'est cool, mais comment on manipule √ßa ?</p>
<h2 id="la-biblioth√®que-rxjs"><a href="#la-biblioth%C3%A8que-rxjs" class="phenomic-HeadingAnchor">#</a>La biblioth√®que RxJS</h2>
<p><a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/libraries/main/rx.md">RxJS</a> est l'impl√©mentation JavaScript de <a href="http://reactivex.io/">ReactiveX</a>, <em>extensions-r√©actives</em> en fran√ßais, un projet visant √† impl√©menter sous la forme de biblioth√®que les outils n√©cessaire pour utiliser le paradigme r√©actif dans de multiples languages.
Aussi appel√© le <strong>Lodash</strong> des donn√©es asynchrones, il impl√©mente la notion d'observables-observer et fournit tout un panel d'op√©rateurs pour travailler avec les donn√©es qui y passent.</p>
<p>Vous pourrez facilement int√©grer progressivement Rx √† votre codebase √† l'aide d'op√©rateurs tels que <code>Rx.from</code> (qui cr√©e un observable √† partir d'une valeur synchrone), <code>Rx.fromEvent</code> (qui va carr√©ment √©couter les √©venement DOM d'un √©lement pour en faire un observable), <code>Rx.fromPromise</code>, <code>Rx.Ajax</code> et bien d'autres.</p>
<p>Exemple tout simple : on va compter le nombre de clics sur un bouton.</p>
<pre><code class="hljs language-JavaScript"><span class="hljs-keyword">const</span> Rx = <span class="hljs-built_in">require</span>(<span class="hljs-string">'rxjs'</span>)

<span class="hljs-comment">// on √©coute les clics</span>
<span class="hljs-keyword">const</span> button$ = Rx.Observable.fromEvent(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"button"</span>), <span class="hljs-string">"click"</span>)
  <span class="hljs-comment">// scan est l'√©quivalent de reduce ; il va garder l'accumulateur et retourner le nouveau √† chaque clic</span>
  .scan(<span class="hljs-function"><span class="hljs-params">count</span> =></span> count + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>)
  .subscribe(<span class="hljs-function"><span class="hljs-params">clickCount</span> =></span> {
    <span class="hljs-comment">// on met √ßa dans le DOM √† chaque changement</span>
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"count"</span>).innerHTML = <span class="hljs-string">"You clicked "</span> + clickCount + <span class="hljs-string">" times"</span>
  })</code></pre>
<p>Si vous vous demandez pourquoi <code>button$</code> et pas <code>button</code>, c'est que le suffixe <strong>$</strong> est une convention montrant qu'il s'agit d'un flux.</p>
<p>La programmation r√©active peut √™tre compliqu√©e √† se repr√©senter, ainsi, pour mieux la visualiser, il existe les <a href="http://rxmarbles.com/"><code>marbles diagrams</code></a> qui vous permettront de mettre en rapport entr√©e et sortie de chaque transformation de la data avec une id√©e plus concr√®te que de simples bouts de code.</p>
<p>Le c≈ìur de la programmation r√©active, c'est de concevoir votre programme comme quelque chose qui est valable √† n'importe quel point dans le temps, et c'est son avantage principal. Si une donn√©e change, toutes les parties de votre programme l'utilisant en seront notifi√©es et pourront agir en cons√©quence.</p>
<p>Si vos programmes r√©cup√®rent des donn√©es de mani√®re asynchrone (et il y a de fortes chances pour que ce soit le cas), √ßa peut valoir le coup de jeter un ≈ìil √† ce paradigme, vous pourrez peut-√™tre vous enlever un paquet d'√©pines du pied.</p>
<p>Dans le prochain chapitre, nous verrons les cas d'usages des Observables au sein d'une application React/Redux.</p>
]]></description><link>http://putaindecode.io/fr/articles/js/observable/programmation-reactive/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/js/observable/programmation-reactive/</guid><pubDate>Thu, 16 Nov 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Top 10 des snippets pour d√©molir le runtime JavaScript]]></title><description><![CDATA[<p>(ou juste faire une blague √† vos coll√®gues)</p>
<h2 id="10-larray-vide-magique"><a href="#10-larray-vide-magique" class="phenomic-HeadingAnchor">#</a>10. L'array vide magique</h2>
<p>Cette technique fonctionne grace √† l'h√©ritage prototypal et au fait que pour une obscure raison, <code>Array.prototype</code> est un array (qui h√©rite de lui m√™me, allez savoir). Il suffit d'appeler une des m√©thodes mutatives d'<code>Array.prototype</code> sur lui-m√™me :</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">Array</span>.prototype.push(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);</code></pre>
<p>Puisque dans le corps de <code>Array.prototype.push()</code>, <code>this</code> correspond √† <code>Array.prototype</code>, c'est dans celui-ci que seront inject√©s les √©l√©ments.</p>
<pre><code class="hljs language-javascript">[][<span class="hljs-number">0</span>] <span class="hljs-comment">// 1</span></code></pre>
<p>Et hop. √Ä noter que vu l'impl√©mentation de la plupart des fonctions travaillant avec des <em>arrays</em>, √ßa devrait pas causer grand dommage puisque <code>length</code> est g√©r√© au niveau de l'array, et pas de son prototype. Ceci-dit √ßa peut surprendre en faisant mumuse dans la console.</p>
<h2 id="9-lobjet-magique"><a href="#9-lobjet-magique" class="phenomic-HeadingAnchor">#</a>9. L'objet magique</h2>
<p>Souvent, dans une boucle <code>for(name in object)</code>, on appelle <code>object.hasOwnProperty(name)</code> pour v√©rifier si la propri√©t√© appartient bien √† l'objet et qu'il ne s'agit pas juste d'un truc h√©rit√©.</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">Object</span>.prototype.hasOwnProperty = <span class="hljs-function"><span class="hljs-params">()</span> =></span> <span class="hljs-literal">true</span>;
<span class="hljs-comment">// peut se combiner avec un petit</span>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &#x3C; <span class="hljs-number">10</span>; index++) {
  <span class="hljs-built_in">Object</span>.prototype[index] = <span class="hljs-literal">undefined</span>;
};</code></pre>
<p>M√™me concept que pour l'exemple pr√©c√©dent, avec l'h√©ritage prototypal. Le petit c√¥t√© rigolo ici, c'est que c'est un pattern tr√®s courant en JavaScript, notamment dans les biblioth√®ques que vous utilisez probablement. Et c'est l√† qu'on se rend compte que de mettre la fonction qui v√©rifie si une propri√©t√© est h√©rit√©e ou non dans l'h√©ritage, c'est pas forc√©ment l'id√©e du si√®cle.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">let</span> object = {};
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> object) {
  <span class="hljs-keyword">if</span>(object.hasOwnProperty(object)) {
    <span class="hljs-built_in">console</span>.log(key)
  }
}
<span class="hljs-comment">// 0, 1, 2, 3, 4, 5, 6, 7, 8, 9</span></code></pre>
<h2 id="8-le-dom-fou"><a href="#8-le-dom-fou" class="phenomic-HeadingAnchor">#</a>8. Le DOM fou</h2>
<p>Celui-l√† est plut√¥t sympa quand vous ou vos biblioth√®ques DOM de pr√©dilection touchez un peu aux √©lements. Vu que l'appel √† <code>Math.random()</code> rend l'op√©ration aussi d√©terministe que l'application de styles assign√©s √† des s√©lecteurs CSS charg√©s de mani√®re asynchrone, vous risquez de jolies surprises.</p>
<pre><code class="hljs language-javascript">Element.prototype.appendChild = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element</span>) </span>{
 ¬†<span class="hljs-keyword">return</span> Element.prototype.insertBefore.call(
    <span class="hljs-keyword">this</span>,
    element,
    <span class="hljs-keyword">this</span>.childNodes[<span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-keyword">this</span>.childNodes.length)]
  )
};</code></pre>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &#x3C; <span class="hljs-number">10</span>; index++) {
  <span class="hljs-built_in">document</span>.body.appendChild(<span class="hljs-built_in">document</span>.createTextNode(<span class="hljs-built_in">String</span>(index)))
};
<span class="hljs-comment">// "1895234760" (par exemple)</span></code></pre>
<h2 id="7-simple-mais-efficace-faire-de-la-console-une-no-op"><a href="#7-simple-mais-efficace-faire-de-la-console-une-no-op" class="phenomic-HeadingAnchor">#</a>7. Simple mais efficace, faire de la console une no-op</h2>
<p>Bizarrement, j'ai d√©j√† vu des sites qui faisaient √ßa en production (e.g. Twitter si je me rappelle correctement). Vous rendez inop√©rable la console, ce qui peut faire une tr√®s bonne blague √† vos coll√®gues en cachant √ßa dans un vieux commit avec l'option <code>amend</code>.</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">Object</span>.keys(<span class="hljs-built_in">console</span>).forEach(<span class="hljs-function"><span class="hljs-params">key</span> =></span> {
  <span class="hljs-built_in">console</span>[key] = <span class="hljs-function"><span class="hljs-params">()</span> =></span> {}
});</code></pre>
<h2 id="6-supprimer-les-stack-traces-des-erreurs"><a href="#6-supprimer-les-stack-traces-des-erreurs" class="phenomic-HeadingAnchor">#</a>6. Supprimer les stack traces des erreurs</h2>
<p>L√†, on est vraiment sur le petit truc horrible, parce que vous pouvez mettre un petit moment avant de le r√©aliser. Le constructeur <code>Error</code> vient normalement ajouter une propri√©t√© <code>stack</code> qui vous permet de retrouver le chemin qu'a emprunt√© le code avant de jeter une erreur. Eh ben fini, √† vous le debug √† l'aveugle !</p>
<pre><code class="hljs language-javascript">(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Error</span>(<span class="hljs-params">message</span>) </span>{
    <span class="hljs-keyword">this</span>.message = message;
  }
  <span class="hljs-built_in">Error</span>.prototype = <span class="hljs-built_in">window</span>.Error.prototype;
  <span class="hljs-built_in">window</span>.Error = <span class="hljs-built_in">Error</span>;
})();</code></pre>
<h2 id="5-rendre-lasynchrone-synchrone"><a href="#5-rendre-lasynchrone-synchrone" class="phenomic-HeadingAnchor">#</a>5. Rendre l'asynchrone synchrone</h2>
<p>Il est assez courrant d'avoir des <code>setTimeout(func)</code> ou <code>setTimeout(func, 0)</code> (les deux sont √©quivalents). √áa permet s'assurer qu'on d√©cale un peu l'execution d'une fonction, et souvent de s'assurer que si elle jette une erreur, elle n'emp√™chera pas le reste de s'executer.</p>
<pre><code class="hljs language-javascript">(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {
  <span class="hljs-keyword">let</span> originalTimeout = <span class="hljs-built_in">window</span>.setTimeout;
  <span class="hljs-built_in">window</span>.setTimeout = <span class="hljs-function">(<span class="hljs-params">func, duration, ...args</span>) =></span> !duration ? func(...args) : originalTimeout.call(<span class="hljs-built_in">window</span>, func, duration, ...args);
})()</code></pre>
<p>Avec ce snippet, petites surprises bizarres assur√©es. Et c'est un bug pr√©sent dans quelques biblioth√®ques impl√©mentant une fonction <code>domReady</code>, et qui font:</p>
<pre><code class="hljs language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">domReady</span>(<span class="hljs-params">func</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.readyState === <span class="hljs-string">"complete"</span>) {
    func()
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">"DOMContentLoaded"</span>, func)
  }
}</code></pre>
<p>Avec une impl√©mentation comme celle qu'on voit au dessus, <code>func</code> aura un comportement diff√©rent si le DOM est charg√© ou non:</p>
<pre><code class="hljs language-javascript">domReady(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>()
})
<span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>)
<span class="hljs-comment">// Logue 1 si le DOM est pr√™t, parce que l'execution de func par le handler DOMContentLoaded est asynchrone</span>
<span class="hljs-comment">// Logue rien du tout si func() est appel√© en synchrone par la premi√®re branche de domReady</span></code></pre>
<h2 id="4-le-r√©seau-qui-ne-r√©pond-jamais"><a href="#4-le-r%C3%A9seau-qui-ne-r%C3%A9pond-jamais" class="phenomic-HeadingAnchor">#</a>4. Le r√©seau qui ne r√©pond jamais</h2>
<p>Les <code>Promise</code>, c'est bien relou √† d√©bugger lorsque √ßa reste infiniment en "pending": on ne sait pas forc√©ment pourquoi, surtout si c'est derri√®re une API opaque, comme <code>fetch</code>. Plaisir garanti, parce qu'avec √ßa sur la page, c'est probablement le dernier endroit o√π on va intuitivement chercher la source la bug.</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">window</span>.fetch = <span class="hljs-function"><span class="hljs-params">()</span> =></span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {})</code></pre>
<h2 id="3-faire-marcher-les-event-listener-au-hasard"><a href="#3-faire-marcher-les-event-listener-au-hasard" class="phenomic-HeadingAnchor">#</a>3. Faire marcher les event listener au hasard</h2>
<p>C'est particuli√®rement horrible quand un bug n'est pas reproduit √† tous les coups: pourquoi ne pas attacher les √©venements au hasard ?</p>
<pre><code class="hljs language-javascript">(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {
  <span class="hljs-keyword">let</span> originalAddEventListener = Element.prototype.addEventListener
  Element.prototype.addEventListener = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) </span>{
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Math</span>.random() &#x3C; <span class="hljs-number">0.75</span>) {
      originalAddEventListener.call(<span class="hljs-keyword">this</span>, ...args)
    }
  };
})();</code></pre>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">"click"</span>, () => <span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>));
<span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">"click"</span>, () => <span class="hljs-built_in">console</span>.log(<span class="hljs-number">2</span>));
<span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">"click"</span>, () => <span class="hljs-built_in">console</span>.log(<span class="hljs-number">3</span>));
<span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">"click"</span>, () => <span class="hljs-built_in">console</span>.log(<span class="hljs-number">4</span>));
<span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">"click"</span>, () => <span class="hljs-built_in">console</span>.log(<span class="hljs-number">5</span>));</code></pre>
<h2 id="2-faire-foirer-parseint-de-temps-en-temps"><a href="#2-faire-foirer-parseint-de-temps-en-temps" class="phenomic-HeadingAnchor">#</a>2. Faire foirer parseInt de temps en temps</h2>
<pre><code class="hljs language-javascript">(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {
  <span class="hljs-keyword">let</span> originalParseInt = <span class="hljs-built_in">window</span>.parseInt;
  <span class="hljs-built_in">window</span>.parseInt = <span class="hljs-function">(<span class="hljs-params">n</span>) =></span> <span class="hljs-built_in">Math</span>.random() > <span class="hljs-number">0.9</span> ? originalParseInt(n) : <span class="hljs-literal">NaN</span>;
})()</code></pre>
<p>Pour un bon petit moment √† pas comprendre ce qui se passe. Je suis s√ªr que <code>NaN</code> n'est pas toujours g√©r√© dans tous les cas dans la plupart des scripts qui tournent aujourd'hui en prod.</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">parseInt</span>(<span class="hljs-string">"1"</span>) <span class="hljs-comment">// 1</span>
<span class="hljs-built_in">parseInt</span>(<span class="hljs-string">"1"</span>) <span class="hljs-comment">// NaN</span></code></pre>
<h2 id="1-deserialiser-les-url"><a href="#1-deserialiser-les-url" class="phenomic-HeadingAnchor">#</a>1. (De)serialiser les URL</h2>
<p>Pour ce coup, c'est bien de pr√©voir les deux fonctions utilis√©es par tout le monde pour encoder et d√©coder les URLs. Vu que si l'une ne marche pas, le reflexe est souvent de tester la deuxi√®me, bon arrachage de cheveux en perspective.</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">window</span>.decodeURIComponent = <span class="hljs-built_in">window</span>.encodeURIComponent = <span class="hljs-built_in">window</span>.escape = <span class="hljs-built_in">window</span>.unescape = <span class="hljs-function">(<span class="hljs-params">a</span>) =></span> <span class="hljs-built_in">String</span>(a)</code></pre>
<h2 id="bonus-pour-rendre-tout-√ßa-cr√©dible"><a href="#bonus-pour-rendre-tout-%C3%A7a-cr%C3%A9dible" class="phenomic-HeadingAnchor">#</a>Bonus: pour rendre tout √ßa cr√©dible</h2>
<p>Si dans la console de d√©veloppement, vous tapez le nom d'une fonction accessible dans le scope, le navigateur va appeler <code>Function.prototype.toString</code> sur cette fonction pour en r√©cup√©rer l'allure. Couvrez vos arri√®res en repla√ßant la m√©thode :</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">Function</span>.prototype.toString = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">`function <span class="hljs-subst">${ <span class="hljs-keyword">this</span>.name || <span class="hljs-string">""</span> }</span>() {
    [native code]
}`</span>
}</code></pre>
<pre><code class="hljs language-javascript">(<span class="hljs-function"><span class="hljs-params">()</span> =></span> {})
<span class="hljs-comment">/* function () {
    [native code]
} */</span></code></pre>
<p>Pour faire un peu de z√®le, vous pouvez √©galement d√©clarer ces fonctions dans un <code>eval</code> pour brouiller les pistes sur l'endroit o√π elles ont √©t√© d√©clar√©es.</p>
<p>Voil√†, vous avez toutes les cl√©s pour faire des petites blagues √† vos coll√®gues.</p>
<p>Et n'oubliez pas, JavaScript c'est super, mais faisez gaffe quand m√™me, parce que dans un langage encourageant la mutabilit√©, qui utilise des globales et de l'h√©ritage par dessus le march√©, il suffit d'un petit bout de code innocent pour que plus rien ne marche.</p>
<p>Bisous.</p>
]]></description><link>http://putaindecode.io/fr/articles/js/top-10-snippets-demolir-runtime/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/js/top-10-snippets-demolir-runtime/</guid><pubDate>Mon, 13 Nov 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[ReasonReact, pour une UI qu'elle est bien typ√©e]]></title><description><![CDATA[<p>Si comme moi, depuis l‚Äôapparition de React, vous vous √™tes de plus en int√©ress√©s au typage pour vos applications front (c'est √ßa de commencer avec JS‚Ä¶), vous avez certainement utilis√© les <code>propTypes</code> au d√©but en vous disant "putain c'est cool de v√©rifier les types, √ßa m'√©vite bien des probl√®mes". Puis c‚Äô√©tait sympa mais bon, faut quand m√™me ex√©cuter le bout de code qui p√®te et il est peut-√™tre super chiant d'y acc√©der dans l'app. Du coup, vous vous √™tes s√ªrement tourn√©s vers Flow ou TypeScript.</p>
<p>Dans cet article, on va d√©couvrir la <em>next-step</em> dans ce cheminement : √©crire nos composants React dans un langage statiquement et fortement typ√©: Reason üöÄ. Reason, c'est OCaml, avec son type-system puissant et une syntaxe plus simple quand on vient du JS. Si vous n‚Äôavez pas lu <a href="/fr/articles/reason/introduction-reason/">l‚Äôintroduction √† ce langage</a>, c‚Äôest le moment.</p>
<p>L√†, je vais vous pr√©senter <strong>ReasonReact</strong>, des bindings API par dessus React support√©s officiellement par l'√©quipe de Reason. Facebook <em>dogfood</em> la solution puisqu'elle est utilis√©e sur messenger.com pour la majeure partie de ses composants.</p>
<h2 id="stateless"><a href="#stateless" class="phenomic-HeadingAnchor">#</a>Stateless</h2>
<p>Commen√ßons par le traditionnel HelloWorld‚Ñ¢ :</p>
<pre><code class="hljs language-js"><span class="hljs-comment">/* Un composant ReasonReact se cr√©e en deux temps: d'abord on cr√©e le `component`
   √† partir d‚Äôun appel √† `statelessComponent` ou `reducerComponent` (il existe d'autres
   cas plus avanc√©s, mais on s'y attardera pas dans cet article d'introduction). */</span>
<span class="hljs-keyword">let</span> component = ReasonReact.statelessComponent(<span class="hljs-string">"HelloWorld"</span>);

<span class="hljs-comment">/* Ensuite, on d√©clare une fonction `make` qui prend des arguments nomm√©s
   (qui √©quivalent aux `props` de React) et un dernier argument non-nomm√©,
   contenant les `children`. Cette fonction doit retourner un record, dans
   lequel on spread notre `component` et dans lequel on d√©finit une propri√©t√©
   `render` qui prend comme param√®tre `self` (√©quivalent du `this`) et qui retourne
   un √©l√©ment React. L√†-dessus √ßa devrait pas trop vous chambouler de ce que
   vous connaissez de React.
   On peut remarquer que les props sont les arguments de la fonction `make`,
   comme avec les composants fonctionnels de React.*/</span>
<span class="hljs-keyword">let</span> make = <span class="hljs-function">(<span class="hljs-params">~message, _children</span>) =></span> {
  ...component,
  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">_self</span>) =></span>
    &#x3C;div>
      (ReasonReact.stringToElement message)
    &#x3C;<span class="hljs-regexp">/div>
};</span></code></pre>
<p>Et pour monter le composant :</p>
<pre><code class="hljs language-js">ReactDOMRe.renderToElementWithId(<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">HelloWorld</span> <span class="hljs-attr">message</span>=<span class="hljs-string">"Helloworld"</span> /></span>, "root");</span></code></pre>
<p>Un des gros avantages √† utiliser Reason, c‚Äôest que le langage est capable d‚Äôinf√©rer la grande majorit√© des types et sera en mesure de d√©tecter dans toute l‚Äôapp si quelque chose n‚Äôest pas pass√© correctement : pour le langage, il s‚Äòagit simplement de fonctions qui appellent d‚Äôautres fonctions, et les langages fonctionnels statiquement et fortement typ√©s sont plut√¥t pas d√©gueulasses pour √ßa.</p>
<h2 id="stateful"><a href="#stateful" class="phenomic-HeadingAnchor">#</a>Stateful</h2>
<p>La petite particularit√© de ReasonReact vis √† vis des composants stateful, c‚Äôest que les mises √† jour d'√©tats doivent passer par un reducer, comme si chaque composant embarquait sa petite impl√©mentation de redux.</p>
<p>Maintenant, comment qu'on fait pour cr√©er un composant stateful ?</p>
<p>On commence par d√©finir le type du state : contrairement √† JS, il ne s'agit pas forc√©ment d'un objet, √ßa peut √™tre une cha√Æne de caract√®re, un entier, un variant, un boolean, un arbuste, une map, un jus de fruits frais, un tableau, whatever.</p>
<pre><code class="hljs language-js">type state = {
  <span class="hljs-attr">counter</span>: int
};</code></pre>
<p>On va d√©finir notre type action, sous la forme de variants: chaque variant repr√©sente un des type d‚Äôaction possible. Pour bien se repr√©senter ce qu'est une action, c‚Äôest un token, contenant possiblement des param√®tres, qu‚Äôon va envoyer √† notre fameux reducer qui, lui, retournera une r√©action √† cette action.</p>
<pre><code class="hljs language-js">type action =
  | Increment
  | Decrement;</code></pre>
<p>Dans le composant retourn√© par <code>make</code>, on ajoute une fonction <code>initialState</code> qui retourne‚Ä¶ l'√©tat initial (c'est bien, vous suivez), et une fonction <code>reducer</code>, qui effectue un pattern-matching sur l‚Äôaction et retourne une update.
Cette fonction prend deux param√®tres: l'<code>action</code> √† traiter et le <code>state</code> √† jour (comme lorsque l'on passe un callback √† <code>setState</code> dans l'√©quivalent JavaScript <code>setState(state => newState)</code>).</p>
<p>L‚Äôupdate retourn√©e indique au component comment il doit se mettre √† jour (ici sont list√©s les cas courants) :</p>
<ul>
<li><code>NoUpdate</code>, pour ne rien faire</li>
<li><code>Update</code>, pour mettre √† jour l‚Äô√©tat et re-rendre le composant</li>
<li><code>SideEffect</code> pour lancer un effet de bord (e.g. une requ√™te r√©seau)</li>
<li><code>UpdateWithSideEffect</code>, pour changer le state et lancer un effet de bord (e.g. afficher un loader et lancer une requ√™te)</li>
</ul>
<p><em>Wrapping up</em> :</p>
<pre><code class="hljs language-js">type state = {<span class="hljs-attr">counter</span>: int};

type action =
  | Increment
  | Decrement;

<span class="hljs-comment">/* Il faut bien d√©finir le `component` **apr√®s** les types `state` et `action`, pour qu'il puisse les lire */</span>
<span class="hljs-keyword">let</span> component = ReasonReact.reducerComponent(<span class="hljs-string">"Count"</span>);

<span class="hljs-keyword">let</span> make = <span class="hljs-function">(<span class="hljs-params">~initialCounter=<span class="hljs-number">0</span>, _</span>) =></span> {
  ...component,
  <span class="hljs-attr">initialState</span>: <span class="hljs-function"><span class="hljs-params">()</span> =></span> {<span class="hljs-attr">counter</span>: initialCounter},
  <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">action, state</span>) =></span>
    <span class="hljs-comment">/* Toutes mes updates passent par l√†, bien pratique pour qu'une
      personne puisse aborder rapidement le composant */</span>
    <span class="hljs-keyword">switch</span> action {
    | <span class="hljs-function"><span class="hljs-params">Increment</span> =></span> ReasonReact.Update({<span class="hljs-attr">counter</span>: state.counter + <span class="hljs-number">1</span>})
    | <span class="hljs-function"><span class="hljs-params">Decrement</span> =></span> ReasonReact.Update({<span class="hljs-attr">counter</span>: max(<span class="hljs-number">0</span>, state.counter - <span class="hljs-number">1</span>)})
    },
  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">{state, reduce}</span>) =></span>
    &#x3C;div>
      (ReasonReact.stringToElement(state.counter |> string_of_int))
      <span class="hljs-comment">/* La fonction reduce prend une fonction qui retourne l'action.
           Il s'agit d'une fonction pour lire les propri√©t√©s des
           events (qui sont pooled dans React) de mani√®re synchrone, alors
           que le reducer est appel√© de mani√®re asynchrone.
         */</span>
      &#x3C;button onClick=<span class="hljs-function">(<span class="hljs-params">reduce((_event</span>) =></span> Decrement))> (ReasonReact.stringToElement(<span class="hljs-string">"-"</span>)) &#x3C;<span class="hljs-regexp">/button>
      &#x3C;button onClick=(reduce((_event) => Increment))> (ReasonReact.stringToElement("+")) &#x3C;/</span>button>
    <span class="xml"><span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>
};</code></pre>
<p>et hop:</p>
<pre><code class="hljs language-js">ReactDOM.renderToElementWithId(<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">Count</span> <span class="hljs-attr">initialCount</span>=<span class="hljs-string">0</span> /></span>, "App");</span></code></pre>
<h2 id="with-side-effects"><a href="#with-side-effects" class="phenomic-HeadingAnchor">#</a>With side-effects</h2>
<p>Bien que √ßa puisse para√Ætre un peu lourd de devoir faire un <code>reducer</code> pour g√©rer ses updates, √ßa apporte quand m√™me:</p>
<ul>
<li>Un seul endroit par composant o√π toutes les updates passent</li>
<li>La possibilit√© pour le compiler de d√©tecter si l'on oublie de g√©rer des actions</li>
<li>De g√©rer lisiblement et uniform√©ment les effets de bord</li>
</ul>
<p><img src="./terminal.png" alt="" /></p>
<p>Exemple ici avec un composant o√π on va faire comme si on r√©cup√©rait l'utilisateur connect√© sur une API.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> resolveAfter = <span class="hljs-function">(<span class="hljs-params">ms</span>) =></span>
  Js.Promise.make(
    <span class="hljs-function">(<span class="hljs-params">~resolve, ~reject <span class="hljs-keyword">as</span> _</span>) =></span> ignore(Js.Global.setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =></span> [@bs] resolve(ms), ms))
  );

<span class="hljs-built_in">module</span> User = {
  type t = {<span class="hljs-attr">username</span>: string};
  <span class="hljs-comment">/* faisons comme si on avait un appel serveur
     (je le fais comme √ßa pour que vous puissiez copier/coller le code
     pour essayer chez vous) */</span>
  <span class="hljs-keyword">let</span> getUser = <span class="hljs-function">(<span class="hljs-params">_</span>) =></span>
    resolveAfter(<span class="hljs-number">1000</span>)
    |> Js.Promise.then_(
         <span class="hljs-function">(<span class="hljs-params">_</span>) =></span>
           Js.Promise.resolve({
             <span class="hljs-attr">username</span>: <span class="hljs-string">"MyUsername"</span> ++ string_of_int(Js.Math.random_int(<span class="hljs-number">0</span>, <span class="hljs-number">9999</span>))
           })
       );
};

<span class="hljs-comment">/* Le "user" distant peut avoir 4 √©tats possibles ici */</span>
type resource(<span class="hljs-string">'a) =
  | Inactive
  | Loading
  | Idle('</span>a)
  | Errored;

type action =
  | Load
  | Receive(resource(User.t));

type state = {<span class="hljs-attr">user</span>: resource(User.t)};

<span class="hljs-keyword">let</span> component = ReasonReact.reducerComponent(<span class="hljs-string">"User"</span>);

<span class="hljs-keyword">let</span> getUser = <span class="hljs-function">(<span class="hljs-params">credentials, {ReasonReact.reduce}</span>) =></span>
  ignore(
    User.getUser(credentials)
    <span class="hljs-comment">/* Si tout s'est bien pass√© */</span>
    |> Js.Promise.then_(
         <span class="hljs-comment">/* On peut utiliser les actions en dehors du `make`: c'est juste des variants */</span>
         (payload) => Js.Promise.resolve(reduce(<span class="hljs-function">(<span class="hljs-params">payload</span>) =></span> Receive(Idle(payload)), payload))
       )
    <span class="hljs-comment">/* Si √ßa a merd√© */</span>
    |> Js.Promise.catch(<span class="hljs-function">(<span class="hljs-params">_</span>) =></span> Js.Promise.resolve(reduce(<span class="hljs-function"><span class="hljs-params">()</span> =></span> Receive(Errored), ())))
  );

<span class="hljs-keyword">let</span> make = <span class="hljs-function">(<span class="hljs-params">~credentials, _</span>) =></span> {
  ...component,
  <span class="hljs-attr">initialState</span>: <span class="hljs-function"><span class="hljs-params">()</span> =></span> {<span class="hljs-attr">user</span>: Inactive},
  <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">action, _state</span>) =></span>
    <span class="hljs-keyword">switch</span> action {
    <span class="hljs-comment">/* UpdateWithSideEffects met √† jour l'√©tat, puis lance l'effet de bord,
       tr√®s pratique pour ce genre de cas */</span>
    | <span class="hljs-function"><span class="hljs-params">Load</span> =></span> ReasonReact.UpdateWithSideEffects({<span class="hljs-attr">user</span>: Loading}, getUser(credentials))
    | Receive(user) => ReasonReact.Update({<span class="hljs-attr">user</span>: user})
    },
  <span class="hljs-attr">didMount</span>: <span class="hljs-function">(<span class="hljs-params">{reduce}</span>) =></span> {
    reduce(<span class="hljs-function"><span class="hljs-params">()</span> =></span> Load, ());
    ReasonReact.NoUpdate
  },
  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">{state, reduce}</span>) =></span>
    &#x3C;div>
      (
        ReasonReact.stringToElement(
          <span class="hljs-keyword">switch</span> state.user {
          | Inactive
          | <span class="hljs-function"><span class="hljs-params">Loading</span> =></span> <span class="hljs-string">"Loading ..."</span>
          | Idle(user) => <span class="hljs-string">"Hello "</span> ++ user.username
          | <span class="hljs-function"><span class="hljs-params">Errored</span> =></span> <span class="hljs-string">"An error occured"</span>
          }
        )
      )
      &#x3C;div>
        <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">button</span>
          <span class="hljs-attr">disabled</span>=<span class="hljs-string">(</span>
            <span class="hljs-attr">switch</span> <span class="hljs-attr">state.user</span> {
            | <span class="hljs-attr">Idle</span>(<span class="hljs-attr">_</span>) =></span> Js.false_
            | _ => Js.true_
            }
          )
          onClick=(reduce((_) => Load))>
          (ReasonReact.stringToElement("Reload"))
        <span class="hljs-tag">&#x3C;/<span class="hljs-name">button</span>></span></span>
      &#x3C;<span class="hljs-regexp">/div>
    &#x3C;/</span>div>
};</code></pre>
<h2 id="oui-mais-est-ce-que-je-peux-lutiliser-aujourdhui-alors-que-jai-d√©j√†-une-grosse-codebase-react-"><a href="#oui-mais-est-ce-que-je-peux-lutiliser-aujourdhui-alors-que-jai-d%C3%A9j%C3%A0-une-grosse-codebase-react-" class="phenomic-HeadingAnchor">#</a>Oui mais est-ce que je peux l'utiliser aujourd'hui alors que j'ai d√©j√† une grosse codebase React ?</h2>
<p><img src="./tenor.gif" alt="" /></p>
<p>Pour utiliser des composants ReasonReact avec React</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> jsComponent =
  ReasonReact.wrapReasonForJs(
    ~component,
    (jsProps) =>
      make(
        ~credentials=jsProps##credentials,
        [||]
      )
  );</code></pre>
<p>et</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> MyComponent = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path/to/reason/output"</span>).jsComponent;</code></pre>
<p>√Ä l'inverse, pour utiliser des composants React avec ReasonReact</p>
<pre><code class="hljs language-js">[@bs.module <span class="hljs-string">"path/to/good/old/reactjs/component"</span>] external myJsComponent : ReasonReact.reactClass = <span class="hljs-string">"default"</span>;

<span class="hljs-keyword">let</span> make = <span class="hljs-function">(<span class="hljs-params">~message: string, _children</span>) =></span>
  ReasonReact.wrapJsForReason(
    ~reactClass=myJsComponent,
    ~props={<span class="hljs-string">"message"</span>: message},
    [||]
 ¬†);</code></pre>
<p>Voil√† pour les <em>basics</em> de ReasonReact. Pour en savoir plus, y a <a href="https://reasonml.github.io/reason-react/">la petite doc qui va bien</a>, et on vous pr√©parera un petit article sur les aspects un peu plus avanc√©s de l'usage.</p>
<p>Bisous bisous.</p>
]]></description><link>http://putaindecode.io/fr/articles/reason/reasonreact/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/reason/reasonreact/</guid><pubDate>Thu, 09 Nov 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[D√©velopper avec Create React App et une API Node.js]]></title><description><![CDATA[<h2 id="tldr"><a href="#tldr" class="phenomic-HeadingAnchor">#</a>tl;dr</h2>
<p>Dans un environnement de d√©veloppement, pour lancer dans le m√™me temps votre application React et une API bas√©e sur Node.js, vous pouvez imbriquer judicieusement les deux d√©p√¥ts Git, puis utiliser un script NPM et quelques packages bien pratiques tels que <em>concurrently</em> et <em>nodemon</em> pour lancer les deux serveurs d'une seule commande. Pratique ! D'autant que pour contourner les restrictions d'acc√®s li√©es √† la <a href="https://fr.wikipedia.org/wiki/Same-origin_policy"><em>politique de m√™me origine</em></a>, <strong>create-react-app</strong> permet le param√©trage d'un <em>proxy</em> pour vos requ√™tes API.</p>
<h2 id="est-ce-que-√ßa-me-concerne-"><a href="#est-ce-que-%C3%A7a-me-concerne-" class="phenomic-HeadingAnchor">#</a>Est-ce que √ßa me concerne ?</h2>
<p>La g√©n√©ralisation des architectures dites "API first" r√©pond √† des imp√©ratifs humains et techniques tr√®s divers. En ce qui concerne l'organisation du travail des d√©veloppeurs, c'est l'assurance de pouvoir scinder l'impl√©mentation de l'acc√®s aux donn√©es -aux ressources- d'une part, et le travail sur l'UI/UX, d'autre part. Un premier groupe peut concevoir une API robuste et proposer un "contrat" clair √† l'√©quipe <em>frontend</em> qui acc√®de aux donn√©es avec un r√©f√©rentiel unique, que l'application soit web ou mobile.</p>
<p>De cette fa√ßon, la conception de l'interface utilisateur est lib√©r√©e d'une grande partie des contraintes qui r√©gissent les architectures MVC traditionnelles. Le d√©veloppeur peut ainsi mieux se concentrer sur la qualit√© de sa r√©ponse aux sp√©cifications fonctionnelles.</p>
<p>Si l'architecture de votre projet est de ce type, et que vous attaquez la conception d'un frontend <a href="https://fr.wikipedia.org/wiki/Application_web_monopage">SPA</a> React avec <a href="https://github.com/facebookincubator/create-react-app">create-react-app</a> (quelle bonne id√©e !), ce qui suit peut vous √©clairer. Nous allons voir comment il est possible d'acc√©der sans se compliquer la vie √† une API RESTful bas√©e sur Node.js, en imbriquant correctement ses d√©p√¥ts.</p>
<h2 id="deux-d√©p√¥ts--le-frontend-lapi"><a href="#deux-d%C3%A9p%C3%B4ts--le-frontend-lapi" class="phenomic-HeadingAnchor">#</a>Deux d√©p√¥ts : le frontend, l‚ÄôAPI</h2>
<p>Le principe est le suivant : vous ne souhaitez pas forc√©ment modifier l'API qui est impl√©ment√©e par une autre √©quipe, ou par un coll√®gue, mais vous devez y acc√©der facilement depuis votre application React.</p>
<p>Vous allez pour cela devoir travailler sur deux d√©p√¥ts Git clon√©s : celui du <em>frontend</em> React contiendra par exemple celui de l'API, et un <em>script NPM</em> se chargera de lancer les deux applications, sur deux ports diff√©rents.</p>
<p><em>Faut-il utiliser un framework en particulier pour le backend ?</em><br>
Absolument pas ! Pour ma part je travaille plus volontiers avec <a href="https://loopback.io/">LoopBack</a>, mais tout ce que qui s'appuie sur Node.js fait l'affaire.</p>
<h2 id="organisation-locale-du-code"><a href="#organisation-locale-du-code" class="phenomic-HeadingAnchor">#</a>Organisation locale du code</h2>
<p>Mettons que votre projet React s'appelle <strong>my-react-frontend</strong> et que l'API qu'il consomme r√©pond au doux nom de <strong>my-node-api</strong>.</p>
<p><strong>my-react-frontend</strong> est clon√© √† la racine, c'est le projet parent. Il contient au moins les r√©pertoires <code>src/</code>, <code>public/</code> et <code>node_modules/</code> g√©n√©r√©s par <em>create-react-app</em>.</p>
<p><code>build/</code> peut √©galement √™tre pr√©sent si vous avez d√©j√† lanc√© au moins une fois la commande <code>npm run build</code>.</p>
<p>A la racine de <strong>my-react-frontend</strong>, clonez le d√©p√¥t <strong>my-node-api</strong>.</p>
<p>Vous devez obtenir :</p>
<pre><code>my-react-frontend/
-- my-node-api/
-- node_modules/
-- public/
-- src/
...
</code></pre>
<p>Ne nous attardons pas trop sur <code>my-node-api</code>, qui peut √™tre impl√©ment√© de tr√®s nombreuses mani√®res. Partons du principe qu'une fois lanc√©, le serveur expose les ressources dont votre application a besoin sur <code>http://localhost:3001</code>. Et disons juste que si l'√©quipe <em>backend</em> vous signale une mise √† jour, vous ferez simplement :</p>
<pre><code class="hljs language-Shell">cd my-node-api/
git pull</code></pre>
<p><em>Faut-il forc√©ment organiser les d√©p√¥ts de cette fa√ßon ?</em><br>
Pas du tout. Mais l'int√©r√™t de cette configuration, c'est que le <em>backend</em> est "dans sa bulle" et que les d√©veloppeurs qui le font √©voluer n'ont pas √† organiser le code en fonction de ce <em>frontend</em> en particulier.</p>
<p>Derni√®re chose importante : pensez √† ajouter <code>my-node-api/</code> au fichier <code>.gitignore</code> du projet React. Il ne faudrait √©videmment pas qu'il versionne le <em>backend</em>.</p>
<h2 id="passez-moi-sur-le-cors"><a href="#passez-moi-sur-le-cors" class="phenomic-HeadingAnchor">#</a>Passez moi sur le CORS</h2>
<p>En production, il est fr√©quent d'utiliser le m√™me serveur pour servir l'application React et l'API sous-jacente. Dans cette configuration, le m√©canisme de <em>Cross-origin resource sharing</em> (<a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a>), bas√© sur des headers HTTP, n'a pas √† √™tre impl√©ment√©.</p>
<p>En d√©veloppement, par contre, il est plus pratique de dissocier les serveurs pour b√©n√©ficier de toutes les fonctionnalit√©s de l'√©cosyst√®me React.</p>
<p>Pour r√©pondre √† cette contrainte, <em>create-react-app</em> propose <a href="https://github.com/facebookincubator/create-react-app/blob/master/packages/react-scripts/template/README.md#proxying-api-requests-in-development">un m√©canisme</a> qui permet de mettre en place un <strong>proxy</strong> d'API.</p>
<p>En partant du principe que votre frontend √©coute sur le port 3000, et le serveur API sur le port 3001, il suffit d'ajouter un param√®tre au premier niveau du <code>package.json</code> :</p>
<pre><code class="hljs language-json">{
  <span class="hljs-attr">"proxy"</span>: <span class="hljs-string">"http://localhost:3001"</span>,
}</code></pre>
<p>De cette fa√ßon, vous pourrez utiliser un chemin relatif pour acc√©der √† vos ressources. Si une requ√™te ne concerne pas un <em>asset</em> statique, elle sera relay√©e vers votre <em>backend</em>. <code>fetch('/api/bananas')</code>, par exemple, requ√™tera notre API sur <code>http://localhost:3001/api/bananas</code>.</p>
<h2 id="tout-lancer-en-une-seule-commande"><a href="#tout-lancer-en-une-seule-commande" class="phenomic-HeadingAnchor">#</a>Tout lancer en une seule commande</h2>
<p>Nous utiliserons pour cela un script NPM d√©fini dans le <code>package.json</code> situ√© √† la racine du projet React.</p>
<p>Deux petits outils seront n√©cessaires pour cr√©er le script <em>ad hoc</em> :</p>
<ul>
<li>le package <a href="https://www.npmjs.com/package/concurrently"><code>concurrently</code></a> qui permet de lancer plusieurs scripts en une seule commande. Faites par exemple un <code>npm install --save-dev concurrently</code>.</li>
<li>le package <a href="https://www.npmjs.com/package/nodemon"><code>nodemon</code></a> qui scrute votre <em>backend</em> Node.js et relance le serveur automatiquement en cas de modification du code. Faites donc un <code>npm install --save-dev nodemon</code>, vous ne le regretterez pas.</li>
</ul>
<p>Tout est pr√™t ! Ouvrez <code>package.json</code> et ajoutez dans les <code>scripts</code>:</p>
<pre><code class="hljs language-json"><span class="hljs-string">"start-with-api"</span>: <span class="hljs-string">"concurrently \"react-scripts start\" \"PORT=3001 nodemon ./my-node-api/server/server.js\""</span></code></pre>
<p>Le chemin d'acc√®s au script serveur est √† adapter en fonction de vos propres choix techniques ! Notez que dans ce cas pr√©cis, on passe une variable d'environnement <code>PORT</code> que le script serveur utilise pour √©craser son port d'√©coute par d√©faut.</p>
<p>Au final, le <code>package.json</code> doit ressembler √† ceci :</p>
<pre><code class="hljs language-json">{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"my-react-frontend"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.1.0"</span>,
  <span class="hljs-attr">"private"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"proxy"</span>: <span class="hljs-string">"http://localhost:3001"</span>,
  <span class="hljs-attr">"scripts"</span>: {
    <span class="hljs-attr">"start"</span>: <span class="hljs-string">"react-scripts start"</span>,
    <span class="hljs-attr">"start-with-api"</span>: <span class="hljs-string">"concurrently \"react-scripts start\" \"PORT=3001 nodemon ./my-node-api/server/server.js\""</span>,
    <span class="hljs-attr">"build"</span>: <span class="hljs-string">"react-scripts build"</span>,
    <span class="hljs-attr">"test"</span>: <span class="hljs-string">"react-scripts test --env=jsdom"</span>,
    <span class="hljs-attr">"eject"</span>: <span class="hljs-string">"react-scripts eject"</span>
  },
  <span class="hljs-attr">"devDependencies"</span>: {
    <span class="hljs-attr">"react-scripts"</span>: <span class="hljs-string">"1.0.14"</span>,
    <span class="hljs-attr">"concurrently"</span>: <span class="hljs-string">"3.5.0"</span>,
    <span class="hljs-attr">"nodemon"</span>: <span class="hljs-string">"1.12.1"</span>
  },
  <span class="hljs-attr">"dependencies"</span>: {
    <span class="hljs-attr">"react"</span>: <span class="hljs-string">"^16.0.0"</span>,
    <span class="hljs-attr">"react-dom"</span>: <span class="hljs-string">"^16.0.0"</span>
  }
}</code></pre>
<p>Pour m√©moire, nous n'avons ajout√© que deux lignes : "proxy" et "scripts/start-with-api".</p>
<h2 id="une-astuce-pour-les-press√©s"><a href="#une-astuce-pour-les-press%C3%A9s" class="phenomic-HeadingAnchor">#</a>Une astuce pour les press√©s</h2>
<p>Si le backend ne joue pas un grand r√¥le dans votre application ou si -plus probablement- vous souhaitez d√©marrer sans attendre que le v√©ritable backend soit disponible, je vous conseille de tester l'excellent <a href="https://github.com/typicode/json-server"><code>json-server</code></a>.</p>
<p>Cet √©l√©gant package offre la possibilit√© de cr√©er un fichier JSON avec quelques donn√©es factices (<em>data fixtures</em>) et de les mettre √† disposition de votre application √† la fa√ßon d'une API RESTful, gr√¢ce √† un simple <code>json-server --watch db.json</code>.</p>
<p>Il va sans dire qu'en modifiant l√©g√®rement le script <em>start-with-api</em>, vous disposerez en quelques secondes d'un <em>backend</em> au poil pour votre nouvelle application.</p>
]]></description><link>http://putaindecode.io/fr/articles/js/react/create-react-app-et-api/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/js/react/create-react-app-et-api/</guid><pubDate>Tue, 07 Nov 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Introduction √† l'Overlay Manager Service, expliqu√© par quelqu'un qui n'y conna√Æt rien]]></title><description><![CDATA[<blockquote>
<p>DISCLAIMER : J'entrave pas un keyword de Java, j'ai jamais d√©velopp√© une seule app native, et plus globalement, je ne connais vraiment pas mon sujet. Ainsi, si quelqu'un s'y connaissant mieux que moi passe par l√†, qu'il n'h√©site surtout pas √† me corriger et √† m'afficher devant la plan√®te enti√®re, j'ai besoin de nourrir mon syndrome de l'imposteur.</p>
</blockquote>
<p>Salut les copains aujourd'hui tonton FoetusBoy (SkinnyFoetusDaron) (moi) va vous parler d'un sujet qu'il ne conna√Æt pas et qui s'ins√®rera √† ce titre aux c√¥t√©s d'autres sujets qu'il ne conna√Æt pas tels que la joie de vivre, les souvenirs des jours joyeux et comment ne pas parler de soi √† la troisi√®me personne.</p>
<p>Ouvrez vos calepins √† la page bullshit, on va faire un cours sur l'Overlay Manager Service (ou OMS) d'Android, sur comment √ßa fonctionne et comment vous allez pouvoir l'utiliser pour faire des trucs moches.</p>
<figure>
  <img src="OMS-moche.png" alt="hahaha comment c'est trop moche" />
  <figcaption>J'ai s√©ch√© les cours de th√©orie des couleurs</figcaption>
</figure>
<p>Okay alors maintenant que vos r√©tines sont perp√©tuellement d√©molies par cette capture d'√©cran et que votre curiosit√© est piqu√©e au vif, on attaque le cours d'histoire.
Fin 2015, deux ing√©nieurs de chez Sony Mobile, M√•rten Kongstad et Martin Wallgren, que j'identifie √† 99% de chances comme √©tant probablement tous les deux Su√©dois (et qui illustrent bien l'inventivit√© de ce peuple lorsqu'il s'agit de trouver toutes les fa√ßons de nommer quelqu'un Martin), co√©crivent un commit dans l'AOSP (Android Open-Source Project), sous le chouette identifiant "OMS: introduce the OverlayManagerService". Cet √©v√©nement est chouette pour deux raisons :</p>
<ul>
<li>La premi√®re est qu'Android √©tant malgr√© le contr√¥le de Google un projet open-source, c'est toujours int√©ressant de voir les constructeurs participer un peu au projet (les mauvaises langues diront que seul Sony joue vraiment le jeu de l'open-source et les mauvaises langues n'auraient pas vraiment tort).</li>
<li>La deuxi√®me est que √ßa marque l'arriv√©e sur Android d'un v√©ritable syst√®me de theming (th√©matisation en Fran√ßais, donc je vais dire theming plut√¥t hein), permettant ainsi aux constructeurs d'impl√©menter leurs customisations de fa√ßon beaucoup plus souple et surtout aux initi√©s (moi et bient√¥t vous) de s'amuser un peu.</li>
<li>Troisi√®me raison (bonus) : C'√©tait bient√¥t No√´l et cette ann√©e-l√† on m'avait offert un joli manteau.</li>
</ul>
<p>Commen√ßons. Comme son nom l'indique si vous parlez la langue de Jay-Z, l'Overlay Manager Service est un service de gestion de surcouches.</p>
<figure>
  <img src="jayz.png" alt="" />
  <figcaption>Si votre Google Translate n'a pas l'option de traduction de Jay-Z vers Moli√®re c'est que vous n'avez pas souscrit √† un abonnement Translate Gold</figcaption>
</figure>
<p>L'OMS est lui-m√™me le successeur du RRO, pour "Runtime Resource Overlay", ancien syst√®me propri√©taire de Sony Mobile, utilis√© en interne pour d√©ployer et param√©trer rapidement leur surcouche √† Android en fonction des demandes et besoins des op√©rateurs et des mises √† jour d'Android lui-m√™me ou bien pour faire fonctionner les Th√®mes Xperia (on conna√Æt Sony assez friands de la customisation par les utilisateurs depuis la sortie de la PS3, surtout quand il s'agit de vendre des th√®mes √† 25$).</p>
<p>Ce Runtime Resource Overlay (surcouches de ressources √† l'ex√©cution) s'opposait √† l'outil Static Resource Overlay (surcouches de ressources statiques), un flag du packager d'Android (aapt) qui √©tait comme qui dirait "bien mais pas top" : il permettait de s√©parer le code source d'une application de sa surcouche pour garder une base de travail propre (bien) mais ces surcouches ne pouvaient √™tre install√©es qu'√† la compilation de l'app, les rendant donc chiantes √† d√©bugger et n√©cessitaient plus ou moins qu'on soit le vendor original de l'application √† modifier (pas top). Le principal int√©r√™t du RRO √©tait donc de faire sauter ces "barri√®res".</p>
<p>Voyant donc que l'un des principaux reproches faits √† Android, √† raison ou √† tort (√† raison hein, on va pas se mentir) √©tait sa fragmentation et que l'un de ses facteurs (mais non le seul) √©tait li√© aux <em>vendors</em> (Samsung.) mettant trop de temps √† recoder leur surcouche de A √† Z √† chaque version d'Android (et que de toute fa√ßon pourquoi s'emmerder √† mettre √† jour un t√©l√©phone gratuitement alors que tu peux en vendre un nouveau pour 700 p√©trodollars <em>allez ach√®te, vil consommateur</em> ?) les braves petits ing√©s de chez Sony ont pr√©f√©r√© faire une petite PR sympa du c√¥t√© de l'AOSP pour ajouter ce syst√®me de surcouches en natif dans Android.
Rest√© dormant pendant quelques temps, l'OMS a enfin √©t√© activ√© de fa√ßon officielle (√† peu pr√®s) par Google, lors de la sortie d'Android 8.0 Oreo, qui en tire une utilit√© assez basique mais prometteuse : changer litt√©ralement une seule couleur dans l'interface, sp√©cifiquement pour les t√©l√©phones Pixel.</p>
<figure>
  <img src="epoustouflan.png" alt="√©poustouflan" />
  <figcaption>√©poustouflan</figcaption>
</figure>
<p>√áa peut para√Ætre peu mais c'est finalement ce genre de modifications √† la con qui peut consid√©rablement ralentir le portage d'une nouvelle version d'Android sur un device existant. Ouvrons un peu le ventre de la b√™te.</p>
<p>Un overlay, √ßa fonctionne assez simplement. Il prend la forme d'un Android PacKage (ci-apr√®s APK), le format standard des applications Android, genre de point JAR survitamin√©, qu'il conviendra donc de signer s'il vous pla√Æt merci c'est important bonne journ√©e, si vous comptez l'installer par vous-m√™me en dehors de l'IDE consacr√© (Android Studio, donc). De par sa nature d'APK, un overlay devra donc contenir un AndroidManifest.xml, sorte de package.json si je devais faire une √©quivalence avec le dev web, cet AndroidManifest donc, qui prendra la forme suivante :</p>
<pre><code>&#x3C;?xml version="1.0" encoding="utf-8" standalone="no"?>
&#x3C;manifest xmlns:android="http://schemas.android.com/apk/res/android" package="LePetitNomDeMonPackage">
    &#x3C;overlay android:priority="1000" android:targetPackage="LePetitNomDuPackageCible"/>
&#x3C;/manifest>
</code></pre>
<p>Mettons les points sur les i et d√©finissons imm√©diatement ce qu'un overlay n'est pas :
un overlay n'est <em>pas</em> une extension d'application, il ne peut en aucun cas rajouter des fonctionnalit√©s √† une application existante, de la m√™me mani√®re que vous gal√©reriez √† rajouter des features √† un site existant juste en modifiant son CSS. En somme, √† peu de choses pr√®s, un overlay se r√©duit √† une feuille de style o√π toutes les d√©clarations seraient faites avec <code>!important</code> et comme on aime les bonnes pratiques bien maintenables chez PutainDeCode on vous rappellera de ne <em>JAMAIS</em> faire √ßa s'il vous pla√Æt.</p>
<p>L√† o√π la comparaison s'arr√™te c'est que contrairement √† CSS, les ressources d'une application ne comprennent pas que les couleurs et occasionnellement les dimensions des blocs, mais peuvent renfermer les ic√¥nes, les sons, les images, et √† peu pr√®s tout ce que le d√©veloppeur original a voulu foutre dedans.</p>
<p>En r√©sum√©, rajouter une feature pour envoyer des SMS depuis votre lecteur de musique : c'est non; remplacer toutes les couleurs d'une appli par du rose, les typos par du Comic Sans MS et les sons d'interactions par le bruit d'un canard qui fait "Coin coin" : c'est oui.</p>
<p>D'ailleurs on va rendre l'application Calculatrice (dont le nom de package est "com.google.android.calculator", √ßa servira plus tard) toute rose parce que pourquoi pas.
En d√©compilant donc l'APK √† l'aide de notre fid√®le <a href="https://ibotpeaches.github.io/Apktool/">apktool</a>, nous voil√† dans le c≈ìur du code, dans la matrice, dans la mer num√©rique, bref, dans un sacr√© paquet de fichiers XML.</p>
<figure>
  <img src="chosenOne.png" alt="Mes coll√®gues d√©testent que je dise I'm in √† chaque fois que je fais un git pull" />
  <figcaption>*hacker voice* I'm in</figcaption>
</figure>
<p>Selon toute logique, la gestion des couleurs de l'app va probablement se retrouver dans un fichier qui s'appelle √† peu pr√®s <code>colors.xml</code>, ce qui n'est pas √©tonnant parce que c'est comme √ßa qu'on nomme ses fichiers quand on veut s'y retrouver, j'ai appris √ßa √† l'√©cole quand je mettais des gommettes sur mes cahiers.
Il s'agit donc maintenant de voir ce √† quoi sert chaque valeur dans ce fichier. Si vous arrivez √† d√©duire le code hexa d'une couleur juste en la regardant, f√©licitations, vous √™tes probablement un Terminator. Pour ceux qui ne sont pas des robots tueurs venus du turfu, faire une capture d'√©cran de l'application et ouvrir celle-ci dans Photoshop fonctionne tr√®s bien aussi.</p>
<figure>
  <img src="colors.png" alt="Featuring l'outil pipette de Photoshop, on applaudit l'outil pipette de Photoshop" />
  <figcaption>Devinez √† quel moment j'en ai eu marre de faire de belles fl√®ches bien droites</figcaption>
</figure>
<p>Les trois valeurs nous int√©ressant sont donc <code>pad_advanced_background_color</code>, <code>pad_numeric_background_color</code> et <code>pad_operator_background_color</code> qui sont finalement assez bien nomm√©es. Vous remarquerez que les couleurs sont au format #aarrggbb et non pas #rrggbb, donc faites gaffe quand vous tripotez √ßa et que vous remplacez les couleurs par du rose (j'ai choisi le Bubblegum Pink de Pantone mais si vous pr√©f√©rez d'autres teintes de rose, libre √† vous). Il s'agit maintenant de cr√©er un nouveau fichier colors.xml dans notre <a href="https://github.com/skinnyfoetusboy/OMS-template">template OMS</a> qu'on va remplir ainsi :</p>
<pre><code class="hljs language-xml"><span class="php"><span class="hljs-meta">&#x3C;?</span>xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span><span class="hljs-meta">?></span></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">resources</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"pad_advanced_background_color"</span>></span>#fff4cbd4<span class="hljs-tag">&#x3C;/<span class="hljs-name">color</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"pad_numeric_background_color"</span>></span>#fff4cbd4<span class="hljs-tag">&#x3C;/<span class="hljs-name">color</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"pad_operator_background_color"</span>></span>#fff4cbd4<span class="hljs-tag">&#x3C;/<span class="hljs-name">color</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">resources</span>></span></code></pre>
<p>Puis nous pouvons enfin compiler notre chef d'≈ìuvre (toujours avec apktool) puis l'installer sur notre appareil, non sans l'avoir <a href="https://stackoverflow.com/questions/10930331/how-to-sign-an-already-compiled-apk">au pr√©alable sign√©</a>, puis enfin de l'appliquer via la commande</p>
<pre><code>adb shell cmd overlay enable [le namespace de votre package que vous avez sp√©cifi√© dans AndroidManifest.xml, moi par exemple c'est "com.sfb.pinkcalc"]
</code></pre>
<p>(il faut que votre t√©l√©phone soit en mode D√©veloppeur et que vous tourniez sous Android Oreo minimum sinon √ßa ne marchera pas, pas la peine de me demander pour faire marcher √ßa sur votre t√©l√©phone si vous √™tes sous Gingerbread, tout ce que je ferai ce sera me moquer de vous).</p>
<p>Admirons ce merdier, maintenant.</p>
<figure>
  <img src="fuckthatspink.png" alt="Sans rire, depuis l'√©criture de cet article j'ai pas d√©sactiv√© cet overlay, j'aime vraiment le look que √ßa donne √† l'app calculatrice" />
  <figcaption>Absolument splendide.</figcaption>
</figure>
<p>C'est √† peu pr√®s tout pour l'OMS, pour les bases du moins, n'h√©sitez surtout pas √† d√©compiler toutes les apps que vous trouvez pour voir un peu comment √ßa marche √† l'int√©rieur, c'est aussi pour √ßa que c'est cool Android. Allez faire vos propres trucs moches maintenant.
<em>Ciao.</em></p>
]]></description><link>http://putaindecode.io/fr/articles/android/overlaymanagerservice/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/android/overlaymanagerservice/</guid><pubDate>Thu, 02 Nov 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Se lancer dans le TDD]]></title><description><![CDATA[<h2 id="introduction"><a href="#introduction" class="phenomic-HeadingAnchor">#</a>Introduction</h2>
<p>Tout commence en octobre 1999 lorsque <a href="https://fr.wikipedia.org/wiki/Kent_Beck">Kent Beck</a>
pr√©sente une nouvelle m√©thode de programmation agile : l'eXtreme Programmming abr√©g√© <em>XP</em>.<br>
l'<em>XP</em> d√©finit des pratiques de d√©veloppement optimis√©es qui am√©liorent la production et
la robustesse du code.<br>
Parmi les principes les plus connus de sa m√©thode on pourra citer <strong>l'int√©gration continue</strong>
aussi appel√©e <em>CI</em> pour <em>Continuous Integration</em> et <strong>la programmation en bin√¥me</strong>
ou <em>pair programming</em> en anglais.</p>
<p>L'aspect qui nous int√©resse ici est un autre pilier de la m√©thode qui consiste √† piloter
le d√©veloppement par les tests alias <em>TDD</em>.</p>
<p>Le TDD est une pratique controvers√©e car co√ªteuse √† mettre en place.
Popularis√©e par les d√©veloppeurs elle peine √† √©merger.</p>
<p>Avec la multiplication des environnements d'execution, la complexit√© des applications web
et l'essor des projets Open-source, les d√©veloppeurs se heurtent √† des probl√®mes de
compatibilit√©s crois√©es et d'inconsistances.<br>
Aujourd‚Äôhui les standards sont de plus en plus permissifs et favorisent
ainsi les comportements √† risque. La plupart du temps, les syst√®mes sont capables de
corriger vos erreurs, des fois sans m√™me vous en avertir.</p>
<p>Dans ce contexte :</p>
<ul>
<li>Comment √©crire un code multi-plateforme fonctionnel ?</li>
<li>Comment √™tre s√ªr que les ajouts ne cassent pas le code plus ancien ?</li>
<li>Comment √™tre s√ªr que le code se comporte comme voulu ?</li>
</ul>
<p>Commencer par vous imposer des pratiques de d√©veloppement rigoureuses est imp√©ratif
mais les tests seront un compl√©ment indispensable √† la qualit√© de votre code.</p>
<p>Heureusement, le TDD apporte alors une r√©ponse √©l√©gante √† l'ensemble de ces probl√©matiques.</p>
<h2 id="tdd-vous-avez-dit-tdd-"><a href="#tdd-vous-avez-dit-tdd-" class="phenomic-HeadingAnchor">#</a>TDD, vous avez dit TDD ?</h2>
<p>Le Test Driven Development <em>(D√©veloppement Dirig√© par les Tests)</em>,
est une technique de d√©veloppement qui impose l‚Äô√©criture de tests
avant m√™me l‚Äô√©criture de la premi√®re ligne de code.</p>
<p>Dans la th√©orie, la m√©thode requiert l‚Äôintervention d‚Äôau moins
deux intervenants diff√©rents, une personne √©crit les tests, l‚Äôautre
le code test√©. Cela permet d‚Äô√©viter les probl√®mes li√©s √† la subjectivit√©.</p>
<p>Dans la pratique les choses sont plus compliqu√©es,
parfois on d√©veloppe seul ou on √©crit soi-m√™me les tests qui
garantissent l‚Äôint√©grit√© d'une nouvelle fonctionnalit√© dans un projet collaboratif.</p>
<blockquote>
<p>Quoi qu‚Äôil arrive, un test peu efficace vaudra toujours mieux que pas de test du tout.
Le but √©tant de prendre l‚Äôhabitude d‚Äôen √©crire et d‚Äô√™tre objectif dans leur r√©daction.</p>
</blockquote>
<p>Le TDD tend √† se d√©mocratiser et requiert l‚Äôeffort de chacun pour devenir un standard.
Tout d√©veloppeur soucieux de son environnement et de son h√©ritage doit se poser s√©rieusement
la question.<br>
Les frameworks de tests, les guides et les documentations sur le sujet fleurissent,
vous pouvez donc vous lancer sans crainte.</p>
<p>On peut d√©couper le TDD en 5 √©tapes distinctes :</p>
<ol>
<li>√âcrire un test,</li>
<li>V√©rifier qu‚Äôil √©choue,</li>
<li>√âcrire le code <strong>suffisant</strong> pour que le test passe,</li>
<li>V√©rifier que le test passe,</li>
<li>Optimiser le code et v√©rifier qu‚Äôil n‚Äôy ait pas de r√©gression.</li>
</ol>
<p>Pour simplifier cette logique on peut regrouper ces cinq √©tapes en trois grandes id√©es :</p>
<ul>
<li><strong>Tester d‚Äôabord</strong>, qui correspond aux deux premi√®res √©tapes.</li>
<li><strong>Rendre fonctionnel</strong>, qui englobe les points 3 et 4.</li>
<li><strong>Rendre meilleur</strong>, qui n‚Äôest autre que l‚Äô√©tape 5.</li>
</ul>
<p>Bill Wake d√©finit ainsi la m√©thode <a href="http://xp123.com/articles/3a-arrange-act-assert/">3A</a>,
pour Arrange, Act, Assert <em>(Arranger, Agir, Affirmer)</em>.<br>
Il insiste sur le fait que la m√©thode ne d√©finit pas un ordre immuable,
l‚Äô<em>affirmation</em> peut ainsi venir avant l‚Äô<em>action</em>, etc...</p>
<ul>
<li><strong>Arranger</strong> : Phase de pr√©paration de l‚Äôenvironnement de test dans laquelle
on d√©clare les variables et les fonctions.</li>
<li><strong>Agir</strong> : Phase qui met √† l‚Äô√©preuve notre environnement en lui faisant subir des mutations.</li>
<li><strong>Affirmer</strong> : On formule des attentes √† propos de l'environnement
(variables, fonctions, param√®tres).</li>
</ul>
<h2 id="tdd--concepts-de-base"><a href="#tdd--concepts-de-base" class="phenomic-HeadingAnchor">#</a>TDD : concepts de base</h2>
<p>Pour la s√©rie de tests suivante on utilisera EcmaScript 6 et la m√©thode
<a href="https://developer.mozilla.org/fr/docs/Web/API/Console/assert"><code>.assert()</code></a>
de la console navigateur: Vous pourrez ainsi reproduire ces tests vous-m√™me.</p>
<p>Objectif : Ecrire une fonction <code>countWords()</code> qui compte les mots d'une phrase.</p>
<p><strong>ITERATION 1</strong> : √©criture et √©chec du test initial</p>
<p>On √©crit tout d'abord une affirmation de base.</p>
<pre><code class="hljs language-js"><span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">''</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">'test 0: le texte ne contient aucun mot'</span>);</code></pre>
<blockquote>
<p><code>Uncaught ReferenceError: countWords is not defined</code></p>
</blockquote>
<p>Apr√®s ex√©cution la console rejette le test.
On doit d'abord d√©finir <code>countWords()</code>.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">()</span> =></span> {};
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">''</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">'test 0: le texte ne contient aucun mot'</span>);</code></pre>
<blockquote>
<p><code>Assertion failed: test 0: le texte ne contient aucun mot</code></p>
</blockquote>
<p><code>countWords()</code> est d√©finie et le test √©choue mais l'erreur a chang√©.<br>
Il faut √† pr√©sent d√©finir la logique du c≈ìur de notre fonction.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =></span> text || <span class="hljs-number">0</span>;
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">''</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">'test 0: le texte ne contient aucun mot'</span>);</code></pre>
<blockquote>
<p><code>undefined</code></p>
</blockquote>
<p>La console ne renvoie rien, le test est donc pass√©.  </p>
<blockquote>
<p><code>countWords()</code> √©tant tr√®s simple nous omettrons les phases d'optimisation.
On peut aussi consid√©rer les it√©rations suivantes comme des optimisations.</p>
</blockquote>
<p><strong>ITERATION 2</strong> : test pour les phrases d'un seul mot</p>
<p>Tr√®s bien. Essayons √† pr√©sent une phrase d'un seul mot.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =></span> text || <span class="hljs-number">0</span>;
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">''</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">'test 0: le texte ne contient aucun mot'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">'nope'</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">'test 1: le texte contient 1 mot'</span>);</code></pre>
<blockquote>
<p><code>Assertion failed: test 1: le texte contient 1 mot</code></p>
</blockquote>
<p><code>countWords()</code> ne compte pas correctement, ajoutons le code suffisant pour passer le test.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =></span> text ? text.split(<span class="hljs-string">' '</span>).length : <span class="hljs-number">0</span>;
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">''</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">'test 0: le texte ne contient aucun mot'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">'nope'</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">'test 1: le texte contient 1 mot'</span>);</code></pre>
<blockquote>
<p><code>undefined</code></p>
</blockquote>
<p>Le test est pass√©, ajoutons un autre cas standard.</p>
<p><strong>ITERATION 3</strong> : test pour les phrases de plusieurs mots</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =></span> text ? text.split(<span class="hljs-string">' '</span>).length : <span class="hljs-number">0</span>;
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">''</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">'test 0: le texte ne contient aucun mot'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">'nope'</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">'test 1: le texte contient 1 mot'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">'tdd is so fun'</span>) === <span class="hljs-number">4</span>, <span class="hljs-string">'test 2: le texte contient 4 mots'</span>);</code></pre>
<blockquote>
<p><code>undefined</code></p>
</blockquote>
<p>Le nouveau test passe sans modification, on peut continuer.</p>
<p><strong>ITERATION 4</strong> : test pour les phrases contenant des espaces au d√©but et √† la fin</p>
<p>V√©rifions √† pr√©sent la robustesse de la fonction.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =></span> text ? text.split(<span class="hljs-string">' '</span>).length : <span class="hljs-number">0</span>;
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">''</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">'test 0: le texte ne contient aucun mot'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">'nope'</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">'test 1: le texte contient 1 mot'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">'tdd is so fun'</span>) === <span class="hljs-number">4</span>, <span class="hljs-string">'test 2: le texte contient 4 mots'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">' so is skateboarding '</span>) === <span class="hljs-number">3</span>, <span class="hljs-string">'test 3: le texte contient 3 mots'</span>);</code></pre>
<blockquote>
<p><code>Assertion failed: test 3: le texte contient 3 mots</code></p>
</blockquote>
<p>A√Øe‚Ä¶ notre fonction n'est pas assez solide. Corrigeons-la pour capter ce nouveau cas en supprimant les
espaces inutiles avant et apr√®s le texte.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =></span> text ? text.trim().split(<span class="hljs-string">' '</span>).length : <span class="hljs-number">0</span>;
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">''</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">'test 0: le texte ne contient aucun mot'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">'nope'</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">'test 1: le texte contient 1 mot'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">'tdd is so fun'</span>) === <span class="hljs-number">4</span>, <span class="hljs-string">'test 2: le texte contient 4 mots'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">' so is skateboarding '</span>) === <span class="hljs-number">3</span>, <span class="hljs-string">'test 3: le texte contient 3 mots'</span>);</code></pre>
<blockquote>
<p><code>undefined</code></p>
</blockquote>
<p>Parfait, La fonction est am√©lior√©e ! Ajoutons quand m√™me un dernier test pour √™tre sur.</p>
<p><strong>ITERATION 5</strong> : test pour les phrases contenant un nombre in√©gal d'espaces entre les mots</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =></span> text ? text.trim().split(<span class="hljs-string">' '</span>).length : <span class="hljs-number">0</span>;
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">''</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">'test 0: le texte ne contient aucun mot'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">'nope'</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">'test 1: le texte contient 1 mot'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">'tdd is so fun'</span>) === <span class="hljs-number">4</span>, <span class="hljs-string">'test 2: le texte contient 4 mots'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">' so is skateboarding '</span>) === <span class="hljs-number">3</span>, <span class="hljs-string">'test 3: le texte contient 3 mots'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">`  I'm 28, I love $#@! and    multi-spaces  `</span>) === <span class="hljs-number">7</span>, <span class="hljs-string">'test 4: le texte contient 7 mots'</span>);</code></pre>
<blockquote>
<p><code>Assertion failed: test 4: le texte contient 7 mots</code></p>
</blockquote>
<p>Et mince‚Ä¶ Encore un cas particulier, modifions l'algorithme en cons√©quence.
On doit ici retirer les espaces inutiles entre les mots.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =></span> text ? text.trim().replace(<span class="hljs-regexp">/\s+/g</span>, <span class="hljs-string">' '</span>).split(<span class="hljs-string">' '</span>).length : <span class="hljs-number">0</span>;
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">''</span>) === <span class="hljs-number">0</span>, <span class="hljs-string">'test 0: le texte ne contient aucun mot'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">'nope'</span>) === <span class="hljs-number">1</span>, <span class="hljs-string">'test 1: le texte contient 1 mot'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">'tdd is so fun'</span>) === <span class="hljs-number">4</span>, <span class="hljs-string">'test 2: le texte contient 4 mots'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">' so is skateboarding '</span>) === <span class="hljs-number">3</span>, <span class="hljs-string">'test 3: le texte contient 3 mots'</span>);
<span class="hljs-built_in">console</span>.assert(countWords(<span class="hljs-string">`  I'm 28, I love $#@! and    multi-spaces  `</span>) === <span class="hljs-number">7</span>, <span class="hljs-string">'test 4: le texte contient 7 mots'</span>);</code></pre>
<blockquote>
<p><code>undefined</code></p>
</blockquote>
<p>Le test final est pass√© sans que les pr√©c√©dents n'√©chouent.</p>
<p>On notera que l'√©criture de tests est un processus it√©ratif.<br>
La phase d'optimisation implique l'√©criture d'un nouveau test qui √©choue
et relance donc une nouvelle it√©ration.</p>
<p>Evidemment <code>countWords()</code> est tr√®s largement sous-optimis√©e et ne couvre pas tous les cas sp√©ciaux.
On aurait pu ajouter une v√©rification sur le param√®tre <code>text</code> et compter avec une expression r√©guli√®re comme ceci :</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =></span> <span class="hljs-keyword">typeof</span> text === <span class="hljs-string">'string'</span> &#x26;&#x26; text.trim() ? text.match(<span class="hljs-regexp">/\S+\s{0,1}/g</span>).length : <span class="hljs-number">0</span>;</code></pre>
<p>L'id√©e ici est que coder est un processus incr√©mental et que chaque nouveau cycle doit √™tre initi√©
par un besoin sp√©cifique d√©fini par un test d√©di√©.  </p>
<p>L'√©criture des tests est simple : on d√©compose notre script en une suite d'affirmations
correspondant chacune √† une fonctionnalit√© pr√©cise de notre algorithme.</p>
<p>Gr√¢ce √† ce processus on √©vite :</p>
<ul>
<li><strong>les r√©gressions</strong>: la suite valide de tests est la garantie que le code reste
fonctionnel malgr√© les √©volutions de l'algorithme.</li>
<li><strong>le code mort</strong>: chaque morceau de code √©crit est test√© et a son utilit√©.</li>
<li><strong>le code non document√©</strong>: chaque comportement est d√©crit de mani√®re fonctionnelle.</li>
</ul>
<h2 id="bdd--des-tests-pour-tous"><a href="#bdd--des-tests-pour-tous" class="phenomic-HeadingAnchor">#</a>BDD : Des tests pour tous</h2>
<p>Une variante plus agnostique de la logique du d√©veloppeur existe et permet √† des
intervenants externes de faire partie int√©grante du processus cr√©atif.</p>
<p>le BDD, Behaviour Driven Development (D√©veloppement Dirig√© par le Comportement),
permet de d√©finir de mani√®re compr√©hensible pour tous les intervenants les
sp√©cifications d‚Äôune fonctionnalit√©. Cela permet aussi aux d√©veloppeurs de comprendre
le comportement g√©n√©ral sans √©voquer les d√©tails techniques.
La discussion est donc facilit√©e entre les diff√©rents acteurs.  </p>
<p>Pour illustrer cette variante adaptons l'exemple pr√©c√©dent :</p>
<blockquote>
<p>Note : Pour ex√©cuter ce type de code vous aurez besoin d'un <em>test-runner</em> comme
<a href="https://facebook.github.io/jest/">Jest</a>, <a href="https://mochajs.org">Mocha</a> ou <a href="https://karma-runner.github.io">Karma</a>.</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> countWords = <span class="hljs-function"><span class="hljs-params">text</span> =></span> text ? text.trim().replace(<span class="hljs-regexp">/\s+/g</span>, <span class="hljs-string">' '</span>).split(<span class="hljs-string">' '</span>).length : <span class="hljs-number">0</span>;

describe(<span class="hljs-string">'countWords()'</span>, () => {
  it(<span class="hljs-string">'doit traiter un texte vide'</span>, () => {
    expect(countWords(<span class="hljs-string">''</span>)).toBe(<span class="hljs-number">0</span>);
  });

  it(<span class="hljs-string">'doit traiter un texte d\'un seul mot'</span>, () => {
    expect(countWords(<span class="hljs-string">'nope'</span>)).toBe(<span class="hljs-number">1</span>);
  });

  it(<span class="hljs-string">'doit traiter un texte de n mots'</span>, () => {
    expect(countWords(<span class="hljs-string">'tdd is so fun'</span>)).toBe(<span class="hljs-number">4</span>);
  });

  it(<span class="hljs-string">'doit traiter un texte avec des espaces aux extr√©mit√©s'</span>, () => {
    expect(countWords(<span class="hljs-string">' so is skateboarding '</span>)).toBe(<span class="hljs-number">3</span>);
  });

  it(<span class="hljs-string">'doit traiter un texte avec des espaces in√©gaux entre les mots'</span>, () => {
    expect(countWords(<span class="hljs-string">`  I'm 28, I love $#@! and    multi-spaces  `</span>)).toBe(<span class="hljs-number">7</span>);
  });
});</code></pre>
<p>Voici le r√©sultat du run :</p>
<p><img src="./testrunner.png" alt="r√©sultat du run de tests"></p>
<p>La relecture est simplifi√©e pour tous les participants non techniques.</p>
<h2 id="conclusion"><a href="#conclusion" class="phenomic-HeadingAnchor">#</a>Conclusion</h2>
<p>Le TDD est destin√© √† √™tre incorpor√© √† un processus d'<a href="http://putaindecode.io/fr/articles/ci/">Int√©gration Continue</a>
pour s'assurer du bon fonctionnement de l'application sur tous les environnements
de production apr√®s chaque nouveau <code>commit</code>.  </p>
<p>J'esp√®re vous avez appr√©ci√© la d√©mo et que √ßa vous a donn√© envie de
tester le TDD pour apporter √©quilibre et harmonie √† votre code.  </p>
<p>Dans tous les cas, je peux vous certifier que les autres codeurs vous
en seront reconnaissants, croyez-moi.</p>
]]></description><link>http://putaindecode.io/fr/articles/tdd/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/tdd/</guid><pubDate>Tue, 31 Oct 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Swift - la fonction: une closure particuli√®re]]></title><description><![CDATA[<p><strong>Swift</strong> est un langage simple pour les d√©butants, tout en offrant de grandes possibilit√©es aux d√©veloppeurs exp√©riment√©s. Les <em>fonctions</em> Swift sont un bon exemple de cette fa√ßon d‚Äôavoir pens√© le langage.</p>
<h2 id="les-fonctions"><a href="#les-fonctions" class="phenomic-HeadingAnchor">#</a>Les fonctions</h2>
<h3 id="d√©claration-simple"><a href="#d%C3%A9claration-simple" class="phenomic-HeadingAnchor">#</a>D√©claration simple</h3>
<p>La d√©claration et l‚Äôutilisation de <em>fonctions</em> est simple. On commence avec le mot cl√© <code>func</code> suivi du <em>nom</em>, puis des <em>param√®tres</em> entre parenth√®ses (a.k.a. <code>input</code>) :</p>
<pre><code class="hljs language-swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sayHello</span><span class="hljs-params">(name:String, age:UInt)</span></span>{
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello <span class="hljs-subst">\(name)</span>, you are <span class="hljs-subst">\(age)</span>"</span>)
}</code></pre>
<p>L‚Äôappel se fait aussi simplement que √ßa : <code>sayHello(name:"Bob", age: 32)</code>. Le mot cl√© <code>_</code> permet d'enlever le label du param√®tre dans l'appel si besoin :</p>
<pre><code class="hljs language-swift"><span class="hljs-comment">// Declaration</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sayHello</span><span class="hljs-params">(name:String,<span class="hljs-number">_</span> age:UInt)</span></span>{
 <span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello <span class="hljs-subst">\(name)</span>, you are <span class="hljs-subst">\(age)</span>"</span>)
}
<span class="hljs-comment">// Appel</span>
sayHello(name:<span class="hljs-string">"Bob"</span>, <span class="hljs-number">32</span>)</code></pre>
<p>Mais vous perdrez en clart√© de code suivant les cas. Par exemple, avec <code>min(3,6)</code> on voit tout de suite ce que fait la fonction. Alors que <code>sayHelloTo("Bob", 32)</code>, le <code>32</code> pourrait √™tre beaucoup de choses.</p>
<blockquote>
<p>Les param√®tres sont obligatoirement typ√©s, mais peuvent √™tre optionnels (en autorisant la valeur nil) avec la notation ? (e.g. Int?, String?).</p>
</blockquote>
<p>Vous pouvez aussi d√©finir des valeurs par d√©fauts pour les param√®tres :</p>
<pre><code class="hljs language-swift"><span class="hljs-comment">// Declaration</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sayHello</span><span class="hljs-params">(name:String, <span class="hljs-number">_</span> age:UInt? = <span class="hljs-literal">nil</span>)</span></span>{
    <span class="hljs-keyword">if</span> age == <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello <span class="hljs-subst">\(name)</span>"</span>)
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello <span class="hljs-subst">\(name)</span>, you are <span class="hljs-subst">\(age!)</span>"</span>) <span class="hljs-comment">//! permet de pas afficher Optinal(value)</span>
    }
}
<span class="hljs-comment">// Appel</span>
sayHello(name:<span class="hljs-string">"Bob"</span>) <span class="hljs-comment">// -> Hello Bob</span>
sayHello(name:<span class="hljs-string">"Bob"</span>, <span class="hljs-number">32</span>) <span class="hljs-comment">// ->  Hello Bob, you are 32</span></code></pre>
<p>La plupart du temps nos fonctions servent √† nous retourner des informations. Pour cela on utilise <code>-></code> en signe de retour suivi du type de la valeur retourn√©e.</p>
<pre><code>func formatHelloSentence(name:String, age:UInt? = nil) -> String {
    if age == nil {
        return "Hello \(name)"
    } else {
        return "Hello \(name), you are \(age)"
    }
}
// Appel
let helloSentence = formatHelloSentence(name:"Bob", age: 32)
</code></pre>
<h3 id="retours-multiples-ou-tuples"><a href="#retours-multiples-ou-tuples" class="phenomic-HeadingAnchor">#</a>Retours multiples ou Tuples</h3>
<p>Apple n‚Äôest pas connu pour sa g√©n√©rosit√©, mais dans Swift ils en ont fait autrement <code>:troll:</code> : on peut retourner plusieurs valeurs avec une seule fonction. Pour cela on utilise un <code>Tuple</code> : un collection de variables ordonn√©es.</p>
<pre><code class="hljs language-swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">hardFunction</span><span class="hljs-params">(fInputs:[Float])</span></span>->(<span class="hljs-type">Int</span>,<span class="hljs-type">Int</span>,<span class="hljs-type">Float</span>,<span class="hljs-type">String</span>) {    
    <span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>
    <span class="hljs-keyword">var</span> b = <span class="hljs-number">0</span>
    <span class="hljs-keyword">var</span> f : <span class="hljs-type">Float</span> = <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">var</span> str = <span class="hljs-string">""</span>
    <span class="hljs-comment">//...</span>
    <span class="hljs-keyword">return</span> (a,b,f,str)
}</code></pre>
<p>Ici cette fonction prend en param√®tres un tableau de <code>Float</code> et retourne un <em>Tuple</em> compos√© de deux <code>Int</code>, un <code>Float</code> et un <code>String</code> dans cet ordre. Vous pouvez alors utiliser le <em>Tuple</em> comme une structure en utilisant l‚Äôindex des √©l√©ments du <em>Tuple</em> comme nom de variable (ex: <code>0</code>pour le premier <code>Int</code>, <code>3</code> pour le <code>String</code>).</p>
<pre><code class="hljs language-swift"><span class="hljs-keyword">let</span> myTuple = hardFunction([<span class="hljs-number">2.4</span>,<span class="hljs-number">2.6</span>,<span class="hljs-number">1.8</span>])
<span class="hljs-keyword">let</span> myTupleString = myTuple.<span class="hljs-number">3</span></code></pre>
<p>Mais ceci reste assez confus, alors on peut nommer les √©l√©ments.</p>
<pre><code class="hljs language-swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">hardFunction</span><span class="hljs-params">(fInputs:[Float])</span></span>->(valSup:<span class="hljs-type">Int</span>,
        valMax:<span class="hljs-type">Int</span>,
        average:<span class="hljs-type">Float</span>,
        errorString:<span class="hljs-type">String</span>) {
    <span class="hljs-comment">//...</span>
}

<span class="hljs-comment">//utilisation</span>
<span class="hljs-keyword">let</span> myTuple = hardFunction([<span class="hljs-number">2.4</span>,<span class="hljs-number">2.6</span>,<span class="hljs-number">1.8</span>])
<span class="hljs-keyword">let</span> myTupleString = myTuple.errorString <span class="hljs-comment">// myTuple.3 marche encore</span></code></pre>
<p>L'ex√©cution du code permettant d'avoir les valeurs <em>Tuple</em> n'est effectu√©e qu'√† la demande de ces valeurs. Dans l'exemple ci-dessus, le code de <code>hardFunction</code> ne sera appel√© qu'√† la derni√®re ligne, car c'est l√† qu'on a besoin de <code>errorString</code>, pas avant.</p>
<p> Et la notion de <em>Closure</em> fait son entr√©e!</p>
<h2 id="la-closure-la-variable-fonction"><a href="#la-closure-la-variable-fonction" class="phenomic-HeadingAnchor">#</a>La closure: la variable-fonction</h2>
<h3 id="qu√©saco"><a href="#qu%C3%A9saco" class="phenomic-HeadingAnchor">#</a>Qu√©saco</h3>
<p><strong>Une <em>closure</em> est une partie de code, avec param√®tres et sorties, qui peut √™tre encapsul√© dans une variable, et ex√©cut√©e √† la demande</strong>. Si vous d√©veloppez en C++ ou Objective-C vous connaissez peut-√™tre d√©j√† les <em>blocks</em> et en Java ou C# les <em>lambdas</em> qui sont des <em>features</em> tr√®s (tr√®s) proches.</p>
<h3 id="d√©claration"><a href="#d%C3%A9claration" class="phenomic-HeadingAnchor">#</a>D√©claration</h3>
<p>Une <em>closure</em>  se d√©clare gr√¢ce au <code>{}</code> et peut √™tre appel√©e (ex√©cut√©e) gr√¢ce aux parenth√®ses :</p>
<pre><code class="hljs language-swift"> <span class="hljs-keyword">let</span> helloClosure = {
     <span class="hljs-built_in">print</span>(<span class="hljs-string">"hello, I‚Äôm a closure"</span>)
 }

 helloClosure() <span class="hljs-comment">// Le code est ex√©cut√© ici</span></code></pre>
<p>√áa vous rappelle rien ? L‚Äôappel d‚Äôune <em>fonction</em> ! En r√©alit√©, la <em>fonction</em> est une <em>closure</em> particuli√®re associ√© √† un contexte (Object, environnement, Bundle...) pour r√©aliser des optimisations et une meilleur compr√©hension du code.</p>
<blockquote>
<p>Pour une <em>closure</em> "√† l‚Äôair libre", on dit d‚Äôelle, qu‚Äôelle est <em>Self Contained</em> alors qu‚Äôune fonction est contenue par un contexte (<code>class</code> par exemple)</p>
</blockquote>
<p>Comme les fonctions, les <em>closures</em>  ont des param√®tres d‚Äôentr√©e et de retour:  </p>
<pre><code class="hljs language-swift"><span class="hljs-keyword">let</span> complexClosure = {(name:<span class="hljs-type">String</span>, age:<span class="hljs-type">Float</span>) -> <span class="hljs-type">Bool</span> <span class="hljs-keyword">in</span>
    <span class="hljs-comment">// Code</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}
<span class="hljs-keyword">let</span> success = complexClosure(<span class="hljs-string">"Louis"</span>,<span class="hljs-number">32</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Louis has <span class="hljs-subst">\(success)</span>"</span>)</code></pre>
<p>Ainsi, les valeurs dans la premi√®re partie apr√®s la <code>{</code> sont les param√®tres d‚Äôentr√©es et apr√®s la <code>-></code> ce sont les param√®tres de sortie. Le code √† ex√©cuter est apr√®s le <code>in</code>.</p>
<blockquote>
<p>Comme vous avez d√ª le remarquer, les <em>closures</em> n‚Äôont pas de param√®tres nominatif. IL faut passer les param√®tres d'entr√©e dans l'ordre de la d√©claration.</p>
</blockquote>
<h3 id="closure-et-type"><a href="#closure-et-type" class="phenomic-HeadingAnchor">#</a>Closure et Type</h3>
<p>Toute variable est typ√©e en <em>Swift</em>, implicitement ou explicitement. Pour les <em>closures</em> le type est souvent implicite, aussi bien qu‚Äôon en oublie souvent qu‚Äôelles sont typ√©es. Le type d‚Äôune closure va √™tre d√©fini par ses param√®tres d‚Äôentr√©e et de sortie. Ainsi la <em>complexClosure</em>  ci-dessus est du type : <code>((String, Float)) -> (Bool)</code>.</p>
<p>Je peux alors √©crire ce code puisque les closures sont du m√™me type :</p>
<pre><code class="hljs language-swift"><span class="hljs-keyword">let</span> otherComplexClosure = { (surname:<span class="hljs-type">String</span>,size:<span class="hljs-type">Float</span>) -> <span class="hljs-type">Bool</span> <span class="hljs-keyword">in</span>
    <span class="hljs-comment">// Other complexe Code</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
}
complexClosure = otherComplexClosure</code></pre>
<h3 id="utilisation-du-contexte"><a href="#utilisation-du-contexte" class="phenomic-HeadingAnchor">#</a>Utilisation du contexte</h3>
<p>Les <em>closures</em> ont une connaissance du contexte qui l‚Äôentoure. Ce qui veut dire que si la closure est cr√©√© dans une m√©thode, elle aura acc√®s :</p>
<ul>
<li>au contexte de classe en passant par <code>self</code> (variables, autre fonctions...)</li>
<li>au contexte de la fonction (param√®tres, fonctions internes...)</li>
</ul>
<pre><code class="hljs language-swift"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span> </span>{
    <span class="hljs-keyword">var</span> name = <span class="hljs-string">"Boby"</span>

    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">crier</span><span class="hljs-params">(cri:String)</span></span>{
        <span class="hljs-keyword">let</span> uselessClosure = {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"<span class="hljs-subst">\(<span class="hljs-keyword">self</span>.name)</span> cri <span class="hljs-subst">\(cri)</span>"</span>)
        }
        uselessClosure()
    }
}</code></pre>
<h3 id="trailing-closure"><a href="#trailing-closure" class="phenomic-HeadingAnchor">#</a>Trailing Closure</h3>
<p>Pour finir, un peu d'esth√©tisme car on aime tous le <em>beau</em> code. La <em>Trailing Closure</em> est une syntaxe d'appel de fonction qui permet de rendre le code plus facile √† lire.</p>
<p>Prenant la fonction suivante, prenant une <code>URL</code> est une closure de type <code>Void->Void</code> :</p>
<pre><code class="hljs language-swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">doLongTask</span><span class="hljs-params">(on file:URL,
        completion:<span class="hljs-params">()</span></span></span> -> ()){
    <span class="hljs-comment">//long task</span>
    completion()
}</code></pre>
<p>On alors l'appeler cette fonction comme ceci :</p>
<pre><code class="hljs language-swift">doLongTask(on: aFileURL, completion:{
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Task Applied on <span class="hljs-subst">\(aFileURL)</span>"</span>)
})</code></pre>
<p>Avec du code plus complexe, √ßa commence √† devenir difficile √† lire. Or si le dernier param√®tre d'une fonction est une <em>closure</em>, on peut alors √©crire l'appel comme ceci :</p>
<pre><code class="hljs language-swift">doLongTask(on: aFileURL){
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Task Applied on <span class="hljs-subst">\(aFileURL)</span>"</span>)
}</code></pre>
<h2 id="pro-tip"><a href="#pro-tip" class="phenomic-HeadingAnchor">#</a>Pro Tip</h2>
<p>Imaginons une classe <code>A</code> ayant une variable <code>event</code>  et un classe <code>B</code> ayant une fonction <code>awesomeEvent</code> ayant le m√™me type que la variable <code>event</code> de la classe <code>A</code>. Je peux alors allouer, √† la variable <code>event</code>, le code de <code>awesomeEvent</code>.</p>
<pre><code class="hljs language-swift"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>{
    <span class="hljs-keyword">var</span> event : ((<span class="hljs-type">String</span>)-><span class="hljs-type">Void</span>)?
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">awesome</span><span class="hljs-params">(name:String)</span></span>{
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Awesome <span class="hljs-subst">\(name)</span>"</span>)
    }
}

<span class="hljs-keyword">let</span> b = <span class="hljs-type">B</span>()
<span class="hljs-keyword">let</span> a = <span class="hljs-type">A</span>()

a.event = b.awesome
a.event?(<span class="hljs-string">"Mate"</span>)</code></pre>
<p><a href="http://swift.sandbox.bluemix.net/#/repl/59ecdb8508529b23242b5696">Ex√©cutez ce code sur IBM Swift Sandbox c'est magique!</a></p>
<h2 id="conclusion"><a href="#conclusion" class="phenomic-HeadingAnchor">#</a>Conclusion</h2>
<p>Voil√† vous savez tout, ou presque, sur les fonctions et les closures. Les closures ont vraiment la part belle en Swift, donc apprenez √† les utiliser et les comprendre pour simplifiez votre code. Elles sont partout dans les API iOS et macOS.</p>
<p>Et un petit conseil: faite attention √† l'√©tat de vos <em>closures</em> dans vos <code>Thread</code> si vous ne voulez pas de fuite üòä</p>
]]></description><link>http://putaindecode.io/fr/articles/swift/closure/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/swift/closure/</guid><pubDate>Thu, 26 Oct 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Introduction aux pattern des observables]]></title><description><![CDATA[<p>En JavaScript, nous pouvons ex√©cuter du code de mani√®re synchrone (bloquant) ou
asynchrone (non bloquant).</p>
<p>Prenons une fonction <code>logValue</code>, qui prend une valeur et l'affiche dans la
console :</p>
<pre><code class="hljs language-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logValue</span>(<span class="hljs-params">value</span>) </span>{
  <span class="hljs-built_in">console</span>.log(value);
}</code></pre>
<p>Nous allons passer <code>logValue</code> comme callback √† la m√©thode
<code>Array.prototype.forEach</code>, qui va l'ex√©cuter de mani√®re <strong>synchrone</strong> :</p>
<pre><code class="hljs language-JavaScript"><span class="hljs-keyword">const</span> arrayOfValues = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]

arrayOfValues.forEach(logValue)
<span class="hljs-comment">// Log 1, 2, 3, 4 puis 5</span></code></pre>
<p>On peut √©galement passer <code>logValue</code> comme callback de <code>setTimeout</code>, qui va
l'ex√©cuter de mani√®re <strong>asynchrone</strong> :</p>
<pre><code class="hljs language-JavaScript">setTimeout(logValue, <span class="hljs-number">3000</span>, <span class="hljs-string">"Hello world!"</span>)
logValue(<span class="hljs-string">"How are you?"</span>)
<span class="hljs-comment">// Log "How are you?"</span>
<span class="hljs-comment">// Log "Hello world!" 3 secondes plus tard</span></code></pre>
<p>Une fonction est agnostique: elle peut √™tre appel√©e de mani√®re synchrone ou
asynchrone, c'est la fa√ßon dont elle est ex√©cut√©e qui d√©finira le "mode".</p>
<p>Un cas o√π il est utile d'utiliser des APIs asynchrones avec Node.js: les acc√®s
au <em>file-system</em>. Si vous lisez un gros fichier en mode synchrone, il va bloquer
l'ex√©cution de votre programme tant qu'il n'a pas fini, mieux vaut attendre
qu'il vous l'envoie quand il est pr√™t.</p>
<p>Node.js propose l'API suivante: <code>fs.readFile(fileToRead, options, callback)</code></p>
<pre><code class="hljs language-JavaScript">fs.readFile(<span class="hljs-string">"./alphabet.txt"</span>, {<span class="hljs-attr">encoding</span>: <span class="hljs-string">"utf-8"</span>}, (err, data) => {
  <span class="hljs-keyword">if</span> (err) {
    onError(err)
  } <span class="hljs-keyword">else</span> {
    onData(data)
  }
})</code></pre>
<p>Cet exemple montre une API utilisant un simple callback qui est ex√©cut√© lorsque
<code>readFile</code> a lu le fichier ou √©chou√© √† le faire.</p>
<p>Un autre cas o√π utiliser des APIs asynchrones est particuli√®rement important :
les appels r√©seaux. On ne peut pas se permettre de <em>freeze</em> toute notre
interface pendant que la requ√™te r√©seau tourne.</p>
<pre><code class="hljs language-JavaScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logValue</span>(<span class="hljs-params">value</span>) </span>{ <span class="hljs-built_in">console</span>.log(value) }
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logError</span>(<span class="hljs-params">err</span>) </span>{ <span class="hljs-built_in">console</span>.error(err) }

fetch(<span class="hljs-string">"https://api.github.com/users/MrWi2l"</span>)
  .then(<span class="hljs-function"><span class="hljs-params">res</span> =></span> res.json())
  .then(logValue) <span class="hljs-comment">// Log le payload JSON lorsque la requ√™te est termin√©e</span>
  .catch(logError) <span class="hljs-comment">// Lance une erreur dans la console si quelque chose s'est mal pass√©</span></code></pre>
<p>Dans cet exemple, l'API renvoie une <code>Promise</code>: <a href="/fr/articles/js/es2015/promises/">une structure repr√©sentant une
valeur potentielle</a>. Lorsque sa valeur est
disponible, la promesse est <em>remplie</em>, et ex√©cutera les callbacks qu'on lui a
pass√© dans <code>.then</code>, si elle constate une erreur, elle ex√©cutera les callbacks
qu'on lui a pass√© dans <code>.catch</code>.</p>
<p>Les <code>Promise</code> ne permettent cependant pas de traiter de la donn√©e au fur et √†
mesure de son arriv√©e: elle est remplie une seule fois.</p>
<p>C'est l√† que les <code>Observable</code> arrivent √† la rescousse.</p>
<p>Un <code>Observable</code> est un objet impl√©mentant une m√©thode <code>.subscribe</code> qui prend
comme param√®tre un <code>Observer</code>. Ce dernier a cette forme :</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> observer = {
  <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">val</span> =></span> <span class="hljs-built_in">console</span>.log(val), <span class="hljs-comment">// une fonction √† ex√©cuter √† chaque nouvel √©venement</span>
  error: <span class="hljs-function"><span class="hljs-params">err</span> =></span> <span class="hljs-built_in">console</span>.error(err), <span class="hljs-comment">// une fonction √† ex√©cuter en cas d'erreur</span>
  complete: <span class="hljs-function"><span class="hljs-params">()</span> =></span> <span class="hljs-built_in">console</span>.info(<span class="hljs-string">"Complete!"</span>) <span class="hljs-comment">// une fonction √† ex√©cuter lorsque l'observable a fini</span>
};</code></pre>
<p>Impl√©mentons na√Øvement un <code>Observable</code> qui va r√©agir lorsqu'un user va taper sur
son clavier et se consid√©rer termin√© une fois <code>Enter</code> press√©:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> KeyboardObservable = {
  <span class="hljs-attr">subscribe</span>: <span class="hljs-function"><span class="hljs-params">observer</span> =></span> {
    <span class="hljs-keyword">const</span> handleKeyUp = <span class="hljs-function"><span class="hljs-params">event</span> =></span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> event.keyCode === <span class="hljs-string">"number"</span>) {
        <span class="hljs-keyword">if</span> (event.keyCode === <span class="hljs-number">13</span> <span class="hljs-comment">/* Enter */</span>) {
          <span class="hljs-built_in">document</span>.removeEventListener(<span class="hljs-string">"keyup"</span>, handleKeyUp);
          observer.complete();
        } <span class="hljs-keyword">else</span> {
          observer.next(event.keyCode);
        }
      } <span class="hljs-keyword">else</span> {
        observer.error(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"No keyCode found"</span>));
      }
    };
    <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">"keyup"</span>, handleKeyUp);
    <span class="hljs-comment">// subscribe retourne la "soucription", contenant une fonction pour la stopper</span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">unsubscribe</span>: <span class="hljs-function"><span class="hljs-params">()</span> =></span> <span class="hljs-built_in">document</span>.removeEventListener(<span class="hljs-string">"keyup"</span>, handleKeyUp)
    };
  }
};

<span class="hljs-keyword">let</span> keys = [];
KeyboardObservable.subscribe({
  <span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-params">keyCode</span> =></span> keys.push(<span class="hljs-built_in">String</span>.fromCharCode(keyCode)),
  <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-params">error</span> =></span> <span class="hljs-built_in">console</span>.error(error),
  <span class="hljs-attr">complete</span>: <span class="hljs-function"><span class="hljs-params">()</span> =></span> alert(keys.join(<span class="hljs-string">""</span>))
});</code></pre>
<p>Un <code>Observable</code> fonctionne √† la fois pour du code synchrone et asynchrone, et il
s'agit d'un pattern qui peut s'appliquer √† des cas o√π <code>Promise</code> manque de
granularit√©, puisqu'il permet de traiter la donn√©e au fur et √† mesure de son
arriv√©e. <em>In fine</em>, un observable est un <em>event emitter</em> avec un concept de
completion.</p>
<p>Il existe d'ailleurs un <a href="https://tc39.github.io/proposal-observable/"><em>proposal</em> en stage
1</a> pour en faire une API de la
specification de JavaScript. On peut tr√®s bien imaginer que les observables
deviennent une interface tr√®s r√©pandue dans un futur proche.</p>
<p>Dans les prochains articles, nous verrons pourquoi et comment combiner des
observables ainsi que les cas d'usage au sein d'une application React.</p>
]]></description><link>http://putaindecode.io/fr/articles/js/observable/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/js/observable/</guid><pubDate>Mon, 23 Oct 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Podcast 7: React 16, GraphQL, IDLs, RPCs et mauvaise foi sur l'iPhone X]]></title><description><![CDATA[<p>On se retrouve pour un nouvel √©pisode avec un joli programme: on vous y parle de
React 16, de GraphQL, des IDLs et des RPCs. En plus de √ßa, on vous offre une
belle dose de mauvaise foi dans un d√©bat sur l'iPhone X.</p>
<p>Moi, Matthias (<a href="https://twitter.com/bloodyowl">https://twitter.com/bloodyowl</a>), vous pr√©sente ce podcast en
compagnie de mes fid√®les acolytes :</p>
<ul>
<li>Mathieu (<a href="https://twitter.com/Zoontek">https://twitter.com/Zoontek</a>)</li>
<li>Georges (<a href="https://twitter.com/skinnyfoetusboy">https://twitter.com/skinnyfoetusboy</a>)</li>
</ul>
<p>Les petits liens qui vont bien :</p>
<ul>
<li>React 16: <a href="https://reactjs.org/blog/2017/09/26/react-v16.0.html">https://reactjs.org/blog/2017/09/26/react-v16.0.html</a></li>
<li>GraphQL: <a href="http://graphql.org">http://graphql.org</a></li>
<li>Relay: <a href="https://facebook.github.io/relay/">https://facebook.github.io/relay/</a></li>
<li>Apollo: <a href="https://www.apollodata.com">https://www.apollodata.com</a></li>
<li>ProtoBuf: <a href="https://github.com/google/protobuf">https://github.com/google/protobuf</a></li>
<li>Thrift: <a href="https://thrift.apache.org">https://thrift.apache.org</a></li>
<li>gRPC: <a href="https://grpc.io">https://grpc.io</a></li>
<li>iPhone X: <a href="https://www.apple.com/iphone-x/">https://www.apple.com/iphone-x/</a></li>
</ul>
<p>La track du g√©n√©rique: <a href="https://soundcloud.com/matthias-le-brun/arrow">https://soundcloud.com/matthias-le-brun/arrow</a></p>
<iframe width="100%" height="300" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/348401054&amp;color=%23ff5500&amp;auto_play=false&amp;hide_related=true&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;show_teaser=false&amp;visual=true"></iframe>
<ul>
<li>Le
<a href="http://feeds.soundcloud.com/users/soundcloud:users:273901232/sounds.rss">RSS</a></li>
<li>Sur iTunes : <a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825?l=en&#x26;mt=2">Putain de
Code</a></li>
</ul>
]]></description><link>http://putaindecode.io/fr/articles/podcast/7/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/podcast/7/</guid><pubDate>Wed, 18 Oct 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Utiliser Reason avec JavaScript]]></title><description><![CDATA[<p>Dans un <a href="/fr/articles/reason/introduction-reason/">pr√©c√©dent article</a>, on vous
pr√©sentait une nouvelle syntaxe pour OCaml:
<a href="https://reasonml.github.io">ReasonML</a>, elle rend le langage plus accessible en
le rapprochant de JavaScript moderne.</p>
<p>√Ä l'aide du projet
<a href="https://bucklescript.github.io/bucklescript/Manual.html">BuckleScript</a> qui
supporte Reason nativement, on peut compiler notre code Reason vers JavaScript
tr√®s facilement. Le cr√©ateur de BuckleScript utilisait √† l'origine un autre
projet appel√© <a href="http://ocsigen.org/js_of_ocaml/">js_of_ocaml</a>. Trouvant qu'il
serait possible d'optimiser et de rendre plus lisible le code JavaScript en
sortie si le compiler commen√ßait son travail √† une √©tape plus haut niveau (une
repr√©sentation du programme contenant des informations suppl√©mentaires, alors
que js_of_ocaml utilise du bytecode), il propose ce changement √† la team
js_of_ocaml qui refuse, et d√©cide donc de se lancer dans le projet qui deviendra
BuckleScript.</p>
<p>Pour d√©marrer un projet avec BuckleScript et Reason, on ouvre son terminal, et
c'est parti:</p>
<p>On installe BuckleScript:</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> npm install -g bs-platform</span></code></pre>
<p>On initialise le projet:</p>
<pre><code class="hljs language-console"><span class="hljs-meta">$</span><span class="bash"> bsb -init my-app -theme basic-reason</span></code></pre>
<p>Hop, votre projet est pr√™t dans <code>my-app</code>.</p>
<p>Maintenant la question est: comment est-ce que je peux utiliser du JS dans
Reason et vice-versa ?</p>
<h2 id="les-ffi-ou-foreign-function-interface"><a href="#les-ffi-ou-foreign-function-interface" class="phenomic-HeadingAnchor">#</a>Les FFI (ou Foreign Function Interface)</h2>
<p>OCaml g√®re naturellement les <code>FFI</code>, notamment pour appeler des fonctions <code>C</code>
lorsqu'il compile vers du code natif.</p>
<p>BuckleScript vient les overloader pour les adapter √† JavaScript.</p>
<p>Cr√©ons une FFI pour la fonction <code>alert</code> :</p>
<pre><code class="hljs language-reason">[@bs.<span class="hljs-keyword">val</span>] <span class="hljs-keyword">external</span> alert : <span class="hljs-built_in">string</span> => <span class="hljs-built_in">unit</span> = <span class="hljs-string">""</span>;</code></pre>
<p>On d√©finit:</p>
<ul>
<li>une fonction externe nomm√©e <code>alert</code></li>
<li>qui prend une <code>string</code> et ne retourne <em>rien</em> (ici repr√©sent√© par la valeur
<code>unit</code>)</li>
<li>qui est une valeur √† simplement r√©cup√©rer (<code>[@bs.val]</code>)</li>
</ul>
<p>Si on regarde le code JavaScript en sortie, c'est vide. En effet, <code>external</code> est
un moyen de d√©finir comment acc√©der √† une valeur ainsi que son type. Si en
revanche on utilise la function <code>alert</code> dans le module:</p>
<pre><code class="hljs language-reason">[@bs.<span class="hljs-keyword">val</span>] <span class="hljs-keyword">external</span> alert : <span class="hljs-built_in">string</span> => <span class="hljs-built_in">unit</span> = <span class="hljs-string">""</span>;

alert(<span class="hljs-string">"Hello!"</span>);</code></pre>
<p>On voit dans l'output que BuckleScript a <em>inlin√©</em> l'appel de <code>alert</code>, il n'a pas
cr√©e de repr√©sentation interm√©diaire.</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>
<span class="hljs-meta">"use strict"</span>;

alert(<span class="hljs-string">"Hello!"</span>);

<span class="hljs-comment">/*  Not a pure module */</span></code></pre>
<p>Maintenant amusons nous √† cr√©er des bindings pour jQuery, juste pour le fun:</p>
<pre><code class="hljs language-reason">/* <span class="hljs-type">On</span> cr√©e un <span class="hljs-keyword">type</span> opaque pour repr√©senter un objet jQuery */
<span class="hljs-keyword">type</span> jQuery;

/* <span class="hljs-type">On</span> <span class="hljs-keyword">type</span> le <span class="hljs-keyword">module</span> jQuery */
[@bs.<span class="hljs-keyword">module</span>] <span class="hljs-keyword">external</span> jQuery : <span class="hljs-built_in">string</span> => jQuery = <span class="hljs-string">"jquery"</span>;

/* <span class="hljs-type">On</span> <span class="hljs-keyword">type</span> la m√©thod `on`, <span class="hljs-type">BuckleScript</span> peut naturellement typer
  le pattern de chaining, assez commun en <span class="hljs-type">JS</span>, √† l'aide de l'annotation
  `bs.send.pipe: <span class="hljs-keyword">type</span>` */
[@bs.send.pipe: jQuery] <span class="hljs-keyword">external</span> on : <span class="hljs-built_in">string</span> => (<span class="hljs-type">Dom</span>.event => <span class="hljs-built_in">unit</span>) => jQuery = <span class="hljs-string">""</span>;

jQuery(<span class="hljs-string">".selector"</span>)
  |> on(<span class="hljs-string">"click"</span>, (_) => alert(<span class="hljs-string">"hey"</span>));</code></pre>
<p>Ce qui va nous sortir:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>
<span class="hljs-meta">"use strict"</span>;

<span class="hljs-keyword">var</span> JQuery = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jquery"</span>);

JQuery(<span class="hljs-string">".selector"</span>).on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  alert(<span class="hljs-string">"hey"</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-comment">/* () */</span> <span class="hljs-number">0</span>;
});

<span class="hljs-comment">/*  Not a pure module */</span></code></pre>
<p>Comme on peut le constater, le code de sortie ressemble beaucoup √† ce qu'on
pourrait √©crire √† la main.</p>
<p>Pour en savoir un peu plus sur les FFI JavaScript:</p>
<ul>
<li><a href="https://bucklescript.github.io/bucklescript/Manual.html">La documentation de
BuckleScript</a></li>
<li><a href="https://github.com/reasonml-community">Les projets de bindings cr√©es par la
communaut√©</a> (ceux nomm√©s
<code>bs-{nom-de-lib-js}</code>)</li>
</ul>
<h2 id="les-objets"><a href="#les-objets" class="phenomic-HeadingAnchor">#</a>Les objets</h2>
<p>On peut directement utiliser des objets JavaScript en Reason. Pour acc√©der √† une
propri√©t√©, on utilise <code>##</code>.</p>
<pre><code class="hljs language-reason"><span class="hljs-meta">myJsObject#</span><span class="bash"><span class="hljs-comment">#property</span></span></code></pre>
<p>√áa d√©panne, mais au sein de notre code Reason, on pr√©f√©rera bien souvent
utiliser des records: ils ont une repr√©sentation plus l√©g√®re et sont par d√©faut
immutables. Pour effectuer une conversion, on proc√®de de la mani√®re suivante:</p>
<pre><code class="hljs language-reason"><span class="hljs-keyword">type</span> jsUser = {
  .
  <span class="hljs-string">"id"</span>: <span class="hljs-built_in">string</span>,
  <span class="hljs-string">"username"</span>: <span class="hljs-built_in">string</span>,
  <span class="hljs-comment">/* valeur pouvant √™tre null, undefined, ou la valeur */</span>
  <span class="hljs-string">"birthdate"</span>: Js.Null_undefined.t(<span class="hljs-built_in">string</span>),
  <span class="hljs-comment">/* "light" ou "dark", les enums sont souvent repr√©sent√©s par des strings en JS */</span>
  <span class="hljs-string">"theme"</span>: <span class="hljs-built_in">string</span>
};

<span class="hljs-comment">/* En Reason, les enums sont repr√©sent√©s par des variants */</span>
<span class="hljs-keyword">type</span> theme =
  | Light
  | Dark;

<span class="hljs-keyword">type</span> user = {
  id: <span class="hljs-built_in">string</span>,
  username: <span class="hljs-built_in">string</span>,
  <span class="hljs-comment">/* pas de null ou undefined, on utilise un type option */</span>
  birthdate: option(<span class="hljs-built_in">string</span>),
  theme
};

<span class="hljs-comment">/* une fonction de transformation JS -> Reason */</span>
<span class="hljs-keyword">let</span> fromJs = <span class="hljs-function">(<span class="hljs-params">jsUser</span>) =></span> {
  id: jsUser##id,
  username: jsUser##username,
  <span class="hljs-comment">/* BuckleScript propose des helpers pour les conversions */</span>
  birthdate: Js.Null_undefined.to_opt(jsUser##birthdate),
  theme:
    <span class="hljs-keyword">switch</span> jsUser##theme {
    | <span class="hljs-string">"dark"</span> => Dark
    | <span class="hljs-string">"light"</span>
    <span class="hljs-comment">/* On match une cha√Æne de caract√®re, le match n'est pas exhaustif,
         on doit donc d√©finir la valeur de fallback (par defaut) √† l'aide
         de `_`
       */</span>
    | _ => Light
    }
};

<span class="hljs-comment">/* Pour cr√©er un objet JS en Reason, il suffit de l'√©crire comme un
     record, mais avec des cl√©s entre quotes, comme du JSON.
   */</span>
<span class="hljs-keyword">let</span> toJs = <span class="hljs-function">(<span class="hljs-params">user</span>) =></span> {
  <span class="hljs-string">"id"</span>: user.id,
  <span class="hljs-string">"username"</span>: user.username,
  <span class="hljs-string">"birthdate"</span>: Js.Null_undefined.from_opt(user.birthdate),
  <span class="hljs-string">"theme"</span>:
    <span class="hljs-keyword">switch</span> user.theme {
    | <span class="hljs-function"><span class="hljs-params">Light</span> =></span> <span class="hljs-string">"light"</span>
    | <span class="hljs-function"><span class="hljs-params">Dark</span> =></span> <span class="hljs-string">"dark"</span>
    }
};</code></pre>
<p>Le code en sortie:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>
<span class="hljs-meta">"use strict"</span>;

<span class="hljs-keyword">var</span> Js_primitive = <span class="hljs-built_in">require</span>(<span class="hljs-string">"bs-platform/lib/js/js_primitive.js"</span>);
<span class="hljs-keyword">var</span> Js_null_undefined = <span class="hljs-built_in">require</span>(<span class="hljs-string">"bs-platform/lib/js/js_null_undefined.js"</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromJs</span>(<span class="hljs-params">jsUser</span>) </span>{
  <span class="hljs-keyword">var</span> match = jsUser.theme;
  <span class="hljs-keyword">var</span> tmp;
  <span class="hljs-keyword">switch</span> (match) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"dark"</span>:
      tmp = <span class="hljs-comment">/* Dark */</span> <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"light"</span>:
      tmp = <span class="hljs-comment">/* Light */</span> <span class="hljs-number">0</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
      tmp = <span class="hljs-comment">/* Light */</span> <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-comment">/* record */</span> [
    <span class="hljs-comment">/* id */</span> jsUser.id,
    <span class="hljs-comment">/* username */</span> jsUser.username,
    <span class="hljs-comment">/* birthdate */</span> Js_primitive.null_undefined_to_opt(jsUser.birthdate),
    <span class="hljs-comment">/* theme */</span> tmp
  ];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toJs</span>(<span class="hljs-params">user</span>) </span>{
  <span class="hljs-keyword">var</span> match = user[<span class="hljs-comment">/* theme */</span> <span class="hljs-number">3</span>];
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">id</span>: user[<span class="hljs-comment">/* id */</span> <span class="hljs-number">0</span>],
    <span class="hljs-attr">username</span>: user[<span class="hljs-comment">/* username */</span> <span class="hljs-number">1</span>],
    <span class="hljs-attr">birthdate</span>: Js_null_undefined.from_opt(user[<span class="hljs-comment">/* birthdate */</span> <span class="hljs-number">2</span>]),
    <span class="hljs-attr">theme</span>: match !== <span class="hljs-number">0</span> ? <span class="hljs-string">"dark"</span> : <span class="hljs-string">"light"</span>
  };
}

exports.fromJs = fromJs;
exports.toJs = toJs;
<span class="hljs-comment">/* No side effect */</span></code></pre>
<h2 id="les-standard-libs"><a href="#les-standard-libs" class="phenomic-HeadingAnchor">#</a>Les standard-libs</h2>
<p>Si le besoin s'en fait sentir, BuckleScript propose naturellement la stdlib de
JavaScript.</p>
<pre><code class="hljs language-reason"><span class="hljs-keyword">let</span> myArray = [|<span class="hljs-type">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>|<span class="hljs-type">];

myArray</span>
  |<span class="hljs-type">> Js</span>.Array.map((item) => item * <span class="hljs-number">2</span>)
  |<span class="hljs-type">> Js</span>.Array.reduce((acc, item) => acc + item, <span class="hljs-number">0</span>);</code></pre>
<p>vous sortira:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>
<span class="hljs-meta">"use strict"</span>;

<span class="hljs-keyword">var</span> myArray = <span class="hljs-comment">/* array */</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

myArray
  .map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
    <span class="hljs-keyword">return</span> item &#x3C;&#x3C; <span class="hljs-number">1</span>;
  })
  .reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">acc, item</span>) </span>{
    <span class="hljs-keyword">return</span> (acc + item) | <span class="hljs-number">0</span>;
  }, <span class="hljs-number">0</span>);

exports.myArray = myArray;
<span class="hljs-comment">/*  Not a pure module */</span></code></pre>
<h2 id="la-technique-bourrin"><a href="#la-technique-bourrin" class="phenomic-HeadingAnchor">#</a>La technique bourrin</h2>
<p>Pour les cas extr√™mes ou vous voulez juste balancer une fonction JS, vous
pouvez:</p>
<pre><code class="hljs language-reason"><span class="hljs-comment">/* %bs.raw pour une expression, %%bs.raw pour un bloc de code arbitraire */</span>
<span class="hljs-keyword">let</span> log: <span class="hljs-function"><span class="hljs-params">string</span> =></span> unit = [%bs.raw {|
  <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a</span>) </span>{
    <span class="hljs-built_in">console</span>.log(a);
  }
|}];

log(<span class="hljs-string">"ok"</span>);</code></pre>
<p>qui vous sort un joli:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// Generated by BUCKLESCRIPT VERSION 1.9.1, PLEASE EDIT WITH CARE</span>
<span class="hljs-meta">"use strict"</span>;

<span class="hljs-keyword">var</span> Curry = <span class="hljs-built_in">require</span>(<span class="hljs-string">"bs-platform/lib/js/curry.js"</span>);

<span class="hljs-keyword">var</span> log = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>) </span>{
  <span class="hljs-built_in">console</span>.log(a);
};

Curry._1(log, <span class="hljs-string">"ok"</span>);

exports.log = log;
<span class="hljs-comment">/* log Not a pure module */</span></code></pre>
<h2 id="conclusion"><a href="#conclusion" class="phenomic-HeadingAnchor">#</a>Conclusion</h2>
<p>OCaml peut en grande majorit√© √™tre compil√© en JavaScript tr√®s simple, parce
qu'il partage beaucoup de concepts avec ce dernier. Il est assez simple de cr√©er
des ponts entre les deux langages √† l'aide des FFI. L'√©norme avantage de cette
feature, c'est que l'on peut commencer √† utiliser Reason incr√©mentalement sur
son projet sans avoir √† tout r√©√©crire d'un coup.</p>
<p>Bisous bisous.</p>
]]></description><link>http://putaindecode.io/fr/articles/reason/interop/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/reason/interop/</guid><pubDate>Tue, 10 Oct 2017 00:00:00 GMT</pubDate></item><item><title><![CDATA[Introduction √† ReasonML (ou pourquoi j'ai arr√™t√© d'utiliser JavaScript)]]></title><description><![CDATA[<p>Les bugs c'est chiant, surtout quand on sait qu'on aurait pu les √©viter. Avec
JavaScript, c'est plus facile d'en avoir que de les √©viter.</p>
<p>JavaScript, on ne peut pas y √©chapper parce que c'est partout, parce que c'est
le langage de programmation le plus utilis√© sur Terre, et parce que c'est le
seul truc qui (pour l'instant) tourne nativement dans le navigateur. Et puis
c'est pas si mal, c'est facile de l'apprendre en bidouillant un peu, c'est tr√®s
permissif et pas trop frustrant pour d√©buter.</p>
<p>Le probl√®me c'est que c'est facile d'en faire, mais c'est tr√®s dur d'en faire
<strong>bien</strong> (moins que CSS, mais quand m√™me). On s'est tous d√©j√† retrouv√© avec
<code>undefined is not a function</code>, <code>null is not an object</code> ou un bon gros <code>[object Object]</code> qui tra√Æne dans la console.</p>
<h2 id="pourquoi-est-ce-que-cest-comme-√ßa-"><a href="#pourquoi-est-ce-que-cest-comme-%C3%A7a-" class="phenomic-HeadingAnchor">#</a>Pourquoi est-ce que c'est comme √ßa ?</h2>
<p>JavaScript est un langage dynamiquement et faiblement typ√©, ce qui veut dire :</p>
<ul>
<li>qu'une fonction ne sait pas ce qu'elle prend ou retourne comme type
d'arguments, c'est √† vous de g√©rer</li>
<li>que le programme n'en a aucune id√©e non plus tant qu'il n'execute pas la
portion de code</li>
</ul>
<p>Tout √ßa fait qu'il est tr√®s difficile de faire confiance √† du code JavaScript.</p>
<figure>
<img src="./js.png" alt="js" />
<figcaption>Source: MIT</figcaption>
</figure>
<p>Il existe Flow et TypeScript (dont on a parl√© dans un <a href="/fr/articles/js/flow/">pr√©c√©dent
article</a> et un <a href="fr/articles/podcast/3/">podcast</a>), deux
projets qui permettent d'apporter du typage statique pour s√©curiser son code.
Ils contraignent votre usage de JavaScript, mais devront toujours se battre
contre sa permissivit√©.</p>
<p>√áa revient au final √† coller des rustines sur vos pneus avant d'aller rouler sur
des clous, √ßa va vous prot√©ger un peu, mais √ßa reste de base pas bien malin
d'aller rouler sur des clous.</p>
<p>Il existe des langages qui ont la judicieuse id√©e de balayer la route pour virer
les clous avant d'y aller : les langages typ√©s fortement et statiquement (10
points pour Gryffondor pour cette m√©taphore fil√©e).</p>
<p>OCaml est un de ces langages. Il est de la famille ML et a √©t√© cr√©√© en France
dans les ann√©es 90. Il est √† peu pr√®s aussi √¢g√© que JavaScript mais est beaucoup
plus sage. Il est certes fortement et statiquement typ√©, mais il inf√®re la
plupart des types du programme (ce qui veut dire que vous n'avez pas √†
renseigner les types partout, il va l'extrapoler d√®s qu'il le peut). En bonus,
il poss√®de de <a href="https://ocaml.org/learn/tutorials/comparison_of_standard_containers.html">bonnes
data-structures</a>.</p>
<p>Seulement voil√†, OCaml, comme beaucoup de langages fonctionnels n'a pas vraiment
mis l'accent sur l'accessibilit√© pour les d√©butants, et a une syntaxe qu'on peut
pour le moins qualifier de pas tr√®s friendly: elle n'a rien de bien mal, mais
mettez quelqu'un qui vient de JS/PHP/Java devant, √ßa va pas lui causer des
masses:</p>
<pre><code class="hljs language-ocaml"><span class="hljs-keyword">let</span> <span class="hljs-keyword">rec</span> qsort = <span class="hljs-keyword">fun</span> <span class="hljs-keyword">value</span> ->
  <span class="hljs-keyword">match</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">with</span>
   | <span class="hljs-literal">[]</span> -> <span class="hljs-literal">[]</span>
   | pivot :: rest ->
       <span class="hljs-keyword">let</span> is_less x = x &#x3C; pivot <span class="hljs-keyword">in</span>
       <span class="hljs-keyword">let</span> left, right = <span class="hljs-type">List</span>.partition is_less rest <span class="hljs-keyword">in</span>
       qsort left @ [pivot] @ qsort right;;</code></pre>
<figure>
<img src="./giphy.gif" alt="" />
<figcaption>fig. 1: dev JS devant du code OCaml</figcaption>
</figure>
<p>C'est l√† qu'intervient Reason, un projet initi√© par <a href="https://twitter.com/jordwalke">le cr√©ateur de
React</a>. Les premi√®res it√©rations de React √©taient
d'ailleurs cod√©es dans un langage cousin de OCaml, le SML.</p>
<p>C'est en gros:</p>
<ul>
<li>OCaml</li>
<li>avec une syntaxe <em>beginner-friendly</em></li>
<li>avec un tooling le rendant plus simple √† utiliser</li>
<li>qui peut compiler vers JavaScript et de multiples plateformes</li>
</ul>
<p>Avec son type system, OCaml propose un langage <em>safe-by-design</em>, chose que m√™me
avec une palanqu√©e d'outils, on ne peut pas atteindre avec JavaScript.</p>
<p>Le langage propose par d√©faut une approche fonctionnelle et immutable, mais
permet cependant de choisir d'utiliser des structures mutables et de l'orient√©
objet au besoin.</p>
<h2 id="le-langage"><a href="#le-langage" class="phenomic-HeadingAnchor">#</a>Le langage</h2>
<p>Reason comporte plus de types de primitifs que JavaScript:</p>
<pre><code class="hljs language-reason"><span class="hljs-comment">/* pas un gros "number" fourre tout, magique */</span>
<span class="hljs-number">1</span>; <span class="hljs-comment">/* int */</span>
<span class="hljs-number">1.0</span>; <span class="hljs-comment">/* float */</span>
<span class="hljs-comment">/* un caract√®re est d'un type diff√©rent de string */</span>
<span class="hljs-string">"foo"</span>; <span class="hljs-comment">/* string */</span>
'a'; <span class="hljs-comment">/* char */</span>
<span class="hljs-comment">/* on trouve list ET array, chacun peut √™tre utilis√© pour diff√©rents cas */</span>
[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]; <span class="hljs-comment">/* list */</span>
[| <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> |]; <span class="hljs-comment">/* array */</span>
<span class="hljs-comment">/* pas de null, mais des valeurs de type `option` qui contiennent
  soit une valeur, soit rien */</span>
Some(<span class="hljs-number">1</span>); <span class="hljs-comment">/* option int */</span>
None; <span class="hljs-comment">/* option int */</span></code></pre>
<p>Puisqu'il est fortement typ√©, il est impossible de mixer les types comme en
JavaScript, vous devrez obligatoirement les convertir:</p>
<pre><code class="hljs language-reason"><span class="hljs-number">1</span> + <span class="hljs-number">1.0</span>;
<span class="hljs-comment">/* Error:
  This expression has type int but an expression was expected of type float */</span>
<span class="hljs-number">1</span> + int_of_float(<span class="hljs-number">1.0</span>);
<span class="hljs-comment">/* - : int = 2 */</span></code></pre>
<p>La plupart des op√©rations de transformations de type primitifs vers un autre
sont accessibles dans le module <code>Pervasives</code> qui contient plein de petits
utilitaires bien pratiques. Toutes les fonctions de ce module sont accessibles
directement dans n'importe quel de vos fichiers.</p>
<p>Les fonctions de Reason sont beaucoup plus puissantes qu'en JavaScript:</p>
<pre><code class="hljs language-reason">let <span class="hljs-keyword">add </span>= (a, <span class="hljs-keyword">b) </span>=> a + <span class="hljs-keyword">b;
</span><span class="hljs-comment">/* int => int => int */</span>
<span class="hljs-keyword">add(1, </span><span class="hljs-number">2</span>)<span class="hljs-comment">;</span>
<span class="hljs-comment">/* 3 */</span>
<span class="hljs-keyword">add(1, </span><span class="hljs-number">2</span>.<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
<span class="hljs-comment">/* This expression has type float but an expression was expected of type int */</span>

<span class="hljs-comment">/* Les fonctions sont "auto-curried", ce qui signifie qu'une fonction
   qui n'a pas re√ßu tous ses param√®tres retourne une nouvelle fonction
  qui va recevoir les param√®tres manquants */</span>
let <span class="hljs-keyword">addOne </span>= <span class="hljs-keyword">add(1);
</span><span class="hljs-comment">/* int => int */</span>

<span class="hljs-comment">/* Les fonctions peuvent avoir des param√®tres nomm√©s, optionnels et avec des valeurs par d√©faut */</span>
let sayHi = (~name, ~punct=<span class="hljs-string">"!"</span>, ()) => <span class="hljs-string">"Hello "</span> ++ name ++ punct<span class="hljs-comment">;</span>
<span class="hljs-comment">/* name::string => string */</span>
sayHi(~name=<span class="hljs-string">"you"</span>, ())<span class="hljs-comment">;</span>
<span class="hljs-comment">/* "Hello you!" */</span>
<span class="hljs-comment">/* L'ordre des arguments nomm√©s n'a pas d'importance*/</span>
sayHi(~punct,<span class="hljs-string">"?"</span>, ~name=<span class="hljs-string">"you"</span>, ())<span class="hljs-comment">;</span>
<span class="hljs-comment">/* "Hello you?" */</span></code></pre>
<p>Pour d√©finir l'√©quivalent d'un <em>plain-object</em> JavaScript en Reason, on utilise
des records:</p>
<pre><code class="hljs language-reason">/* On doit typer les records */
<span class="hljs-keyword">type</span> <span class="hljs-keyword">user</span> <span class="hljs-title">= {
  username</span>: <span class="hljs-keyword">string</span>,
  age: int
};

/* Les records ont un nombre de cl√©s fini, vous <span class="hljs-keyword">ne</span> pouvez pas en
  ommettre une ou en mettre une en trop */
let <span class="hljs-keyword">user</span> <span class="hljs-title">= { username</span>: <span class="hljs-string">"Bob"</span> };
/* Error: Some record fields are undefined: age */

let <span class="hljs-keyword">user</span> <span class="hljs-title">= { username</span>: <span class="hljs-string">"Bob"</span>, age: <span class="hljs-number">20</span> };

/* Les records sont immutables par d√©faut */
let olderUser = {...user, age: user.age + <span class="hljs-number">1</span> };</code></pre>
<p>Reason poss√®de un syst√®me de module tr√®s puissant: par d√©faut, chaque fichier de
votre codebase est un module, mais vous pouvez √©galement d√©clarer des modules
<em>dans</em> un module.</p>
<pre><code class="hljs language-reason"><span class="hljs-keyword">module</span> User = {
  <span class="hljs-keyword">type</span> t = {
    id: <span class="hljs-built_in">string</span>,
    username: <span class="hljs-built_in">string</span>,
    email: option(<span class="hljs-built_in">string</span>)
  };
  <span class="hljs-keyword">let</span> make = <span class="hljs-function">(<span class="hljs-params">~id, ~username, ~email</span>) =></span> {id, username, email};
  <span class="hljs-keyword">let</span> sayHi = <span class="hljs-function">(<span class="hljs-params">user</span>) =></span> <span class="hljs-string">"Hello "</span> ++ user.username ++ <span class="hljs-string">"!"</span>;
};

<span class="hljs-comment">/* Pour utiliser un module, tapez son nom, tout simplement */</span>
User.make(~id=<span class="hljs-string">"0"</span>, ~username=<span class="hljs-string">"bloodyowl"</span>, ~email=None)
  <span class="hljs-comment">/* (ah oui, le pipe existe d√©j√† ici, pas besoin d'attendre ES2050)*/</span>
  |> User.sayHi
  |> print_endline;
<span class="hljs-comment">/* "Hello bloodyowl" */</span>

<span class="hljs-comment">/* On peut √©galement rendre toutes les valeurs d'un module accessibles localement */</span>
User.(
  make(~id=<span class="hljs-string">"0"</span>, ~username=<span class="hljs-string">"bloodyowl"</span>, ~email=None)
    |> sayHi
    |> print_endline
);

<span class="hljs-comment">/* Carr√©ment les rendre accessibles globalement dans le module */</span>
open User;

make(~id=<span class="hljs-string">"0"</span>, ~username=<span class="hljs-string">"bloodyowl"</span>, ~email=None)
  |> sayHi
  |> print_endline;

<span class="hljs-comment">/* Ou m√™me √©tendre un module statiquement et proprement,
  √ßa vous parle √ßa, Prototype et MooTools ?! */</span>
<span class="hljs-keyword">module</span> UserThatCanSayBye = {
  include User;
  <span class="hljs-keyword">let</span> sayBye = <span class="hljs-function">(<span class="hljs-params">user</span>) =></span> <span class="hljs-string">"Bye "</span> ++ user.username ++ <span class="hljs-string">"!"</span>;
};</code></pre>
<p>Il existe √©galement des functors, qui sont des sortes de fonctions retournant
des modules √† partir d'autres modules, mais on ne l'abordera pas dans cet
article.</p>
<p>Reason poss√®de √©galement des variants, il s'agit de types pouvant avoir
diff√©rents cas. Prenons l'exemple d'un message de chat:</p>
<pre><code class="hljs language-reason">type <span class="hljs-built_in">image</span> = {url: <span class="hljs-keyword">string</span>, <span class="hljs-built_in">width</span>: <span class="hljs-keyword">int</span>, <span class="hljs-built_in">height</span>: <span class="hljs-keyword">int</span>};

<span class="hljs-comment">/* chaque cas du variant peut prendre des param√®tres */</span>
type message =
  | <span class="hljs-keyword">String</span>(<span class="hljs-keyword">string</span>) <span class="hljs-comment">/* soit une cha√Æne de caract√®res */</span>
  | Image(<span class="hljs-built_in">image</span>) <span class="hljs-comment">/* soit une image */</span>
  | Emoji(<span class="hljs-keyword">string</span>); <span class="hljs-comment">/* soit un gros emoji */</span>

let stringMessage = <span class="hljs-keyword">String</span>(<span class="hljs-string">"Hello"</span>); <span class="hljs-comment">/* On cr√©e la valeur avec son constructeur */</span>
let imageMessage = Image({url: <span class="hljs-string">"https://fakeimg.pl/300x300"</span>, <span class="hljs-built_in">width</span>: <span class="hljs-number">300</span>, <span class="hljs-built_in">height</span>: <span class="hljs-number">300</span>});
let emojiMessage = Emoji({js|üê´|js}); <span class="hljs-comment">/* Quand la string contient de caract√®res unicode,
  on doit utiliser {js|votre string|js} */</span></code></pre>
<p>Ici, notre type <code>message</code> est bien d√©limit√©, et ses valeurs ne peuvent √™tre que
celles que l'on a d√©fini.</p>
<p>Pour utiliser les valeurs d'un variant, on peut les extraire √† l'aide de
<code>switch</code>, qui va <em>pattern-matcher</em> pour nous permettre d'identifier et
d'extraire les valeurs.</p>
<pre><code class="hljs language-reason"><span class="hljs-comment">/* Petit bonus, l'exemple utilise ReasonReact, mais on d√©taillera √ßa dans un prochain article */</span>
<span class="hljs-keyword">let</span> component = ReasonReact.statelessComponent(<span class="hljs-string">"ChatMessage"</span>);

<span class="hljs-keyword">let</span> make = <span class="hljs-function">(<span class="hljs-params">~message, _children</span>) =></span> {
  ...component,
  <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">_</span>) =></span>
    &#x3C;div>
      (<span class="hljs-keyword">switch</span> message {
        | <span class="hljs-built_in">String</span>(value) => ReasonReact.stringToElement(value)
        | Image({<span class="hljs-attr">url</span>: src, width, height}) => <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">img</span> <span class="hljs-attr">width</span> <span class="hljs-attr">height</span> <span class="hljs-attr">src</span> /></span>
        /* Si par m√©garde j'oublie un cas possible dans un switch, je vais avoir un joli warning du
          compiler qui me dira:
            This pattern-matching is not exhaustive.
            Here is an example of a value that is not matched:
              Emoji
        */
        | Emoji(value) =>
          </span>&#x3C;div style=(ReactDOMRe.Style.make(~fontSize="40px", ()))>
            (ReasonReact.stringToElement(value))
          &#x3C;/div><span class="xml">
      })
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>
};</code></pre>
<p>En Reason, les <em>let bindings</em> ont automatiquement le block parent comme scope,
on peut du coup √©crire des choses comme ceci :</p>
<pre><code class="hljs language-reason"><span class="hljs-keyword">let</span> <span class="hljs-attr">value</span> = {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">b</span> = <span class="hljs-number">2</span>;
  a + b; <span class="hljs-comment">/* la derni√®re expression est toujours retourn√©e par d√©faut */</span>
};
<span class="hljs-comment">/* let value : int = 3 */</span>
a
<span class="hljs-comment">/* Error: Unbound value a */</span></code></pre>
<p>Voil√† pour l'introduction √† ReasonML, pour en d√©couvrir un peu plus je vous
invite √† aller lire la <a href="https://reasonml.github.io/">documentation officielle</a>.
On verra dans les prochains articles comment fonctionne
<a href="https://reasonml.github.io/reason-react">ReasonReact</a> (les bindings Reason vers
React, avec quelques petites features sympathiques en plus), et comment
l'adopter incr√©mentalement dans sa codebase pour avoir du code plus s√ªr, et
<em>(spoilers)</em>, plus rapide que si vous l'√©criviez √† la main.</p>
<p>Bisous bisous.</p>
]]></description><link>http://putaindecode.io/fr/articles/reason/introduction-reason/</link><guid isPermaLink="true">http://putaindecode.io/fr/articles/reason/introduction-reason/</guid><pubDate>Mon, 02 Oct 2017 00:00:00 GMT</pubDate></item></channel></rss>